import{j as e}from"./vendor-query-D5ml2kdZ.js";import{e as R,u as T,r as a}from"./vendor-react-C8VcOkCS.js";import{u as $,C as w,B as b}from"./index-BZEM9EbM.js";import{B}from"./Badge-8fS5vckW.js";import{v as y}from"./videoMeetings-CiqYZFDU.js";import{ad as h,V as g,A as p,aY as D,bc as M,bd as C,be as E,u as F,an as L,a_ as V,M as A,bf as I,bg as P,ar as U}from"./vendor-ui-tJ0aMxU9.js";function ee(){const{meetingId:t}=R(),r=T(),{user:d}=$(),[s,n]=a.useState(null),[c,i]=a.useState("loading");a.useEffect(()=>{t&&(async()=>{try{const l=await y.show(Number(t));n(l),l.meeting_type==="external"?i("external"):l.status==="in_progress"?i("session"):l.status==="completed"||l.status==="cancelled"?i("ended"):i("waiting")}catch{h.error("Meeting not found"),r("/meetings")}})()},[t]);const f=async()=>{if(s)try{const l=await y.start(s.id);n(l),i("session")}catch{h.error("Failed to start meeting")}},u=async()=>{if(s)try{const l=await y.end(s.id);n(l),i("ended"),h.success("Meeting ended")}catch{h.error("Failed to end meeting")}};return c==="loading"?e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx("div",{className:"w-10 h-10 border-4 border-shield-200 border-t-shield-600 rounded-full animate-spin"})}):c==="ended"?e.jsx("div",{className:"max-w-lg mx-auto mt-20 text-center",children:e.jsxs(w,{className:"p-8",children:[e.jsx(g,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-2",children:"Meeting Ended"}),e.jsx("p",{className:"text-slate-500 mb-1",children:s?.title}),s?.started_at&&s?.ended_at&&e.jsxs("p",{className:"text-sm text-slate-400 mb-6",children:["Duration: ",W(new Date(s.started_at),new Date(s.ended_at))]}),e.jsxs(b,{variant:"shield",onClick:()=>r("/meetings"),children:[e.jsx(p,{className:"w-4 h-4 mr-1"})," Back to Meetings"]})]})}):c==="external"&&s?e.jsx(q,{meeting:s,onBack:()=>r("/meetings")}):c==="waiting"&&s?e.jsx(z,{meeting:s,userId:d?.id,onStart:f,onBack:()=>r("/meetings")}):c==="session"&&s?e.jsx(H,{meeting:s,onEnd:u,onBack:()=>r("/meetings")}):null}function z({meeting:t,userId:r,onStart:d,onBack:s}){const[n,c]=a.useState(!0),[i,f]=a.useState(!0),u=a.useRef(null),l=a.useRef(null),N=r===t.host_user_id;return a.useEffect(()=>((async()=>{try{const o=await navigator.mediaDevices.getUserMedia({video:n,audio:i});l.current=o,u.current&&(u.current.srcObject=o)}catch{h.error("Could not access camera/mic")}})(),()=>{l.current?.getTracks().forEach(o=>o.stop())}),[]),a.useEffect(()=>{const o=l.current;o&&o.getVideoTracks().forEach(x=>{x.enabled=n})},[n]),a.useEffect(()=>{const o=l.current;o&&o.getAudioTracks().forEach(x=>{x.enabled=i})},[i]),e.jsxs("div",{className:"max-w-2xl mx-auto mt-8 space-y-6",children:[e.jsxs("button",{onClick:s,className:"flex items-center gap-1.5 text-sm text-slate-500 hover:text-slate-700",children:[e.jsx(p,{className:"w-4 h-4"})," Back to meetings"]}),e.jsxs(w,{className:"p-0 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-100",children:[e.jsx("h2",{className:"text-lg font-bold text-slate-900",children:t.title}),e.jsx("p",{className:"text-sm text-slate-500 mt-0.5",children:t.scheduled_at?`Scheduled for ${new Date(t.scheduled_at).toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"})}`:"Ready to start"})]}),e.jsxs("div",{className:"relative bg-slate-900 aspect-video",children:[e.jsx("video",{ref:u,autoPlay:!0,muted:!0,playsInline:!0,className:`w-full h-full object-cover ${n?"":"hidden"}`}),!n&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-20 h-20 rounded-full bg-slate-700 flex items-center justify-center text-white text-2xl font-bold",children:t.host?.name?.charAt(0)||"U"})})]}),e.jsxs("div",{className:"flex items-center justify-center gap-3 p-4 bg-slate-50",children:[e.jsx("button",{onClick:()=>c(!n),className:`p-3 rounded-full transition-colors ${n?"bg-slate-200 text-slate-700 hover:bg-slate-300":"bg-red-500 text-white"}`,children:n?e.jsx(g,{className:"w-5 h-5"}):e.jsx(M,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>f(!i),className:`p-3 rounded-full transition-colors ${i?"bg-slate-200 text-slate-700 hover:bg-slate-300":"bg-red-500 text-white"}`,children:i?e.jsx(C,{className:"w-5 h-5"}):e.jsx(E,{className:"w-5 h-5"})}),e.jsx("div",{className:"w-px h-8 bg-slate-300 mx-2"}),N?e.jsx(b,{variant:"shield",onClick:d,className:"px-6",children:"Start Meeting"}):e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-amber-400 animate-pulse"}),"Waiting for host to start..."]})]})]}),t.guest&&e.jsx(w,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(F,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{className:"font-medium",children:"Participants:"}),e.jsxs("span",{className:"text-slate-600",children:[t.host?.name," (Host)"]}),e.jsx("span",{className:"text-slate-400",children:"â€¢"}),e.jsx("span",{className:"text-slate-600",children:t.guest.name})]})})]})}function H({meeting:t,onEnd:r,onBack:d}){const[s,n]=a.useState(!0),[c,i]=a.useState(!0),[f,u]=a.useState(!1),[l,N]=a.useState("00:00"),o=a.useRef(null),x=a.useRef(null),v=a.useRef(null);a.useEffect(()=>((async()=>{try{const m=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});x.current=m,o.current&&(o.current.srcObject=m)}catch{h.error("Could not access camera/mic")}})(),()=>{x.current?.getTracks().forEach(m=>m.stop())}),[]),a.useEffect(()=>{const m=t.started_at?new Date(t.started_at).getTime():Date.now(),j=setInterval(()=>{const k=Math.floor((Date.now()-m)/1e3),S=Math.floor(k/60).toString().padStart(2,"0"),O=(k%60).toString().padStart(2,"0");N(`${S}:${O}`)},1e3);return()=>clearInterval(j)},[t.started_at]),a.useEffect(()=>{const m=x.current;m&&m.getVideoTracks().forEach(j=>{j.enabled=s})},[s]),a.useEffect(()=>{const m=x.current;m&&m.getAudioTracks().forEach(j=>{j.enabled=c})},[c]);const _=()=>{v.current&&(document.fullscreenElement?(document.exitFullscreen(),u(!1)):(v.current.requestFullscreen(),u(!0)))};return e.jsxs("div",{ref:v,className:"relative bg-slate-900 rounded-2xl overflow-hidden",style:{minHeight:"calc(100vh - 12rem)"},children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-slate-700 flex items-center justify-center text-white text-3xl font-bold mx-auto mb-4",children:t.guest?.name?.charAt(0)||"G"}),e.jsx("p",{className:"text-white text-lg font-medium",children:t.guest?.name||"Participant"}),e.jsx("p",{className:"text-slate-400 text-sm mt-1",children:"Connected"})]})}),e.jsxs("div",{className:"absolute bottom-20 right-4 w-48 rounded-xl overflow-hidden shadow-lg border-2 border-slate-700",children:[e.jsx("video",{ref:o,autoPlay:!0,muted:!0,playsInline:!0,className:`w-full aspect-video object-cover ${s?"":"hidden"}`}),!s&&e.jsx("div",{className:"w-full aspect-video bg-slate-800 flex items-center justify-center",children:e.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-600 flex items-center justify-center text-white text-sm font-bold",children:"You"})})]}),e.jsxs("div",{className:"absolute top-0 left-0 right-0 flex items-center justify-between px-6 py-3 bg-gradient-to-b from-black/60 to-transparent",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:d,className:"text-white/70 hover:text-white",children:e.jsx(p,{className:"w-5 h-5"})}),e.jsx("h3",{className:"text-white font-medium",children:t.title}),e.jsx(B,{variant:"success",children:"Live"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-white/80 text-sm",children:[e.jsx(L,{className:"w-4 h-4"}),l]})]}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-t from-black/60 to-transparent",children:[e.jsx("button",{onClick:()=>n(!s),className:`p-3 rounded-full transition-colors ${s?"bg-white/20 text-white hover:bg-white/30":"bg-red-500 text-white"}`,title:s?"Turn off camera":"Turn on camera",children:s?e.jsx(g,{className:"w-5 h-5"}):e.jsx(M,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>i(!c),className:`p-3 rounded-full transition-colors ${c?"bg-white/20 text-white hover:bg-white/30":"bg-red-500 text-white"}`,title:c?"Mute":"Unmute",children:c?e.jsx(C,{className:"w-5 h-5"}):e.jsx(E,{className:"w-5 h-5"})}),e.jsx("button",{className:"p-3 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors",title:"Screen share (coming soon)",children:e.jsx(V,{className:"w-5 h-5"})}),e.jsx("button",{className:"p-3 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors",title:"Chat (coming soon)",children:e.jsx(A,{className:"w-5 h-5"})}),e.jsx("button",{onClick:_,className:"p-3 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors",title:"Fullscreen",children:f?e.jsx(I,{className:"w-5 h-5"}):e.jsx(P,{className:"w-5 h-5"})}),e.jsx("div",{className:"w-px h-8 bg-white/20 mx-2"}),e.jsxs("button",{onClick:r,className:"px-5 py-3 rounded-full bg-red-500 text-white hover:bg-red-600 transition-colors flex items-center gap-2 font-medium",children:[e.jsx(U,{className:"w-5 h-5 rotate-[135deg]"})," End"]})]})]})}function q({meeting:t,onBack:r}){const d=()=>{t.external_url&&window.open(t.external_url,"_blank")},s=async()=>{t.external_url&&(await navigator.clipboard.writeText(t.external_url),h.success("Link copied"))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:r,className:"flex items-center gap-1.5 text-sm text-slate-500 hover:text-slate-700",children:[e.jsx(p,{className:"w-4 h-4"})," Back to meetings"]}),e.jsxs(w,{className:"p-0 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-slate-100",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-slate-900",children:t.title}),e.jsx("p",{className:"text-sm text-slate-500 mt-0.5",children:t.external_service?`via ${t.external_service}`:"External meeting"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(b,{variant:"ghost",size:"sm",onClick:s,children:[e.jsx(D,{className:"w-4 h-4 mr-1"})," Copy Link"]}),e.jsx(b,{variant:"shield",size:"sm",onClick:d,children:"Open in New Tab"})]})]}),t.external_url&&Y(t.external_url)?e.jsx("iframe",{src:t.external_url,className:"w-full border-0",style:{height:"calc(100vh - 16rem)"},allow:"camera; microphone; fullscreen; display-capture",title:"Video Meeting"}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx(g,{className:"w-16 h-16 text-slate-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-slate-900 mb-2",children:"External Meeting"}),e.jsxs("p",{className:"text-sm text-slate-500 mb-6 text-center max-w-md",children:["This meeting uses ",t.external_service||"an external service"," which cannot be embedded. Click below to open it in a new tab."]}),e.jsxs(b,{variant:"shield",onClick:d,children:["Open ",t.external_service||"Meeting"," in New Tab"]})]})]})]})}function W(t,r){const d=Math.floor((r.getTime()-t.getTime())/1e3);if(d<60)return`${d}s`;const s=Math.floor(d/60),n=d%60;return s<60?`${s}m ${n}s`:`${Math.floor(s/60)}h ${s%60}m`}function Y(t){try{const r=new URL(t).hostname.toLowerCase();return r.includes("jitsi")||r.includes("whereby")||r.includes("daily.co")}catch{return!1}}export{ee as default};
