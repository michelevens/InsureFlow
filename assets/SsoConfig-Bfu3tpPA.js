import{j as e}from"./vendor-query-D5ml2kdZ.js";import{r as a}from"./vendor-react-C8VcOkCS.js";import{u as F,I as A,B as I}from"./index-8sQqf4Gi.js";import{s as k}from"./sso-D1iXYhUc.js";import{a as $}from"./admin-C1yF50l3.js";import{a2 as E,a3 as M,F as P,aY as x,K as B,ai as z,a1 as G}from"./vendor-ui-tJ0aMxU9.js";function Q(){const{user:m}=F(),[c,u]=a.useState([]),[t,o]=a.useState(null),[O,L]=a.useState(!0),[h,n]=a.useState(!1),[i,l]=a.useState(null),[g,f]=a.useState(""),[p,b]=a.useState(""),[j,v]=a.useState(""),[y,N]=a.useState("agent");a.useEffect(()=>{U()},[]);const U=async()=>{try{const s=await $.getAgencies(),r=Array.isArray(s)?s:s.data||[];u(r),r.length===1&&S(r[0])}catch{m?.agency_id&&u([{id:m.agency_id,name:"My Agency",agency_code:""}])}finally{L(!1)}},S=s=>{o(s),f(s.saml_entity_id||""),b(s.saml_sso_url||""),v(s.saml_certificate||""),N(s.sso_default_role||"agent")},D=async()=>{if(t){n(!0),l(null);try{await k.configure({agency_id:t.id,saml_entity_id:g,saml_sso_url:p,saml_certificate:j,sso_default_role:y}),l({type:"success",text:"SSO configured successfully"}),o({...t,sso_enabled:!0})}catch(s){l({type:"error",text:s instanceof Error?s.message:"Failed to save"})}finally{n(!1)}}},R=async()=>{if(t){n(!0),l(null);try{await k.disable(t.id),l({type:"success",text:"SSO disabled"}),o({...t,sso_enabled:!1})}catch(s){l({type:"error",text:s instanceof Error?s.message:"Failed to disable"})}finally{n(!1)}}},w="http://localhost:8000/api",C=`${w}/sso/metadata`,_=t?`${w}/sso/acs/${t.agency_code?.toLowerCase()}`:"",d=s=>{navigator.clipboard.writeText(s),l({type:"success",text:"Copied to clipboard"}),setTimeout(()=>l(null),2e3)};return O?e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx("div",{className:"w-8 h-8 border-4 border-shield-200 border-t-shield-600 rounded-full animate-spin"})}):e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"SSO Configuration"}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Configure SAML 2.0 single sign-on for enterprise agencies"})]}),i&&e.jsxs("div",{className:`flex items-center gap-2 p-3 rounded-xl text-sm ${i.type==="success"?"bg-green-50 text-green-700":"bg-red-50 text-red-600"}`,children:[i.type==="success"?e.jsx(E,{className:"w-4 h-4"}):e.jsx(M,{className:"w-4 h-4"}),i.text]}),c.length>1&&e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Select Agency"}),e.jsxs("select",{value:t?.id||"",onChange:s=>{const r=c.find(T=>T.id===Number(s.target.value));r&&S(r)},className:"w-full px-4 py-2.5 rounded-xl border border-slate-200 focus:ring-2 focus:ring-shield-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Choose an agency..."}),c.map(s=>e.jsxs("option",{value:s.id,children:[s.name," ",s.sso_enabled?"(SSO Active)":""]},s.id))]})]}),t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(P,{className:"w-5 h-5 text-shield-600"}),e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Service Provider Details"})]}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"Provide these to your identity provider (Okta, Azure AD, OneLogin, etc.)"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-1",children:"SP Entity ID / Metadata URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("code",{className:"flex-1 px-3 py-2 bg-slate-50 rounded-lg text-sm text-slate-700 break-all",children:C}),e.jsx("button",{onClick:()=>d(C),className:"p-2 text-slate-400 hover:text-slate-600",children:e.jsx(x,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-1",children:"ACS URL (Assertion Consumer Service)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("code",{className:"flex-1 px-3 py-2 bg-slate-50 rounded-lg text-sm text-slate-700 break-all",children:_}),e.jsx("button",{onClick:()=>d(_),className:"p-2 text-slate-400 hover:text-slate-600",children:e.jsx(x,{className:"w-4 h-4"})})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(B,{className:"w-5 h-5 text-shield-600"}),e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Identity Provider Settings"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(A,{label:"IdP Entity ID",placeholder:"https://idp.example.com/metadata",value:g,onChange:s=>f(s.target.value),leftIcon:e.jsx(z,{className:"w-5 h-5"})}),e.jsx(A,{label:"SSO Login URL",placeholder:"https://idp.example.com/sso/saml",value:p,onChange:s=>b(s.target.value),leftIcon:e.jsx(G,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"X.509 Certificate"}),e.jsx("textarea",{value:j,onChange:s=>v(s.target.value),placeholder:`-----BEGIN CERTIFICATE-----
MIIDp...
-----END CERTIFICATE-----`,rows:6,className:"w-full px-4 py-2.5 rounded-xl border border-slate-200 focus:ring-2 focus:ring-shield-500 focus:border-transparent text-sm font-mono resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Default Role for SSO Users"}),e.jsxs("select",{value:y,onChange:s=>N(s.target.value),className:"w-full px-4 py-2.5 rounded-xl border border-slate-200 focus:ring-2 focus:ring-shield-500 focus:border-transparent",children:[e.jsx("option",{value:"agent",children:"Agent"}),e.jsx("option",{value:"agency_owner",children:"Agency Owner"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-6 pt-4 border-t border-slate-100",children:[e.jsx(I,{variant:"shield",onClick:D,isLoading:h,children:t.sso_enabled?"Update SSO Configuration":"Enable SSO"}),t.sso_enabled&&e.jsx(I,{variant:"danger",onClick:R,isLoading:h,children:"Disable SSO"})]})]}),t.sso_enabled&&e.jsxs("div",{className:"bg-green-50 rounded-2xl border border-green-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(E,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"font-semibold text-green-900",children:"SSO is Active"})]}),e.jsx("p",{className:"text-sm text-green-700 mb-3",children:"Your team can log in using the SSO URL below:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("code",{className:"flex-1 px-3 py-2 bg-white rounded-lg text-sm text-green-800 break-all",children:[window.location.origin,"/sso/login/",t.agency_code?.toLowerCase()]}),e.jsx("button",{onClick:()=>d(`${window.location.origin}/sso/login/${t.agency_code?.toLowerCase()}`),className:"p-2 text-green-500 hover:text-green-700",children:e.jsx(x,{className:"w-4 h-4"})})]})]})]})]})}export{Q as default};
