import{j as e}from"./vendor-query-D5ml2kdZ.js";import{r as c}from"./vendor-react-C8VcOkCS.js";import{ax as y,E as B,e as F,z as C,d as z,ad as x}from"./vendor-ui-tJ0aMxU9.js";import{b as a,B as p,C as f,I as b}from"./index-8sQqf4Gi.js";import{B as w}from"./Badge-CDix051U.js";import{M as E}from"./Modal-UQye4ZSv.js";function L(t){if(!t)return"";const l=Object.entries(t).filter(([,n])=>n!==void 0);return l.length?"?"+new URLSearchParams(l.map(([n,h])=>[n,String(h)])).toString():""}const N={list:t=>a.get(`/email/campaigns${L(t)}`),show:t=>a.get(`/email/campaigns/${t}`),create:t=>a.post("/email/campaigns",t),update:(t,l)=>a.put(`/email/campaigns/${t}`,l),destroy:t=>a.delete(`/email/campaigns/${t}`),send:t=>a.post(`/email/campaigns/${t}/send`),cancel:t=>a.post(`/email/campaigns/${t}/cancel`),analytics:t=>a.get(`/email/campaigns/${t}/analytics`),sends:t=>a.get(`/email/campaigns/${t}/sends`),templates:()=>a.get("/email/templates"),createTemplate:t=>a.post("/email/templates",t),updateTemplate:(t,l)=>a.put(`/email/templates/${t}`,l),deleteTemplate:t=>a.delete(`/email/templates/${t}`)},S={draft:"default",scheduled:"info",sending:"warning",sent:"success",cancelled:"danger"};function A(){const[t,l]=c.useState([]),[n,h]=c.useState(!0),[u,j]=c.useState(!1),[i,v]=c.useState(null),[d,m]=c.useState(null),g=async()=>{h(!0);try{const s=await N.list();l(s.data)}catch{x.error("Failed to load campaigns")}finally{h(!1)}};c.useEffect(()=>{g()},[]);const o=async s=>{if(v(s),s.status==="sent"||s.status==="sending")try{const r=await N.analytics(s.id);m(r)}catch{m(null)}else m(null)},k=async s=>{try{await N.send(s),x.success("Campaign sent successfully"),g()}catch{x.error("Failed to send campaign")}},_=async s=>{try{await N.destroy(s),x.success("Campaign deleted"),l(r=>r.filter($=>$.id!==s)),i?.id===s&&(v(null),m(null))}catch{x.error("Failed to delete campaign")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Email Campaigns"}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Create and send targeted email campaigns"})]}),e.jsxs(p,{variant:"shield",onClick:()=>j(!0),children:[e.jsx(y,{className:"w-4 h-4 mr-1"})," New Campaign"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-3",children:n?e.jsx(f,{className:"p-8 text-center",children:e.jsx("div",{className:"w-8 h-8 border-4 border-shield-200 border-t-shield-600 rounded-full animate-spin mx-auto"})}):t.length===0?e.jsxs(f,{className:"p-12 text-center",children:[e.jsx(B,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-500 mb-4",children:"No campaigns yet"}),e.jsxs(p,{variant:"shield",onClick:()=>j(!0),children:[e.jsx(y,{className:"w-4 h-4 mr-1"})," Create First Campaign"]})]}):t.map(s=>e.jsxs(f,{className:`p-4 cursor-pointer transition-all ${i?.id===s.id?"ring-2 ring-shield-500":"hover:shadow-md"}`,onClick:()=>o(s),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-900",children:s.name}),e.jsx("p",{className:"text-xs text-slate-500 mt-0.5",children:s.subject})]}),e.jsx(w,{variant:S[s.status],children:s.status})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-400",children:[s.sent_count>0&&e.jsxs("span",{children:["Sent: ",s.sent_count]}),s.open_count>0&&e.jsxs("span",{children:["Opens: ",s.open_count]}),s.click_count>0&&e.jsxs("span",{children:["Clicks: ",s.click_count]}),e.jsx("span",{children:new Date(s.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3 pt-2 border-t border-slate-100",children:[s.status==="draft"&&e.jsxs(p,{variant:"shield",size:"sm",onClick:r=>{r.stopPropagation(),k(s.id)},children:[e.jsx(F,{className:"w-3.5 h-3.5 mr-1"})," Send"]}),e.jsxs(p,{variant:"ghost",size:"sm",onClick:r=>{r.stopPropagation(),o(s)},children:[e.jsx(C,{className:"w-3.5 h-3.5 mr-1"})," Stats"]}),s.status==="draft"&&e.jsx(p,{variant:"ghost",size:"sm",onClick:r=>{r.stopPropagation(),_(s.id)},children:e.jsx(z,{className:"w-3.5 h-3.5 text-red-400"})})]})]},s.id))}),e.jsx("div",{children:i?e.jsxs(f,{className:"p-5 sticky top-4",children:[e.jsx("h3",{className:"font-bold text-slate-900 mb-1",children:i.name}),e.jsx(w,{variant:S[i.status],className:"mb-4",children:i.status}),d?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-3 text-center",children:[e.jsxs("p",{className:"text-lg font-bold text-shield-600",children:[(d.open_rate*100).toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Open Rate"})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-3 text-center",children:[e.jsxs("p",{className:"text-lg font-bold text-shield-600",children:[(d.click_rate*100).toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Click Rate"})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-3 text-center",children:[e.jsxs("p",{className:"text-lg font-bold text-red-500",children:[(d.bounce_rate*100).toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Bounce"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase mb-2",children:"Delivery Status"}),e.jsx("div",{className:"space-y-1",children:d.status_breakdown.map(s=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-slate-600 capitalize",children:s.status}),e.jsx("span",{className:"font-medium text-slate-900",children:s.count})]},s.status))})]})]}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-sm text-slate-400",children:i.status==="draft"?"Send campaign to see analytics":"Loading analytics..."})})]}):e.jsxs(f,{className:"p-8 text-center text-slate-400",children:[e.jsx(C,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Select a campaign to view analytics"})]})})]}),u&&e.jsx(R,{onClose:()=>j(!1),onCreated:()=>{g(),j(!1)}})]})}function R({onClose:t,onCreated:l}){const[n,h]=c.useState(""),[u,j]=c.useState(""),[i,v]=c.useState(""),[d,m]=c.useState(!1),g=async()=>{if(!(!n||!u)){m(!0);try{await N.create({name:n,subject:u,body_html:i}),x.success("Campaign created successfully"),l()}catch{x.error("Failed to create campaign")}finally{m(!1)}}};return e.jsx(E,{isOpen:!0,onClose:t,title:"New Campaign",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{label:"Campaign Name",placeholder:"Spring Renewal Reminder",value:n,onChange:o=>h(o.target.value)}),e.jsx(b,{label:"Subject Line",placeholder:"Your policy renewal is coming up",value:u,onChange:o=>j(o.target.value)}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 block mb-1",children:"Email Body (HTML)"}),e.jsx("textarea",{value:i,onChange:o=>v(o.target.value),className:"w-full h-32 text-sm font-mono border border-slate-200 rounded-lg p-3 focus:ring-2 focus:ring-shield-500 focus:border-shield-500",placeholder:"<h1>Hello {{name}}</h1><p>Your policy renewal...</p>"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(p,{variant:"ghost",onClick:t,children:"Cancel"}),e.jsx(p,{variant:"shield",onClick:g,disabled:d||!n||!u,children:d?"Creating...":"Create Campaign"})]})]})})}export{A as default};
