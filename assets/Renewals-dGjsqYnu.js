import{j as e}from"./vendor-query-D5ml2kdZ.js";import{r as i}from"./vendor-react-C8VcOkCS.js";import{b as d}from"./index-BZEM9EbM.js";import{B as y}from"./Badge-8fS5vckW.js";import{m as h,t as C,T as D,as as k,L,R as w,D as U,ar as F,a2 as M,a3 as q,aD as A}from"./vendor-ui-tJ0aMxU9.js";const p={async getRenewals(t){const a=new URLSearchParams;t?.status&&a.set("status",t.status),t?.days&&a.set("days",String(t.days)),t?.upcoming_only!==void 0&&a.set("upcoming_only",String(t.upcoming_only)),t?.sort&&a.set("sort",t.sort),t?.dir&&a.set("dir",t.dir),t?.page&&a.set("page",String(t.page));const l=a.toString();return d.get(`/renewals${l?`?${l}`:""}`)},async getDashboard(){return d.get("/renewals/dashboard")},async getRenewal(t){return d.get(`/renewals/${t}`)},async updateStatus(t,a){return d.put(`/renewals/${t}/status`,a)}},j={upcoming:{variant:"info",label:"Upcoming"},contacted:{variant:"shield",label:"Contacted"},requoted:{variant:"warning",label:"Requoted"},renewed:{variant:"success",label:"Renewed"},lost:{variant:"danger",label:"Lost"},expired:{variant:"outline",label:"Expired"}};function o({label:t,value:a,icon:l,color:x}){return e.jsx("div",{className:"bg-white rounded-2xl border border-slate-200 p-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500",children:t}),e.jsx("p",{className:"text-2xl font-bold text-slate-900 mt-1",children:a})]}),e.jsx("div",{className:`w-10 h-10 rounded-xl ${x} flex items-center justify-center`,children:e.jsx(l,{className:"w-5 h-5"})})]})})}function O(){const[t,a]=i.useState([]),[l,x]=i.useState(null),[_,b]=i.useState(!0),[r,S]=i.useState(""),[u,R]=i.useState(90),[m,f]=i.useState(null),N=async()=>{b(!0);try{const[s,n]=await Promise.all([p.getRenewals({status:r||void 0,days:u,upcoming_only:!r||["upcoming","contacted","requoted"].includes(r)}),p.getDashboard()]);a(s.data),x(n)}catch{}b(!1)};i.useEffect(()=>{N()},[r,u]);const g=async(s,n)=>{f(s);try{await p.updateStatus(s,{status:n}),N()}catch{}f(null)},$=s=>Math.ceil((new Date(s).getTime()-Date.now())/864e5);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Renewals"}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Manage policy renewals and retain clients"})]}),l&&e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(o,{label:"Due in 30 days",value:l.upcoming_30,icon:h,color:"bg-red-50 text-red-600"}),e.jsx(o,{label:"Due in 60 days",value:l.upcoming_60,icon:h,color:"bg-amber-50 text-amber-600"}),e.jsx(o,{label:"At Risk",value:l.at_risk,icon:C,color:"bg-orange-50 text-orange-600"}),e.jsx(o,{label:"Retention Rate",value:l.retention_rate!==null?`${l.retention_rate}%`:"N/A",icon:D,color:"bg-green-50 text-green-600"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4 text-slate-400"}),e.jsxs("select",{value:r,onChange:s=>S(s.target.value),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-shield-500",children:[e.jsx("option",{value:"",children:"All Statuses"}),Object.entries(j).map(([s,n])=>e.jsx("option",{value:s,children:n.label},s))]})]}),e.jsxs("select",{value:u,onChange:s=>R(Number(s.target.value)),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-shield-500",children:[e.jsx("option",{value:30,children:"Next 30 days"}),e.jsx("option",{value:60,children:"Next 60 days"}),e.jsx("option",{value:90,children:"Next 90 days"}),e.jsx("option",{value:180,children:"Next 6 months"}),e.jsx("option",{value:365,children:"Next year"})]})]}),_?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(L,{className:"w-6 h-6 animate-spin text-slate-400"})}):t.length===0?e.jsxs("div",{className:"text-center py-16 bg-white rounded-2xl border border-slate-200",children:[e.jsx(w,{className:"w-10 h-10 text-slate-300 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-500 font-medium",children:"No renewals found"}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Renewal opportunities appear as policies near expiration"})]}):e.jsx("div",{className:"space-y-3",children:t.map(s=>{const n=$(s.renewal_date),v=j[s.status]||j.upcoming,c=n<=14&&!["renewed","lost"].includes(s.status);return e.jsxs("div",{className:`bg-white rounded-2xl border p-5 transition-all ${c?"border-red-200 bg-red-50/30":"border-slate-200 hover:border-shield-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${c?"bg-red-100":"bg-slate-100"}`,children:e.jsx(w,{className:`w-5 h-5 ${c?"text-red-500":"text-slate-500"}`})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold text-slate-900",children:s.policy?.policy_number||`Policy #${s.policy_id}`}),e.jsx(y,{variant:v.variant,children:v.label}),c&&e.jsx(y,{variant:"danger",children:"Urgent"})]}),e.jsxs("p",{className:"text-sm text-slate-500 mt-0.5",children:[s.consumer?.name," · ",s.policy?.insurance_type?.replace(/_/g," ")]})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-right hidden sm:block",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm text-slate-500",children:[e.jsx(h,{className:"w-3.5 h-3.5"}),new Date(s.renewal_date).toLocaleDateString(),e.jsxs("span",{className:`ml-1 font-medium ${n<=14?"text-red-600":n<=30?"text-amber-600":"text-slate-600"}`,children:["(",n,"d)"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm mt-0.5",children:[e.jsx(U,{className:"w-3.5 h-3.5 text-slate-400"}),e.jsxs("span",{className:"text-slate-700 font-medium",children:["$",Number(s.current_premium).toLocaleString()]}),s.best_new_premium&&e.jsxs("span",{className:"text-green-600 ml-1",children:["→ $",Number(s.best_new_premium).toLocaleString()]})]})]}),!["renewed","lost","expired"].includes(s.status)&&e.jsxs("div",{className:"flex gap-1",children:[s.status==="upcoming"&&e.jsx("button",{onClick:()=>g(s.id,"contacted"),disabled:m===s.id,className:"p-2 rounded-lg hover:bg-blue-50 text-blue-600",title:"Mark as contacted",children:e.jsx(F,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>g(s.id,"renewed"),disabled:m===s.id,className:"p-2 rounded-lg hover:bg-green-50 text-green-600",title:"Mark as renewed",children:e.jsx(M,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>g(s.id,"lost"),disabled:m===s.id,className:"p-2 rounded-lg hover:bg-red-50 text-red-600",title:"Mark as lost",children:e.jsx(q,{className:"w-4 h-4"})})]}),e.jsx(A,{className:"w-5 h-5 text-slate-300"})]})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[e.jsx("span",{className:"text-xs text-slate-400",children:"Retention"}),e.jsx("div",{className:"flex-1 h-1.5 bg-slate-100 rounded-full",children:e.jsx("div",{className:`h-full rounded-full transition-all ${s.retention_score>=70?"bg-green-500":s.retention_score>=40?"bg-amber-500":"bg-red-500"}`,style:{width:`${s.retention_score}%`}})}),e.jsxs("span",{className:`text-xs font-medium ${s.retention_score>=70?"text-green-600":s.retention_score>=40?"text-amber-600":"text-red-600"}`,children:[s.retention_score,"%"]})]})]},s.id)})})]})}export{O as default};
