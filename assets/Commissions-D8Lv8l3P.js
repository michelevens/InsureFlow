import{j as e}from"./vendor-query-D5ml2kdZ.js";import{r as s}from"./vendor-react-C8VcOkCS.js";import{b as c,u as O,S as Y,B as p,C as o}from"./index-8sQqf4Gi.js";import{B as P}from"./Badge-CDix051U.js";import{D as g,Y as z,aK as K,af as G,a2 as I,aL as k,T as J,m as M,L as Q,a6 as V,ad as W}from"./vendor-ui-tJ0aMxU9.js";const n={createConnectAccount(){return c.post("/payouts/connect-account")},getConnectStatus(){return c.get("/payouts/connect-status")},refreshConnectLink(){return c.post("/payouts/connect-refresh")},requestPayout(){return c.post("/payouts/request")},getPayoutHistory(l=1){return c.get(`/payouts/history?page=${l}`)},getCommissions(l){const d=l?.status?`?status=${l.status}`:"";return c.get(`/commissions${d}`)}},h={paid:{label:"Paid",variant:"success"},pending:{label:"Pending",variant:"warning"},cancelled:{label:"Cancelled",variant:"danger"},completed:{label:"Completed",variant:"success"},processing:{label:"Processing",variant:"info"},failed:{label:"Failed",variant:"danger"}};function ae(){const{user:l}=O(),[d,j]=s.useState([]),[f,y]=s.useState([]),[i,F]=s.useState(null),[L,$]=s.useState(!0),[m,A]=s.useState(""),[D,x]=s.useState(!1),[R,N]=s.useState(!1),[u,b]=s.useState("commissions"),[E,v]=s.useState("0.00"),[T,w]=s.useState("0.00"),[C,S]=s.useState("0.00"),r=l?.role==="agent"||l?.role==="agency_owner";s.useEffect(()=>{(async()=>{try{const[a,U]=await Promise.all([n.getCommissions({status:m||void 0}),r?n.getPayoutHistory():Promise.resolve({data:[],last_page:1,current_page:1,total:0})]);j(a.commissions||[]),v(a.summary?.total_earned||"0.00"),w(a.summary?.total_paid||"0.00"),S(a.summary?.total_pending||"0.00"),y(U.data||[])}catch{W.error("Failed to load commissions")}finally{$(!1)}})()},[m,r]),s.useEffect(()=>{r&&n.getConnectStatus().then(F).catch(()=>{})},[r]);const q=async()=>{x(!0);try{const t=await n.createConnectAccount();window.location.href=t.url}catch{x(!1)}},B=async()=>{x(!0);try{const t=await n.refreshConnectLink();window.location.href=t.url}catch{x(!1)}},H=async()=>{if(confirm("Request payout for all pending commissions?")){N(!0);try{await n.requestPayout();const[t,a]=await Promise.all([n.getCommissions({status:m||void 0}),n.getPayoutHistory()]);j(t.commissions||[]),v(t.summary?.total_earned||"0.00"),w(t.summary?.total_paid||"0.00"),S(t.summary?.total_pending||"0.00"),y(a.data||[])}catch{}finally{N(!1)}}},_=parseFloat(C);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-900 flex items-center gap-3",children:[e.jsx(g,{className:"w-6 h-6 text-teal-600"}),"Commissions"]}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Track your earnings and commission payouts"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Y,{options:[{value:"",label:"All Statuses"},{value:"pending",label:"Pending"},{value:"paid",label:"Paid"},{value:"cancelled",label:"Cancelled"}],value:m,onChange:t=>A(t.target.value)}),e.jsxs(p,{variant:"outline",size:"sm",children:[e.jsx(z,{className:"w-4 h-4 mr-2"})," Export"]})]})]}),r&&i&&!i.stripe_onboarded&&e.jsx("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 border border-indigo-200 rounded-xl p-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-100 rounded-xl flex items-center justify-center",children:e.jsx(K,{className:"w-5 h-5 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-indigo-900",children:i.stripe_account_id?"Complete Stripe Onboarding":"Connect Your Bank Account"}),e.jsx("p",{className:"text-sm text-indigo-700",children:i.stripe_account_id?"Finish setting up your Stripe account to receive commission payouts.":"Set up Stripe Connect to receive commission payouts directly to your bank account."})]})]}),e.jsxs(p,{variant:"shield",onClick:i.stripe_account_id?B:q,isLoading:D,children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),i.stripe_account_id?"Continue Setup":"Connect Stripe"]})]})}),r&&i?.stripe_onboarded&&e.jsxs("div",{className:"bg-savings-50 border border-savings-200 rounded-xl p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{className:"w-5 h-5 text-savings-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-savings-900",children:"Stripe Connected"}),e.jsxs("p",{className:"text-xs text-savings-700",children:["Account ",i.stripe_account_id?.slice(-8)," — Payouts enabled"]})]})]}),_>0&&e.jsxs(p,{variant:"shield",onClick:H,isLoading:R,children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Request Payout ($",_.toFixed(2),")"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Total Earned"}),e.jsxs("p",{className:"text-3xl font-bold text-slate-900",children:["$",parseFloat(E).toLocaleString("en-US",{minimumFractionDigits:2})]})]}),e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-shield-100 text-shield-600 flex items-center justify-center",children:e.jsx(g,{className:"w-6 h-6"})})]})}),e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Paid Out"}),e.jsxs("p",{className:"text-3xl font-bold text-savings-600",children:["$",parseFloat(T).toLocaleString("en-US",{minimumFractionDigits:2})]})]}),e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-savings-100 text-savings-600 flex items-center justify-center",children:e.jsx(J,{className:"w-6 h-6"})})]})}),e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Pending"}),e.jsxs("p",{className:"text-3xl font-bold text-amber-600",children:["$",parseFloat(C).toLocaleString("en-US",{minimumFractionDigits:2})]})]}),e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-amber-100 text-amber-600 flex items-center justify-center",children:e.jsx(M,{className:"w-6 h-6"})})]})})]}),r&&e.jsxs("div",{className:"flex gap-1 bg-slate-100 rounded-lg p-1 w-fit",children:[e.jsx("button",{onClick:()=>b("commissions"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${u==="commissions"?"bg-white text-slate-900 shadow-sm":"text-slate-600 hover:text-slate-900"}`,children:"Commissions"}),e.jsx("button",{onClick:()=>b("payouts"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${u==="payouts"?"bg-white text-slate-900 shadow-sm":"text-slate-600 hover:text-slate-900"}`,children:"Payout History"})]}),u==="commissions"&&e.jsx(o,{children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Commission History"}),L?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Q,{className:"w-6 h-6 text-teal-600 animate-spin"})}):d.length===0?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(g,{className:"w-10 h-10 text-slate-300 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-600 font-medium",children:"No commissions yet"}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Commissions will appear here when policies are bound"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-100",children:[e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider pb-3",children:"Policy"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider pb-3 hidden sm:table-cell",children:"Client"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider pb-3 hidden md:table-cell",children:"Carrier"}),e.jsx("th",{className:"text-right text-xs font-medium text-slate-500 uppercase tracking-wider pb-3",children:"Premium"}),e.jsx("th",{className:"text-right text-xs font-medium text-slate-500 uppercase tracking-wider pb-3",children:"Rate"}),e.jsx("th",{className:"text-right text-xs font-medium text-slate-500 uppercase tracking-wider pb-3",children:"Commission"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider pb-3",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-50",children:d.map(t=>{const a=h[t.status]||h.pending;return e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"py-3 font-mono text-sm text-shield-600",children:t.policy?.policy_number||`#${t.policy_id}`}),e.jsx("td",{className:"py-3 text-sm font-medium text-slate-900 hidden sm:table-cell",children:t.policy?.user?.name||"—"}),e.jsx("td",{className:"py-3 text-sm text-slate-700 hidden md:table-cell",children:t.carrier_name}),e.jsxs("td",{className:"py-3 text-right text-sm text-slate-700",children:["$",parseFloat(t.premium_amount).toLocaleString()]}),e.jsxs("td",{className:"py-3 text-right text-sm text-slate-700",children:[t.commission_rate,"%"]}),e.jsxs("td",{className:"py-3 text-right text-sm font-medium text-savings-600",children:["$",parseFloat(t.commission_amount).toFixed(2)]}),e.jsx("td",{className:"py-3",children:e.jsx(P,{variant:a.variant,children:a.label})})]},t.id)})})]})})]})}),u==="payouts"&&e.jsx(o,{children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Payout History"}),f.length===0?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(k,{className:"w-10 h-10 text-slate-300 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-600 font-medium",children:"No payouts yet"}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Request a payout when you have pending commissions"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-100",children:[e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider pb-3",children:"Date"}),e.jsx("th",{className:"text-right text-xs font-medium text-slate-500 uppercase tracking-wider pb-3",children:"Amount"}),e.jsx("th",{className:"text-right text-xs font-medium text-slate-500 uppercase tracking-wider pb-3 hidden sm:table-cell",children:"Platform Fee"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider pb-3 hidden md:table-cell",children:"Period"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider pb-3",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-50",children:f.map(t=>{const a=h[t.status]||h.pending;return e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"py-3 text-sm text-slate-700",children:new Date(t.created_at).toLocaleDateString()}),e.jsxs("td",{className:"py-3 text-right text-sm font-medium text-savings-600",children:["$",parseFloat(t.amount).toFixed(2)]}),e.jsxs("td",{className:"py-3 text-right text-sm text-slate-500 hidden sm:table-cell",children:["$",parseFloat(t.platform_fee).toFixed(2)]}),e.jsx("td",{className:"py-3 text-sm text-slate-500 hidden md:table-cell",children:t.period_start&&t.period_end?`${t.period_start} — ${t.period_end}`:"—"}),e.jsxs("td",{className:"py-3",children:[e.jsx(P,{variant:a.variant,children:a.label}),t.status==="failed"&&t.failure_reason&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(V,{className:"w-3 h-3 text-red-500"}),e.jsx("span",{className:"text-xs text-red-600",children:t.failure_reason})]})]})]},t.id)})})]})})]})})]})}export{ae as default};
