import{j as e}from"./vendor-query-D5ml2kdZ.js";import{r as l}from"./vendor-react-C8VcOkCS.js";import{B as w,C as r,I as B}from"./index-8sQqf4Gi.js";import{B as f}from"./Badge-CDix051U.js";import{m as d}from"./marketplace-CSbNM9Sw.js";import{ad as i,R,ae as D,aq as E,v as H,aw as O,a8 as I,w as z,an as G,T as W,ar as U,E as q,D as V}from"./vendor-ui-tJ0aMxU9.js";const X={A:"success",B:"success",C:"warning",D:"danger",F:"danger"},Y=[{value:"newest",label:"Newest First"},{value:"price_asc",label:"Price: Low → High"},{value:"price_desc",label:"Price: High → Low"},{value:"score_desc",label:"Best Score"}];function le(){const[a,o]=l.useState("browse"),[n,N]=l.useState([]),[h,p]=l.useState([]),[t,C]=l.useState(null),[_,x]=l.useState(!0),[k,L]=l.useState(null),[v,T]=l.useState(""),[g,$]=l.useState(""),[y,F]=l.useState(""),[b,P]=l.useState("newest"),u=l.useCallback(async()=>{x(!0);try{const s=await d.browseLeads({insurance_type:g||void 0,state:y||void 0,sort:b});N(s.data)}catch{i.error("Failed to load marketplace listings")}finally{x(!1)}},[g,y,b]),j=l.useCallback(async()=>{x(!0);try{const s=await d.myListings();p(s.data)}catch{i.error("Failed to load your listings")}finally{x(!1)}},[]),m=l.useCallback(async()=>{try{const s=await d.leadMarketplaceStats();C(s)}catch{}},[]);l.useEffect(()=>{m()},[m]),l.useEffect(()=>{a==="browse"?u():a==="my-listings"?j():x(!1)},[a,u,j]);const A=async s=>{if(confirm(`Purchase this ${s.insurance_type} lead for $${s.asking_price}?`)){L(s.id);try{const c=await d.purchaseLead(s.id);i.success(`Lead purchased! ${c.lead.first_name} ${c.lead.last_name} — check your CRM.`),u(),m()}catch{i.error("Purchase failed. The listing may no longer be available.")}finally{L(null)}}},M=async s=>{try{await d.withdrawListing(s),i.success("Listing withdrawn"),j(),m()}catch{i.error("Failed to withdraw listing")}},S=n.filter(s=>{if(!v)return!0;const c=v.toLowerCase();return s.insurance_type.toLowerCase().includes(c)||s.state?.toLowerCase().includes(c)||s.seller_agency?.name?.toLowerCase().includes(c)});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Lead Marketplace"}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Buy and sell insurance leads across the platform"})]}),e.jsxs(w,{variant:"ghost",size:"sm",onClick:()=>{m(),a==="browse"?u():j()},children:[e.jsx(R,{className:"w-4 h-4 mr-1"})," Refresh"]})]}),t&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(r,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-shield-600",children:t.marketplace.total_active_listings}),e.jsx("p",{className:"text-xs text-slate-500",children:"Active Listings"})]}),e.jsxs(r,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-savings-600",children:t.buyer.total_purchased}),e.jsx("p",{className:"text-xs text-slate-500",children:"Leads Purchased"})]}),e.jsxs(r,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-amber-600",children:t.seller.total_sold}),e.jsx("p",{className:"text-xs text-slate-500",children:"Leads Sold"})]}),e.jsxs(r,{className:"p-4 text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-slate-700",children:["$",t.seller.total_revenue.toFixed(2)]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Seller Revenue"})]})]}),e.jsx("div",{className:"flex gap-1 border-b border-slate-200",children:[["browse","Browse Leads"],["my-listings","My Listings"],["transactions","Transactions"]].map(([s,c])=>e.jsx("button",{onClick:()=>o(s),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${a===s?"border-shield-500 text-shield-600":"border-transparent text-slate-500 hover:text-slate-700"}`,children:c},s))}),a==="browse"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(D,{className:"absolute left-3 top-2.5 w-4 h-4 text-slate-400"}),e.jsx(B,{className:"pl-9",placeholder:"Search by type, state, or agency...",value:v,onChange:s=>T(s.target.value)})]}),e.jsxs("select",{value:g,onChange:s=>$(s.target.value),className:"px-3 py-2 border border-slate-300 rounded-lg text-sm",children:[e.jsx("option",{value:"",children:"All Types"}),["Auto","Home","Life - Term","Life - Whole","Health","Commercial GL","Workers Comp","Medicare","LTC"].map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:y,onChange:s=>F(s.target.value),className:"px-3 py-2 border border-slate-300 rounded-lg text-sm",children:[e.jsx("option",{value:"",children:"All States"}),["FL","TX","CA","NY","GA","IL","VA","AZ","OH","PA","NC","MI"].map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(E,{className:"w-4 h-4 text-slate-400"}),e.jsx("select",{value:b,onChange:s=>P(s.target.value),className:"px-3 py-2 border border-slate-300 rounded-lg text-sm",children:Y.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]})]}),_?e.jsx("div",{className:"text-center py-12 text-slate-400",children:"Loading marketplace..."}):S.length===0?e.jsxs(r,{className:"p-12 text-center",children:[e.jsx(H,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-500 font-medium",children:"No leads available"}),e.jsx("p",{className:"text-slate-400 text-sm mt-1",children:"Check back later or adjust your filters"})]}):e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:S.map(s=>e.jsx(Z,{listing:s,onPurchase:()=>A(s),purchasing:k===s.id},s.id))})]}),a==="my-listings"&&(_?e.jsx("div",{className:"text-center py-12 text-slate-400",children:"Loading..."}):h.length===0?e.jsxs(r,{className:"p-12 text-center",children:[e.jsx(O,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-500 font-medium",children:"No listings yet"}),e.jsx("p",{className:"text-slate-400 text-sm mt-1",children:"List leads from your CRM to sell them on the marketplace"})]}):e.jsx("div",{className:"space-y-3",children:h.map(s=>e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(f,{variant:s.status==="active"?"success":s.status==="sold"?"default":"warning",children:s.status}),e.jsx("span",{className:"font-medium text-slate-900",children:s.insurance_type}),s.state&&e.jsx("span",{className:"text-slate-500 text-sm",children:s.state}),e.jsxs("span",{className:"text-shield-600 font-bold",children:["$",s.asking_price]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="sold"&&s.transaction&&e.jsxs("span",{className:"text-sm text-savings-600 font-medium",children:["Sold — payout $",s.transaction.seller_payout]}),s.status==="active"&&e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>M(s.id),children:"Withdraw"})]})]})},s.id))})),a==="transactions"&&e.jsx(J,{})]})}function Z({listing:a,onPurchase:o,purchasing:n}){return e.jsxs(r,{className:"p-5 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{children:a.insurance_type}),a.lead_grade&&e.jsxs(f,{variant:X[a.lead_grade]||"default",children:["Grade ",a.lead_grade]})]}),e.jsxs("span",{className:"text-xl font-bold text-shield-600",children:["$",a.asking_price]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm mb-4",children:[a.state&&e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-600",children:[e.jsx(I,{className:"w-3.5 h-3.5"})," ",a.state," ",a.zip_prefix&&`(${a.zip_prefix}xx)`]}),a.lead_score!==null&&e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-600",children:[e.jsx(z,{className:"w-3.5 h-3.5"})," Score: ",a.lead_score,"/100"]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-600",children:[e.jsx(G,{className:"w-3.5 h-3.5"})," ",a.days_old,"d old"]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-600",children:[e.jsx(W,{className:"w-3.5 h-3.5"})," ",a.coverage_level||"Standard"]}),a.has_phone&&e.jsxs("div",{className:"flex items-center gap-1.5 text-savings-600",children:[e.jsx(U,{className:"w-3.5 h-3.5"})," Has phone"]}),a.has_email&&e.jsxs("div",{className:"flex items-center gap-1.5 text-savings-600",children:[e.jsx(q,{className:"w-3.5 h-3.5"})," Has email"]})]}),a.seller_notes&&e.jsx("p",{className:"text-xs text-slate-500 mb-3 italic",children:a.seller_notes}),a.seller_agency&&e.jsxs("p",{className:"text-xs text-slate-400 mb-3",children:["From: ",a.seller_agency.name]}),e.jsxs(w,{className:"w-full",onClick:o,disabled:n,children:[e.jsx(V,{className:"w-4 h-4 mr-1"}),n?"Purchasing...":`Buy Lead — $${a.asking_price}`]})]})}function J(){const[a,o]=l.useState("all"),[n,N]=l.useState([]),[h,p]=l.useState(!0);return l.useEffect(()=>{p(!0),d.leadMarketplaceTransactions(a==="all"?void 0:a).then(t=>N(t.data)).catch(()=>i.error("Failed to load transactions")).finally(()=>p(!1))},[a]),h?e.jsx("div",{className:"text-center py-12 text-slate-400",children:"Loading transactions..."}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-2",children:["all","bought","sold"].map(t=>e.jsx("button",{onClick:()=>o(t),className:`px-3 py-1.5 text-sm rounded-lg ${a===t?"bg-shield-100 text-shield-700 font-medium":"text-slate-500 hover:bg-slate-100"}`,children:t.charAt(0).toUpperCase()+t.slice(1)},t))}),n.length===0?e.jsx(r,{className:"p-8 text-center",children:e.jsx("p",{className:"text-slate-500",children:"No transactions yet"})}):e.jsx("div",{className:"space-y-2",children:n.map(t=>e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(f,{variant:t.direction==="bought"?"default":"success",children:t.direction==="bought"?"Purchased":"Sold"}),e.jsx("span",{className:"font-medium",children:t.listing?.insurance_type||"Lead"}),t.listing?.state&&e.jsx("span",{className:"text-slate-500 text-sm",children:t.listing.state})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:`font-bold ${t.direction==="bought"?"text-red-600":"text-savings-600"}`,children:t.direction==="bought"?`-$${t.purchase_price}`:`+$${t.seller_payout}`}),e.jsx("p",{className:"text-xs text-slate-400",children:new Date(t.created_at).toLocaleDateString()})]})]})},t.id))})]})}export{le as default};
