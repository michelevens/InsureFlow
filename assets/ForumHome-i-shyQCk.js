import{j as e}from"./vendor-query-D5ml2kdZ.js";import{r as a}from"./vendor-react-C8VcOkCS.js";import{ad as r,ax as q,aD as W,b6 as F,A as P,b7 as z,a5 as D,aM as H,a2 as I}from"./vendor-ui-tJ0aMxU9.js";import{b as x,B as w,C as n,I as O}from"./index-CyWO3JYX.js";import{B as U}from"./Badge-DV1ZXp4T.js";import{M as G}from"./Modal-DcuIoT0D.js";const m={getCategories:()=>x.get("/forum/categories"),getTopics:(t,l=1)=>x.get(`/forum/categories/${t}/topics?page=${l}`),getTopic:t=>x.get(`/forum/topics/${t}`),createTopic:t=>x.post("/forum/topics",t),createPost:(t,l)=>x.post(`/forum/topics/${t}/posts`,l),vote:(t,l)=>x.post(`/forum/posts/${t}/vote`,{type:l}),markSolution:t=>x.put(`/forum/posts/${t}/solution`)};function se(){const[t,l]=a.useState("categories"),[j,h]=a.useState([]),[N,o]=a.useState([]),[u,p]=a.useState(null),[i,v]=a.useState(null),[d,g]=a.useState([]),[M,f]=a.useState(!0),[$,C]=a.useState(!1),[y,k]=a.useState(""),[T,_]=a.useState(!1);a.useEffect(()=>{m.getCategories().then(h).catch(()=>{r.error("Failed to load forum categories")}).finally(()=>f(!1))},[]);const R=async s=>{p(s),l("topics"),f(!0);try{const c=await m.getTopics(s.slug);o(c.data)}catch{o([])}finally{f(!1)}},L=async s=>{f(!0);try{const c=await m.getTopic(s.slug);v(c.topic),g(c.posts),l("topic")}catch{r.error("Failed to load topic")}finally{f(!1)}},A=async()=>{if(!(!i||!y.trim())){_(!0);try{const s=await m.createPost(i.id,{content:y});g(c=>[...c,s]),k(""),r.success("Reply posted successfully")}catch{r.error("Failed to post reply")}finally{_(!1)}}},E=async s=>{try{const c=await m.vote(s,"upvote");g(b=>b.map(S=>S.id===s?{...S,upvote_count:c.upvote_count}:S)),r.success("Vote recorded")}catch{r.error("Failed to register vote")}},V=async s=>{try{await m.markSolution(s),g(c=>c.map(b=>({...b,is_solution:b.id===s}))),r.success("Post marked as solution")}catch{r.error("Failed to mark post as solution")}},B=()=>{t==="topic"?(l("topics"),v(null),g([])):t==="topics"&&(l("categories"),p(null))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Community Forum"}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Connect, share knowledge, and learn from peers"})]}),t==="topics"&&e.jsxs(w,{variant:"shield",onClick:()=>C(!0),children:[e.jsx(q,{className:"w-4 h-4 mr-1"})," New Topic"]})]}),M?e.jsx(n,{className:"p-8 text-center",children:e.jsx("div",{className:"w-8 h-8 border-4 border-shield-200 border-t-shield-600 rounded-full animate-spin mx-auto"})}):t==="categories"?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[j.map(s=>e.jsx(n,{className:"p-5 cursor-pointer hover:shadow-md transition-all group",onClick:()=>R(s),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-shield-50 flex items-center justify-center text-lg",children:s.icon||"ðŸ’¬"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-900 group-hover:text-shield-600 transition-colors",children:s.name}),s.description&&e.jsx("p",{className:"text-xs text-slate-500 mt-0.5",children:s.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-slate-400",children:[s.topic_count," topics"]}),e.jsx(W,{className:"w-4 h-4 text-slate-300"})]})]})},s.id)),j.length===0&&e.jsxs(n,{className:"p-12 text-center col-span-2",children:[e.jsx(F,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-500",children:"Forum is being set up"})]})]}):t==="topics"?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:B,className:"flex items-center gap-1 text-sm text-shield-600 hover:text-shield-700",children:[e.jsx(P,{className:"w-4 h-4"})," Back to categories"]}),u&&e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:u.name}),N.map(s=>e.jsx(n,{className:"p-4 cursor-pointer hover:shadow-md transition-all",onClick:()=>L(s),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.is_pinned&&e.jsx(z,{className:"w-3.5 h-3.5 text-amber-500"}),e.jsx("h3",{className:"font-medium text-slate-900",children:s.title})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["by ",s.author_name," â€¢ ",new Date(s.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(F,{className:"w-3 h-3"})," ",s.reply_count]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"w-3 h-3"})," ",s.view_count]})]})]})},s.id)),N.length===0&&e.jsx(n,{className:"p-8 text-center",children:e.jsx("p",{className:"text-slate-400",children:"No topics yet. Start the conversation!"})})]}):t==="topic"&&i?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:B,className:"flex items-center gap-1 text-sm text-shield-600 hover:text-shield-700",children:[e.jsx(P,{className:"w-4 h-4"})," Back to topics"]}),e.jsxs(n,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-2",children:i.title}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-500 mb-4",children:[e.jsxs("span",{children:["by ",i.author_name]}),e.jsx("span",{children:new Date(i.created_at).toLocaleDateString()}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"w-3.5 h-3.5"})," ",i.view_count]})]}),e.jsx("div",{className:"text-sm text-slate-700 whitespace-pre-wrap",children:i.body})]}),d.map(s=>e.jsx(n,{className:`p-5 ${s.is_solution?"border-green-200 bg-green-50/30":""}`,children:e.jsx("div",{className:"flex items-start gap-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-medium text-slate-900 text-sm",children:s.author_name}),e.jsx("span",{className:"text-xs text-slate-400",children:new Date(s.created_at).toLocaleDateString()}),s.is_solution&&e.jsx(U,{variant:"success",children:"Solution"})]}),e.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-wrap",children:s.content}),e.jsxs("div",{className:"flex items-center gap-3 mt-3",children:[e.jsxs("button",{onClick:()=>E(s.id),className:"flex items-center gap-1 text-xs text-slate-500 hover:text-shield-600",children:[e.jsx(H,{className:"w-3.5 h-3.5"})," ",s.upvote_count]}),!s.is_solution&&e.jsxs("button",{onClick:()=>V(s.id),className:"flex items-center gap-1 text-xs text-slate-500 hover:text-green-600",children:[e.jsx(I,{className:"w-3.5 h-3.5"})," Mark as solution"]})]})]})})},s.id)),!i.is_locked&&e.jsxs(n,{className:"p-4",children:[e.jsx("textarea",{value:y,onChange:s=>k(s.target.value),className:"w-full h-24 text-sm border border-slate-200 rounded-lg p-3 focus:ring-2 focus:ring-shield-500 focus:border-shield-500 mb-3",placeholder:"Write a reply..."}),e.jsx("div",{className:"flex justify-end",children:e.jsx(w,{variant:"shield",onClick:A,disabled:T||!y.trim(),children:T?"Posting...":"Post Reply"})})]})]}):null,$&&u&&e.jsx(J,{categoryId:u.id,onClose:()=>C(!1),onCreated:s=>{o(c=>[s,...c]),C(!1)}})]})}function J({categoryId:t,onClose:l,onCreated:j}){const[h,N]=a.useState(""),[o,u]=a.useState(""),[p,i]=a.useState(!1),v=async()=>{if(!(!h||!o)){i(!0);try{const d=await m.createTopic({category_id:t,title:h,body:o});r.success("Topic created successfully"),j(d)}catch{r.error("Failed to create topic")}finally{i(!1)}}};return e.jsx(G,{isOpen:!0,onClose:l,title:"New Topic",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(O,{label:"Title",placeholder:"What's your question or topic?",value:h,onChange:d=>N(d.target.value)}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 block mb-1",children:"Body"}),e.jsx("textarea",{value:o,onChange:d=>u(d.target.value),className:"w-full h-32 text-sm border border-slate-200 rounded-lg p-3 focus:ring-2 focus:ring-shield-500 focus:border-shield-500",placeholder:"Describe your question or share your thoughts..."})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(w,{variant:"ghost",onClick:l,children:"Cancel"}),e.jsx(w,{variant:"shield",onClick:v,disabled:p||!h||!o,children:p?"Creating...":"Create Topic"})]})]})})}export{se as default};
