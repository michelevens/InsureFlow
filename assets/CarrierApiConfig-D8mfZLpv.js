import{j as e}from"./vendor-query-D5ml2kdZ.js";import{r as i}from"./vendor-react-C8VcOkCS.js";import{b as c,B as d,I as x}from"./index-8sQqf4Gi.js";import{ax as A,a2 as I,a3 as L,ai as U,P,aP as K,W as M,n as O,aD as X,aQ as G,d as Q,an as V}from"./vendor-ui-tJ0aMxU9.js";const u={async getConfigs(){const a=await c.get("/carrier-api/configs");return Array.isArray(a)?a:a.data||[]},async createConfig(a){return c.post("/carrier-api/configs",a)},async updateConfig(a,o){return c.put(`/carrier-api/configs/${a}`,o)},async deleteConfig(a){return c.delete(`/carrier-api/configs/${a}`)},async testConnection(a){return c.post(`/carrier-api/configs/${a}/test`)},async getLogs(a,o=1){return c.get(`/carrier-api/configs/${a}/logs?page=${o}`)},async getLiveRates(a){return c.post("/carrier-api/live-rates",a)}};function Z(){const[a,o]=i.useState([]),[T,$]=i.useState(!0),[v,p]=i.useState(!1),[_,g]=i.useState(null),[y,b]=i.useState(null),[N,E]=i.useState([]),[m,f]=i.useState({}),[R,C]=i.useState(null),[D,w]=i.useState(!1),[j,n]=i.useState(null),[r,l]=i.useState({carrier_id:"",api_type:"rest",base_url:"",auth_type:"api_key",rate_limit_per_minute:60,timeout_seconds:30,api_key:"",api_secret:""});i.useEffect(()=>{S()},[]);const S=async()=>{try{const s=await u.getConfigs();o(s)}catch{n({type:"error",text:"Failed to load configurations"})}finally{$(!1)}},F=async()=>{w(!0),n(null);try{const s={carrier_id:Number(r.carrier_id),api_type:r.api_type,base_url:r.base_url,auth_type:r.auth_type,rate_limit_per_minute:r.rate_limit_per_minute,timeout_seconds:r.timeout_seconds,credentials:{api_key:r.api_key,api_secret:r.api_secret}};_?(await u.updateConfig(_,s),n({type:"success",text:"Configuration updated"})):(await u.createConfig(s),n({type:"success",text:"Configuration created"})),p(!1),g(null),k(),S()}catch(s){n({type:"error",text:s instanceof Error?s.message:"Save failed"})}finally{w(!1)}},B=async s=>{C(s.id);try{const t=await u.testConnection(s.id);f(h=>({...h,[s.id]:t}))}catch(t){f(h=>({...h,[s.id]:{success:!1,response_time_ms:0,message:t instanceof Error?t.message:"Test failed"}}))}finally{C(null)}},q=async s=>{try{await u.deleteConfig(s),o(t=>t.filter(h=>h.id!==s)),n({type:"success",text:"Configuration deleted"})}catch(t){n({type:"error",text:t instanceof Error?t.message:"Delete failed"})}},z=async s=>{if(y===s){b(null);return}try{const t=await u.getLogs(s);E(t.data||[]),b(s)}catch{n({type:"error",text:"Failed to load logs"})}},k=()=>{l({carrier_id:"",api_type:"rest",base_url:"",auth_type:"api_key",rate_limit_per_minute:60,timeout_seconds:30,api_key:"",api_secret:""})};return T?e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx("div",{className:"w-8 h-8 border-4 border-shield-200 border-t-shield-600 rounded-full animate-spin"})}):e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Carrier API Integrations"}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Configure real-time rating APIs for carrier partners"})]}),e.jsxs(d,{variant:"shield",onClick:()=>{p(!0),g(null),k()},children:[e.jsx(A,{className:"w-4 h-4 mr-2"})," Add Integration"]})]}),j&&e.jsxs("div",{className:`flex items-center gap-2 p-3 rounded-xl text-sm ${j.type==="success"?"bg-green-50 text-green-700":"bg-red-50 text-red-600"}`,children:[j.type==="success"?e.jsx(I,{className:"w-4 h-4"}):e.jsx(L,{className:"w-4 h-4"}),j.text]}),v&&e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:_?"Edit Integration":"New Carrier API Integration"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(x,{label:"Carrier ID",type:"number",placeholder:"1",value:r.carrier_id,onChange:s=>l(t=>({...t,carrier_id:s.target.value}))}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"API Type"}),e.jsxs("select",{value:r.api_type,onChange:s=>l(t=>({...t,api_type:s.target.value})),className:"w-full px-4 py-2.5 rounded-xl border border-slate-200 focus:ring-2 focus:ring-shield-500",children:[e.jsx("option",{value:"rest",children:"REST"}),e.jsx("option",{value:"soap",children:"SOAP"}),e.jsx("option",{value:"xml",children:"XML"})]})]}),e.jsx(x,{label:"Base URL",placeholder:"https://api.carrier.com/v1",value:r.base_url,onChange:s=>l(t=>({...t,base_url:s.target.value})),leftIcon:e.jsx(U,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Auth Type"}),e.jsxs("select",{value:r.auth_type,onChange:s=>l(t=>({...t,auth_type:s.target.value})),className:"w-full px-4 py-2.5 rounded-xl border border-slate-200 focus:ring-2 focus:ring-shield-500",children:[e.jsx("option",{value:"api_key",children:"API Key"}),e.jsx("option",{value:"oauth2",children:"OAuth 2.0"}),e.jsx("option",{value:"basic",children:"Basic Auth"}),e.jsx("option",{value:"certificate",children:"Certificate"})]})]}),e.jsx(x,{label:"API Key / Username",type:"password",value:r.api_key,onChange:s=>l(t=>({...t,api_key:s.target.value}))}),e.jsx(x,{label:"API Secret / Password",type:"password",value:r.api_secret,onChange:s=>l(t=>({...t,api_secret:s.target.value}))}),e.jsx(x,{label:"Rate Limit (req/min)",type:"number",value:String(r.rate_limit_per_minute),onChange:s=>l(t=>({...t,rate_limit_per_minute:Number(s.target.value)}))}),e.jsx(x,{label:"Timeout (seconds)",type:"number",value:String(r.timeout_seconds),onChange:s=>l(t=>({...t,timeout_seconds:Number(s.target.value)}))})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsxs(d,{variant:"shield",onClick:F,isLoading:D,children:[_?"Update":"Create"," Integration"]}),e.jsx(d,{variant:"outline",onClick:()=>{p(!1),g(null)},children:"Cancel"})]})]}),a.length===0&&!v?e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-12 text-center",children:[e.jsx(P,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-700 mb-2",children:"No API Integrations"}),e.jsx("p",{className:"text-slate-500 mb-4",children:"Connect carrier rating APIs for real-time quotes"}),e.jsxs(d,{variant:"shield",onClick:()=>p(!0),children:[e.jsx(A,{className:"w-4 h-4 mr-2"})," Add First Integration"]})]}):e.jsx("div",{className:"space-y-4",children:a.map(s=>e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${s.is_active?"bg-green-100":"bg-slate-100"}`,children:e.jsx(P,{className:`w-5 h-5 ${s.is_active?"text-green-600":"text-slate-400"}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900",children:s.carrier?.name||`Carrier #${s.carrier_id}`}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-500",children:[e.jsx("span",{className:"uppercase font-mono",children:s.api_type}),e.jsx("span",{children:s.base_url})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2.5 py-1 rounded-full text-xs font-medium ${s.is_active?"bg-green-50 text-green-700":"bg-slate-100 text-slate-500"}`,children:s.is_active?"Active":"Inactive"}),e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>B(s),isLoading:R===s.id,children:[e.jsx(K,{className:"w-4 h-4 mr-1"})," Test"]}),e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>z(s.id),children:[e.jsx(M,{className:"w-4 h-4 mr-1"})," Logs",y===s.id?e.jsx(O,{className:"w-3 h-3 ml-1"}):e.jsx(X,{className:"w-3 h-3 ml-1"})]}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>{g(s.id),l({carrier_id:String(s.carrier_id),api_type:s.api_type,base_url:s.base_url,auth_type:s.auth_type,rate_limit_per_minute:s.rate_limit_per_minute,timeout_seconds:s.timeout_seconds,api_key:"",api_secret:""}),p(!0)},children:e.jsx(G,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>q(s.id),className:"p-2 text-red-400 hover:text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(Q,{className:"w-4 h-4"})})]})]}),m[s.id]&&e.jsxs("div",{className:`mt-3 flex items-center gap-2 p-2.5 rounded-xl text-sm ${m[s.id].success?"bg-green-50 text-green-700":"bg-red-50 text-red-600"}`,children:[m[s.id].success?e.jsx(I,{className:"w-4 h-4"}):e.jsx(L,{className:"w-4 h-4"}),m[s.id].message,m[s.id].response_time_ms>0&&e.jsxs("span",{className:"ml-auto flex items-center gap-1 text-xs",children:[e.jsx(V,{className:"w-3 h-3"})," ",m[s.id].response_time_ms,"ms"]})]}),s.last_tested_at&&e.jsxs("p",{className:"mt-2 text-xs text-slate-400",children:["Last tested: ",new Date(s.last_tested_at).toLocaleString()]})]}),y===s.id&&e.jsxs("div",{className:"border-t border-slate-100 bg-slate-50 p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-slate-700 mb-3",children:"Recent API Logs"}),N.length===0?e.jsx("p",{className:"text-sm text-slate-400",children:"No logs yet"}):e.jsx("div",{className:"space-y-2",children:N.slice(0,20).map(t=>e.jsxs("div",{className:"flex items-center gap-3 px-3 py-2 bg-white rounded-lg text-sm",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${t.response_status&&t.response_status<400?"bg-green-400":"bg-red-400"}`}),e.jsx("span",{className:"font-mono text-xs text-slate-500",children:t.request_method}),e.jsx("span",{className:"flex-1 truncate text-slate-600",children:t.request_url}),e.jsx("span",{className:`font-mono text-xs ${t.response_status&&t.response_status<400?"text-green-600":"text-red-600"}`,children:t.response_status||"ERR"}),t.response_time_ms&&e.jsxs("span",{className:"text-xs text-slate-400",children:[t.response_time_ms,"ms"]}),e.jsx("span",{className:"text-xs text-slate-400",children:new Date(t.created_at).toLocaleTimeString()})]},t.id))})]})]},s.id))})]})}export{Z as default};
