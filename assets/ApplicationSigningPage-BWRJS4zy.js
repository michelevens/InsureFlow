import{j as e}from"./vendor-query-D5ml2kdZ.js";import{e as Y,r as l,L as y}from"./vendor-react-C8VcOkCS.js";import{C as c,B as S,I as $}from"./index-8sQqf4Gi.js";import{B as F}from"./Badge-CDix051U.js";import{m as C}from"./marketplace-CSbNM9Sw.js";import{L as _,a6 as X,aa as z,S as k,a1 as H,a0 as Q,Q as W,at as A,ad as m}from"./vendor-ui-tJ0aMxU9.js";const q=n=>n.replace(/_/g," ").replace(/\b\w/g,o=>o.toUpperCase()),u=n=>n?`$${Number(n).toLocaleString()}`:"â€”";function ee(){const{token:n}=Y(),[o,D]=l.useState(null),[I,L]=l.useState(!0),[P,T]=l.useState(!1),[d,B]=l.useState(""),[x,g]=l.useState(!1),[M,p]=l.useState(!1),r=l.useRef(null),[R,f]=l.useState(!1),[j,N]=l.useState(!1);l.useEffect(()=>{n&&C.viewApplication(n).then(s=>{D(s),s.is_signed&&p(!0)}).catch(()=>{T(!0)}).finally(()=>L(!1))},[n]);const b=s=>{const i=r.current.getBoundingClientRect();return"touches"in s?{x:s.touches[0].clientX-i.left,y:s.touches[0].clientY-i.top}:{x:s.clientX-i.left,y:s.clientY-i.top}},v=s=>{const a=r.current?.getContext("2d");if(!a)return;f(!0),N(!0);const i=b(s);a.beginPath(),a.moveTo(i.x,i.y)},w=s=>{if(!R)return;const a=r.current?.getContext("2d");if(!a)return;const i=b(s);a.lineWidth=2,a.lineCap="round",a.strokeStyle="#1e293b",a.lineTo(i.x,i.y),a.stroke()},h=()=>f(!1),E=()=>{const s=r.current;if(!s)return;const a=s.getContext("2d");a&&(a.clearRect(0,0,s.width,s.height),N(!1))},U=async()=>{if(!n||!d.trim()){m.error("Please enter your full name");return}if(!j){m.error("Please draw your signature");return}const s=r.current?.toDataURL("image/png")??"";g(!0);try{await C.signApplication(n,{signer_name:d,signature_data:s}),p(!0),m.success("Application signed successfully!")}catch{m.error("Failed to sign application. Please try again.")}finally{g(!1)}};if(I)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-shield-50 via-white to-confidence-50 flex items-center justify-center",children:e.jsx(_,{className:"w-8 h-8 animate-spin text-shield-400"})});if(P||!o)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-shield-50 via-white to-confidence-50 flex items-center justify-center p-4",children:e.jsxs(c,{className:"max-w-md w-full p-8 text-center",children:[e.jsx(X,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h1",{className:"text-xl font-bold text-slate-900 mb-2",children:"Application Not Found"}),e.jsx("p",{className:"text-slate-500",children:"This signing link may have expired or is invalid."})]})});const t=o.application;return M?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-shield-50 via-white to-confidence-50 flex items-center justify-center p-4",children:e.jsxs(c,{className:"max-w-lg w-full p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-green-100 flex items-center justify-center mx-auto mb-6",children:e.jsx(z,{className:"w-8 h-8 text-green-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Application Signed!"}),e.jsxs("p",{className:"text-slate-600 mb-2",children:["Your application ",e.jsx("strong",{children:t.reference})," with ",e.jsx("strong",{children:t.carrier_name})," has been signed and submitted."]}),e.jsx("p",{className:"text-sm text-slate-500 mb-6",children:"Your agent will submit this to the carrier for underwriting. You'll be notified when your policy is issued."}),e.jsx(y,{to:"/auth/login",children:e.jsx(S,{variant:"shield",children:"Sign In to Track"})})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-shield-50 via-white to-confidence-50",children:[e.jsx("div",{className:"border-b bg-white/80 backdrop-blur-sm",children:e.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsxs(y,{to:"/",className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-7 h-7 text-shield-600"}),e.jsx("span",{className:"text-xl font-bold text-slate-900",children:"Insurons"})]}),e.jsx(F,{variant:"warning",children:"Pending Signature"})]})}),e.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-8 space-y-6",children:[e.jsxs(c,{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-1",children:"Insurance Application"}),e.jsxs("p",{className:"text-slate-500 mb-4",children:["Reference: ",t.reference]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-4 bg-slate-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4 text-shield-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400",children:"Carrier"}),e.jsx("p",{className:"text-sm font-medium text-slate-900",children:t.carrier_name})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4 text-shield-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400",children:"Type"}),e.jsx("p",{className:"text-sm font-medium text-slate-900",children:t.insurance_type?.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase())})]})]}),t.agent&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-slate-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400",children:"Agent"}),e.jsx("p",{className:"text-sm font-medium text-slate-900",children:t.agent.name})]})]}),t.agency&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4 text-slate-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400",children:"Agency"}),e.jsx("p",{className:"text-sm font-medium text-slate-900",children:t.agency.name})]})]})]}),t.monthly_premium&&Number(t.monthly_premium)>0&&e.jsxs("div",{className:"mt-4 p-4 bg-savings-50 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm text-savings-600 font-medium",children:"Monthly Premium"}),e.jsxs("p",{className:"text-3xl font-bold text-savings-700",children:[u(t.monthly_premium),e.jsx("span",{className:"text-lg font-normal",children:"/mo"})]})]})]}),t.coverages.length>0&&e.jsxs(c,{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-3",children:"Coverage Summary"}),e.jsx("div",{className:"space-y-2",children:t.coverages.map(s=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-slate-100 last:border-0",children:[e.jsx("span",{className:"text-sm text-slate-900",children:q(s.coverage_type)}),e.jsxs("span",{className:"text-sm font-medium text-slate-900",children:[s.limit_amount?`${u(s.limit_amount)} limit`:"",s.deductible_amount?` / ${u(s.deductible_amount)} ded.`:""]})]},s.id))})]}),e.jsxs(c,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(A,{className:"w-5 h-5 text-shield-600"}),e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Sign Application"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Full Legal Name *"}),e.jsx($,{value:d,onChange:s=>B(s.target.value),placeholder:"Enter your full legal name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Signature *"}),e.jsx("div",{className:"border-2 border-dashed border-slate-300 rounded-lg overflow-hidden bg-white",children:e.jsx("canvas",{ref:r,width:600,height:150,className:"w-full cursor-crosshair touch-none",onMouseDown:v,onMouseMove:w,onMouseUp:h,onMouseLeave:h,onTouchStart:v,onTouchMove:w,onTouchEnd:h})}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("p",{className:"text-xs text-slate-400",children:"Draw your signature above"}),e.jsx("button",{type:"button",onClick:E,className:"text-xs text-shield-600 hover:underline",children:"Clear"})]})]}),e.jsxs("p",{className:"text-xs text-slate-500",children:["By signing, I confirm that I have reviewed this application, all information is accurate, and I authorize its submission to ",e.jsx("strong",{children:t.carrier_name})," for underwriting. I understand this is a legally binding electronic signature."]}),e.jsx(S,{variant:"shield",className:"w-full",onClick:U,disabled:x||!d.trim()||!j,leftIcon:x?e.jsx(_,{className:"w-4 h-4 animate-spin"}):e.jsx(A,{className:"w-4 h-4"}),children:x?"Signing...":"Sign & Submit Application"})]})]})]})]})}export{ee as default};
