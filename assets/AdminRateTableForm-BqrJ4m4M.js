import{j as e}from"./vendor-query-D5ml2kdZ.js";import{e as q,u as B,r as l}from"./vendor-react-C8VcOkCS.js";import{r as p}from"./rateTableAdmin-B4nKa6uP.js";import{ad as c,L as y,A as $,aZ as z,az as D}from"./vendor-ui-tJ0aMxU9.js";import"./index-BZEM9EbM.js";const W=[{value:"ltc",label:"LTC (Long-Term Care)"},{value:"ltd",label:"LTD (Long-Term Disability)"},{value:"disability_ltd",label:"Disability / LTD"},{value:"life_term",label:"Life — Term"},{value:"life_whole",label:"Life — Whole"},{value:"life_universal",label:"Life — Universal"},{value:"life_final_expense",label:"Life — Final Expense"},{value:"annuity",label:"Annuity"},{value:"auto",label:"Auto"},{value:"homeowners",label:"Homeowners"},{value:"renters",label:"Renters"}],Y=[{value:"entries",label:"Rate Entries"},{value:"factors",label:"Rate Factors"},{value:"riders",label:"Riders"},{value:"fees",label:"Fees"}],o="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-shield-500 focus:border-shield-500",d="block text-sm font-medium text-slate-700 mb-1";function J(){const{id:r}=q(),x=B(),i=!!r,h=l.useRef(null),[R,_]=l.useState(i),[v,C]=l.useState(!1),[L,E]=l.useState([]),[s,w]=l.useState({name:"",product_type:"",version:"",carrier_id:"",description:"",effective_date:"",expiration_date:"",is_active:!0}),[u,S]=l.useState({}),[m,f]=l.useState(null),[b,F]=l.useState("entries"),[j,T]=l.useState(!1),[k,g]=l.useState(!1);l.useEffect(()=>{U(),i&&r&&V(r)},[r]);const U=async()=>{try{const a=await p.getCarriers();E(a)}catch{c.error("Failed to load carriers")}},V=async a=>{_(!0);try{const t=await p.get(Number(a));w({name:t.name??"",product_type:t.product_type??"",version:t.version??"",carrier_id:t.carrier_id!=null?String(t.carrier_id):"",description:t.description??"",effective_date:t.effective_date??"",expiration_date:t.expiration_date??"",is_active:t.is_active??!0})}catch{c.error("Failed to load rate table"),x("/admin/rate-tables")}finally{_(!1)}},P=()=>{const a={};return s.name.trim()||(a.name="Name is required."),s.product_type||(a.product_type="Product type is required."),s.version.trim()||(a.version="Version is required."),S(a),Object.keys(a).length===0},n=(a,t)=>{w(N=>({...N,[a]:t})),a in u&&S(N=>({...N,[a]:void 0}))},A=async a=>{if(a.preventDefault(),!P())return;C(!0);const t={name:s.name.trim(),product_type:s.product_type,version:s.version.trim(),carrier_id:s.carrier_id?Number(s.carrier_id):null,description:s.description.trim()||null,effective_date:s.effective_date||null,expiration_date:s.expiration_date||null,is_active:s.is_active};try{i&&r?(await p.update(Number(r),t),c.success("Rate table updated"),x("/admin/rate-tables")):(await p.create(t),c.success("Rate table created"),x("/admin/rate-tables"))}catch{c.error("Failed to save rate table")}finally{C(!1)}},O=a=>{a.preventDefault(),g(!1);const t=a.dataTransfer.files[0];t&&t.name.endsWith(".csv")?f(t):c.error("Please drop a CSV file")},I=async()=>{if(!(!m||!r)){T(!0);try{await p.importCsv(Number(r),m,b),c.success(`CSV imported as "${b}" successfully`),f(null),h.current&&(h.current.value="")}catch{c.error("CSV import failed")}finally{T(!1)}}};return R?e.jsx("div",{className:"flex items-center justify-center py-24",children:e.jsx(y,{className:"h-8 w-8 animate-spin text-shield-500"})}):e.jsxs("div",{className:"space-y-6 max-w-2xl",children:[e.jsxs("button",{type:"button",onClick:()=>x("/admin/rate-tables"),className:"inline-flex items-center gap-1 text-sm text-slate-500 hover:text-slate-800 transition-colors",children:[e.jsx($,{className:"h-4 w-4"}),i?"Back":"Back to Rate Tables"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:i?"Edit Rate Table":"New Rate Table"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:i?"Update the rate table details below.":"Fill in the details to create a new rate table."})]}),e.jsx("form",{onSubmit:A,children:e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 p-6 space-y-5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:d,children:["Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:s.name,onChange:a=>n("name",a.target.value),className:o,placeholder:"e.g. Standard LTC Rates"}),u.name&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:u.name})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:d,children:["Product Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:s.product_type,onChange:a=>n("product_type",a.target.value),className:o,children:[e.jsx("option",{value:"",children:"Select type…"}),W.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),u.product_type&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:u.product_type})]}),e.jsxs("div",{children:[e.jsxs("label",{className:d,children:["Version ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:s.version,onChange:a=>n("version",a.target.value),className:o,placeholder:"e.g. 2026-Q1"}),u.version&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:u.version})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:d,children:["Carrier ",e.jsx("span",{className:"text-slate-400 font-normal",children:"(optional — leave blank for generic)"})]}),e.jsxs("select",{value:s.carrier_id,onChange:a=>n("carrier_id",a.target.value),className:o,children:[e.jsx("option",{value:"",children:"Generic (no carrier)"}),L.map(a=>e.jsx("option",{value:String(a.id),children:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:d,children:"Description"}),e.jsx("textarea",{value:s.description,onChange:a=>n("description",a.target.value),className:`${o} min-h-[80px] resize-y`,placeholder:"Optional notes about this rate table…"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:d,children:"Effective Date"}),e.jsx("input",{type:"date",value:s.effective_date,onChange:a=>n("effective_date",a.target.value),className:o})]}),e.jsxs("div",{children:[e.jsxs("label",{className:d,children:["Expiration Date ",e.jsx("span",{className:"text-slate-400 font-normal",children:"(optional)"})]}),e.jsx("input",{type:"date",value:s.expiration_date,onChange:a=>n("expiration_date",a.target.value),className:o})]})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer select-none",children:[e.jsx("input",{type:"checkbox",checked:s.is_active,onChange:a=>n("is_active",a.target.checked),className:"w-4 h-4 rounded border-slate-300 text-shield-600 focus:ring-shield-500"}),e.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Active"}),e.jsx("span",{className:"text-xs text-slate-400",children:"(only active tables are used in quoting)"})]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsxs("button",{type:"submit",disabled:v,className:"inline-flex items-center gap-2 bg-shield-600 text-white hover:bg-shield-700 disabled:opacity-60 disabled:cursor-not-allowed px-4 py-2 rounded-lg text-sm font-medium transition-colors",children:[v?e.jsx(y,{className:"h-4 w-4 animate-spin"}):e.jsx(z,{className:"h-4 w-4"}),v?"Saving…":i?"Update Rate Table":"Create Rate Table"]})})]})}),i&&e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 p-6 space-y-4",children:[e.jsx("h2",{className:"text-base font-semibold text-slate-900",children:"Import CSV Data"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Upload a CSV file to populate rate entries, factors, riders, or fees for this table."}),e.jsxs("div",{children:[e.jsx("label",{className:d,children:"Import Type"}),e.jsx("select",{value:b,onChange:a=>F(a.target.value),className:o,children:Y.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{onDragOver:a=>{a.preventDefault(),g(!0)},onDragLeave:()=>g(!1),onDrop:O,onClick:()=>h.current?.click(),className:`flex flex-col items-center justify-center gap-2 border-2 border-dashed rounded-lg py-8 cursor-pointer transition-colors ${k?"border-shield-400 bg-shield-50":"border-slate-300 hover:border-shield-400 hover:bg-slate-50"}`,children:[e.jsx(D,{className:"h-7 w-7 text-slate-400"}),m?e.jsx("p",{className:"text-sm font-medium text-slate-700",children:m.name}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm font-medium text-slate-700",children:"Drop a CSV file here, or click to browse"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Only .csv files are accepted"})]}),e.jsx("input",{ref:h,type:"file",accept:".csv",className:"hidden",onChange:a=>{const t=a.target.files?.[0];t&&f(t)}})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",disabled:!m||j,onClick:I,className:"inline-flex items-center gap-2 bg-shield-600 text-white hover:bg-shield-700 disabled:opacity-60 disabled:cursor-not-allowed px-4 py-2 rounded-lg text-sm font-medium transition-colors",children:[j?e.jsx(y,{className:"h-4 w-4 animate-spin"}):e.jsx(D,{className:"h-4 w-4"}),j?"Uploading…":"Upload CSV"]})})]})]})}export{J as default};
