import{j as e}from"./vendor-query-D5ml2kdZ.js";import{r as n}from"./vendor-react-C8VcOkCS.js";import{B as d,C as c,I as K}from"./index-8sQqf4Gi.js";import{B as N}from"./Badge-CDix051U.js";import{a as x}from"./admin-C1yF50l3.js";import{ad as r,A as W,Q as S,a8 as E,L as y,aS as q,S as ee,a3 as U,aa as k,ar as se,E as te,ai as ae,aT as ie,af as B,aU as le,a6 as D,o as ne,ae as ce}from"./vendor-ui-tJ0aMxU9.js";const F={verified:{label:"NPN Verified",variant:"success"},pending:{label:"NPN Pending",variant:"warning"},rejected:{label:"NPN Rejected",variant:"danger"},unverified:{label:"No NPN",variant:"default"}},C={FL:"https://licenseesearch.fldfs.com/",TX:"https://www.tdi.texas.gov/agent/agentsearch.html",CA:"https://interactive.web.insurance.ca.gov/webuser/licw_name_search$.startup",NY:"https://myportal.dfs.ny.gov/common-forms/license-lookup",GA:"https://oci.georgia.gov/consumers/license-verification",IL:"https://online-dfpr.micropact.com/lookup/licenselookup.aspx",VA:"https://scc.virginia.gov/pages/Bureau-of-Insurance-Licensee-Search",AZ:"https://insurance.az.gov/licensee-search",PA:"https://www.insurance.pa.gov/Consumers/LicenseSearch/Pages/default.aspx",OH:"https://gateway.insurance.ohio.gov/LicenseSearch",NJ:"https://www20.state.nj.us/DOBI_LicSearch/lsSearchPage.jsp",NC:"https://www.ncdoi.gov/consumers/consumer-services/company-and-agent-search",MI:"https://difs.state.mi.us/fis/lps"};function L({status:m}){const o=F[m]||F.unverified;return e.jsx(N,{variant:o.variant,children:o.label})}function pe(){const[m,o]=n.useState([]),[M,O]=n.useState(0),[$,P]=n.useState(!0),[j,R]=n.useState(""),[u,h]=n.useState(null),[G,V]=n.useState(!1),[v,g]=n.useState(null),[p,w]=n.useState(null),H=m.filter(s=>s.is_active).length,X=m.filter(s=>s.is_verified).length,J=m.reduce((s,t)=>s+(t.agents?.length??0),0),b=n.useCallback(async s=>{P(!0);try{const t=await x.getAgencies(s?{search:s}:void 0);o(t.data),O(t.total)}catch{r.error("Failed to load agencies")}finally{P(!1)}},[]);n.useEffect(()=>{b()},[b]),n.useEffect(()=>{const s=setTimeout(()=>{b(j||void 0)},400);return()=>clearTimeout(s)},[j]);const Q=async s=>{V(!0);try{const t=await x.getAgency(s);h(t)}catch{r.error("Failed to load agency details")}finally{V(!1)}},Y=async s=>{g(s.id);try{const t=await x.updateAgency(s.id,{is_verified:!s.is_verified});h(t),o(i=>i.map(a=>a.id===t.id?{...a,is_verified:t.is_verified}:a)),r.success(t.is_verified?"Agency verified":"Agency unverified")}catch{r.error("Failed to update verification status")}finally{g(null)}},Z=async s=>{g(s.id);try{const t=await x.updateAgency(s.id,{is_active:!s.is_active});h(t),o(i=>i.map(a=>a.id===t.id?{...a,is_active:t.is_active}:a)),r.success(t.is_active?"Agency activated":"Agency deactivated")}catch{r.error("Failed to update agency status")}finally{g(null)}},I=async(s,t)=>{const i=s.agent_profile?.id;if(i){w(i);try{const a=s.agent_profile?.state?C[s.agent_profile.state]:void 0;if(await x.verifyAgentNpn(i,{status:t,license_lookup_url:a}),u){const l=await x.getAgency(u.id);h(l)}r.success(`Agent NPN ${t}`)}catch{r.error("Failed to update NPN status")}finally{w(null)}}},T=async(s,t)=>{w(s.id);try{await x.verifyAgencyNpn(s.id,{status:t});const i=await x.getAgency(s.id);h(i),r.success(`Agency NPN ${t}`)}catch{r.error("Failed to update agency NPN status")}finally{w(null)}};if(u){const s=u,t=s.state,i=t?C[t]:null;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(d,{variant:"ghost",size:"sm",onClick:()=>h(null),children:[e.jsx(W,{className:"h-4 w-4 mr-1"})," Back to Agencies"]}),e.jsxs(c,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-14 w-14 rounded-xl bg-shield-100 flex items-center justify-center",children:e.jsx(S,{className:"h-7 w-7 text-shield-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:s.name}),e.jsxs("p",{className:"text-sm text-slate-500 mt-0.5",children:[e.jsx("span",{className:"font-mono",children:s.agency_code}),s.city&&s.state&&e.jsxs("span",{className:"ml-3",children:[e.jsx(E,{className:"inline h-3.5 w-3.5 mr-0.5"}),s.city,", ",s.state]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{variant:s.is_verified?"success":"default",children:s.is_verified?"Verified":"Unverified"}),e.jsx(N,{variant:s.is_active?"success":"danger",children:s.is_active?"Active":"Inactive"})]})]}),s.description&&e.jsx("p",{className:"text-slate-600 mt-4",children:s.description}),e.jsxs("div",{className:"flex gap-3 mt-6 pt-4 border-t",children:[e.jsxs(d,{variant:s.is_verified?"outline":"primary",size:"sm",onClick:()=>Y(s),disabled:v===s.id,children:[v===s.id?e.jsx(y,{className:"h-4 w-4 mr-1 animate-spin"}):s.is_verified?e.jsx(q,{className:"h-4 w-4 mr-1"}):e.jsx(ee,{className:"h-4 w-4 mr-1"}),s.is_verified?"Unverify":"Verify"]}),e.jsxs(d,{variant:s.is_active?"outline":"primary",size:"sm",onClick:()=>Z(s),disabled:v===s.id,children:[v===s.id?e.jsx(y,{className:"h-4 w-4 mr-1 animate-spin"}):s.is_active?e.jsx(U,{className:"h-4 w-4 mr-1"}):e.jsx(k,{className:"h-4 w-4 mr-1"}),s.is_active?"Deactivate":"Activate"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(c,{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Contact Information"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[s.phone&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{className:"h-4 w-4 text-shield-500"}),e.jsx("span",{className:"text-slate-700",children:s.phone})]}),s.email&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(te,{className:"h-4 w-4 text-shield-500"}),e.jsx("span",{className:"text-slate-700",children:s.email})]}),s.website&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ae,{className:"h-4 w-4 text-shield-500"}),e.jsx("a",{href:s.website,target:"_blank",rel:"noopener noreferrer",className:"text-shield-600 hover:underline",children:s.website})]}),s.address&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(E,{className:"h-4 w-4 text-shield-500 mt-0.5"}),e.jsxs("div",{className:"text-slate-700",children:[e.jsx("p",{children:s.address}),s.city&&s.state&&e.jsxs("p",{children:[s.city,", ",s.state," ",s.zip_code]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{className:"h-4 w-4 text-shield-500"}),e.jsx("span",{className:"text-slate-700 font-mono",children:s.agency_code})]})]})]}),e.jsxs(c,{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"NPN & Licensing"}),s.npn?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500",children:"National Producer Number"}),e.jsx("p",{className:"text-lg font-mono font-semibold text-slate-900",children:s.npn})]}),e.jsx(L,{status:s.npn_verified})]}),s.npn_verified_at&&e.jsxs("p",{className:"text-xs text-slate-400",children:["Verified on ",new Date(s.npn_verified_at).toLocaleDateString()]}),i&&e.jsxs("a",{href:i,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1.5 text-sm text-shield-600 hover:underline",children:[e.jsx(B,{className:"h-3.5 w-3.5"}),"Verify on ",s.state," Dept. of Insurance"]}),s.npn_verified==="pending"&&e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(d,{variant:"primary",size:"sm",onClick:()=>T(s,"verified"),disabled:p===s.id,children:[e.jsx(le,{className:"h-4 w-4 mr-1"})," Verify NPN"]}),e.jsxs(d,{variant:"danger",size:"sm",onClick:()=>T(s,"rejected"),disabled:p===s.id,children:[e.jsx(D,{className:"h-4 w-4 mr-1"})," Reject"]})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(D,{className:"h-8 w-8 text-slate-300 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-slate-500",children:"No NPN on file"})]})]})]}),e.jsxs(c,{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Agency Owner"}),s.owner?e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-shield-100 flex items-center justify-center",children:e.jsx(ne,{className:"h-6 w-6 text-shield-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900",children:s.owner.name}),e.jsx("p",{className:"text-sm text-slate-500",children:s.owner.email})]})]}):e.jsx("p",{className:"text-sm text-slate-500",children:"No owner assigned"})]}),e.jsxs(c,{className:"p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:["Agents (",s.agents?.length??0,")"]}),s.agents&&s.agents.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b text-left text-slate-500",children:[e.jsx("th",{className:"pb-3 pr-4 font-medium",children:"Name"}),e.jsx("th",{className:"pb-3 pr-4 font-medium",children:"Email"}),e.jsx("th",{className:"pb-3 pr-4 font-medium",children:"NPN"}),e.jsx("th",{className:"pb-3 pr-4 font-medium",children:"License"}),e.jsx("th",{className:"pb-3 pr-4 font-medium",children:"State"}),e.jsx("th",{className:"pb-3 pr-4 font-medium",children:"Status"}),e.jsx("th",{className:"pb-3 font-medium text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y",children:s.agents.map(a=>{const l=a.agent_profile,_=l?.npn,A=l?.npn_verified||"unverified",f=l?.state,z=l?.license_lookup_url||(f?C[f]:null);return e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"py-3 pr-4 font-medium text-slate-900",children:a.name}),e.jsx("td",{className:"py-3 pr-4 text-slate-600",children:a.email}),e.jsx("td",{className:"py-3 pr-4",children:_?e.jsx("span",{className:"font-mono text-slate-900",children:_}):e.jsx("span",{className:"text-slate-400",children:"—"})}),e.jsx("td",{className:"py-3 pr-4",children:l?.license_number?e.jsx("span",{className:"font-mono text-xs text-slate-600",children:l.license_number}):e.jsx("span",{className:"text-slate-400",children:"—"})}),e.jsx("td",{className:"py-3 pr-4",children:f?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-slate-700",children:f}),z&&e.jsx("a",{href:z,target:"_blank",rel:"noopener noreferrer",title:`Verify on ${f} DOI`,children:e.jsx(B,{className:"h-3.5 w-3.5 text-shield-500 hover:text-shield-700"})})]}):e.jsx("span",{className:"text-slate-400",children:"—"})}),e.jsx("td",{className:"py-3 pr-4",children:e.jsx(L,{status:A})}),e.jsxs("td",{className:"py-3 text-right",children:[_&&A==="pending"&&l&&e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(d,{variant:"primary",size:"sm",onClick:()=>I(a,"verified"),disabled:p===l.id,children:p===l.id?e.jsx(y,{className:"h-3 w-3 animate-spin"}):e.jsx(k,{className:"h-3 w-3"})}),e.jsx(d,{variant:"danger",size:"sm",onClick:()=>I(a,"rejected"),disabled:p===l.id,children:e.jsx(U,{className:"h-3 w-3"})})]}),A==="verified"&&e.jsx(k,{className:"h-4 w-4 text-savings-500 inline"})]})]},a.id)})})]})}):e.jsx("p",{className:"text-sm text-slate-500",children:"No agents found for this agency."})]})]})}return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Agency Management"}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Manage and monitor all agencies on the platform"})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(c,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-xl font-bold text-slate-900",children:M}),e.jsx("p",{className:"text-sm text-slate-500",children:"Total Agencies"})]}),e.jsxs(c,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-xl font-bold text-savings-600",children:H}),e.jsx("p",{className:"text-sm text-slate-500",children:"Active"})]}),e.jsxs(c,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-xl font-bold text-shield-600",children:X}),e.jsx("p",{className:"text-sm text-slate-500",children:"Verified"})]}),e.jsxs(c,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-xl font-bold text-slate-900",children:J}),e.jsx("p",{className:"text-sm text-slate-500",children:"Total Agents"})]})]}),e.jsx(K,{placeholder:"Search agencies by name, code, or location...",value:j,onChange:s=>R(s.target.value),leftIcon:e.jsx(ce,{className:"w-5 h-5"})}),e.jsx(c,{children:$||G?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(y,{className:"h-8 w-8 animate-spin text-shield-500"})}):m.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-slate-500",children:[e.jsx(S,{className:"h-10 w-10 mb-3 text-slate-300"}),e.jsx("p",{className:"font-medium",children:"No agencies found"}),e.jsx("p",{className:"text-sm mt-1",children:j?"Try a different search term.":"No agencies have been created yet."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-100",children:[e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider p-4",children:"Agency"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider p-4",children:"Owner"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider p-4",children:"NPN"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider p-4",children:"Location"}),e.jsx("th",{className:"text-right text-xs font-medium text-slate-500 uppercase tracking-wider p-4",children:"Agents"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider p-4",children:"Status"}),e.jsx("th",{className:"text-right text-xs font-medium text-slate-500 uppercase tracking-wider p-4",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-50",children:m.map(s=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-xl bg-shield-100 text-shield-700 flex items-center justify-center",children:e.jsx(S,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-slate-900",children:s.name}),e.jsx("p",{className:"text-xs text-slate-400 font-mono",children:s.agency_code})]})]})}),e.jsx("td",{className:"p-4 text-sm text-slate-600",children:s.owner?s.owner.name:"—"}),e.jsx("td",{className:"p-4 text-sm",children:s.npn?e.jsxs("div",{children:[e.jsx("span",{className:"font-mono text-slate-900",children:s.npn}),e.jsx("div",{className:"mt-0.5",children:e.jsx(L,{status:s.npn_verified})})]}):e.jsx("span",{className:"text-slate-400",children:"—"})}),e.jsx("td",{className:"p-4 text-sm text-slate-500",children:s.city&&s.state?`${s.city}, ${s.state}`:"—"}),e.jsx("td",{className:"p-4 text-right text-sm font-medium text-slate-900",children:s.agents?.length??0}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(N,{variant:s.is_verified?"success":"default",children:s.is_verified?"Verified":"Unverified"}),e.jsx(N,{variant:s.is_active?"success":"danger",children:s.is_active?"Active":"Inactive"})]})}),e.jsx("td",{className:"p-4 text-right",children:e.jsx(d,{variant:"outline",size:"sm",onClick:()=>Q(s.id),children:"View"})})]},s.id))})]})})})]})}export{pe as default};
