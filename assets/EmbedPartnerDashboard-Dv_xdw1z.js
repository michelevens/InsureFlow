import{j as e}from"./vendor-query-D5ml2kdZ.js";import{r as t}from"./vendor-react-C8VcOkCS.js";import{b as d,B as i,C as b,I as y}from"./index-BZEM9EbM.js";import{B as k}from"./Badge-8fS5vckW.js";import{M as S}from"./Modal-Cn8_xSIn.js";import{ax as P,O as A,K as $,d as B,ai as I,z as M,aY as E}from"./vendor-ui-tJ0aMxU9.js";const m={async list(){return d.get("/embed/partners")},async create(a){return d.post("/embed/partners",a)},async show(a){return d.get(`/embed/partners/${a}`)},async update(a,g){return d.put(`/embed/partners/${a}`,g)},async remove(a){return d.delete(`/embed/partners/${a}`)},async regenerateKey(a){return d.post(`/embed/partners/${a}/regenerate-key`,{})},async sessions(a){return d.get(`/embed/partners/${a}/sessions`)},async analytics(a){return d.get(`/embed/partners/${a}/analytics`)},async widgetCode(a){return d.get(`/embed/partners/${a}/widget-code`)}};function L(){const[a,g]=t.useState([]),[x,f]=t.useState(!0),[w,h]=t.useState(!1),[l,C]=t.useState(null),[r,v]=t.useState(null),[p,N]=t.useState(null),[j,o]=t.useState(null),u=async()=>{f(!0);try{const s=await m.list();g(s)}catch{}finally{f(!1)}};t.useEffect(()=>{u()},[]);const n=async s=>{C(s);try{const c=await m.analytics(s.id);v(c)}catch{v(null)}},_=async s=>{await m.update(s.id,{is_active:!s.is_active}),u()},D=async s=>{await m.remove(s),l?.id===s&&(C(null),v(null)),u()},K=async s=>{const c=await m.regenerateKey(s);o(c.api_key)},z=async s=>{const c=await m.widgetCode(s);N(c.embed_code)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Embedded Insurance"}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Manage widget partners and track conversions"})]}),e.jsxs(i,{variant:"shield",onClick:()=>h(!0),children:[e.jsx(P,{className:"w-4 h-4 mr-1"})," New Partner"]})]}),x?e.jsx(b,{className:"p-8 text-center",children:e.jsx("div",{className:"w-8 h-8 border-4 border-shield-200 border-t-shield-600 rounded-full animate-spin mx-auto"})}):a.length===0?e.jsxs(b,{className:"p-12 text-center",children:[e.jsx(A,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-500 mb-4",children:"No embed partners configured"}),e.jsxs(i,{variant:"shield",onClick:()=>h(!0),children:[e.jsx(P,{className:"w-4 h-4 mr-1"})," Add First Partner"]})]}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1 space-y-3",children:a.map(s=>e.jsxs(b,{className:`p-4 cursor-pointer transition-all hover:shadow-md ${l?.id===s.id?"ring-2 ring-shield-500":""}`,onClick:()=>n(s),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-900",children:s.name}),e.jsx("p",{className:"text-xs text-slate-500",children:s.contact_email})]}),s.is_active?e.jsx(k,{variant:"success",children:"Active"}):e.jsx(k,{variant:"danger",children:"Inactive"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-500",children:[e.jsxs("span",{children:[s.sessions_count??0," sessions"]}),e.jsxs("span",{children:[s.converted_count??0," conversions"]}),e.jsxs("span",{children:[s.commission_share_percent,"% share"]})]}),s.allowed_domains&&s.allowed_domains.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:s.allowed_domains.map(c=>e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-slate-100 text-slate-600",children:c},c))})]},s.id))}),e.jsx("div",{className:"lg:col-span-2",children:l&&r?e.jsxs(b,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-lg font-bold text-slate-900",children:[l.name," — Analytics"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>z(l.id),children:[e.jsx(A,{className:"w-4 h-4 mr-1"})," Embed Code"]}),e.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>K(l.id),children:[e.jsx($,{className:"w-4 h-4 mr-1"})," New Key"]}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>_(l),children:l.is_active?"Disable":"Enable"}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>D(l.id),children:e.jsx(B,{className:"w-4 h-4 text-red-400"})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-slate-900",children:r.total_sessions}),e.jsx("p",{className:"text-sm text-slate-500",children:"Total Sessions"})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-savings-600",children:r.conversions}),e.jsx("p",{className:"text-sm text-slate-500",children:"Conversions"})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-shield-600",children:[r.conversion_rate,"%"]}),e.jsx("p",{className:"text-sm text-slate-500",children:"Conversion Rate"})]})]}),r.by_domain.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-slate-700 mb-3",children:"By Domain"}),e.jsx("div",{className:"space-y-2",children:r.by_domain.map((s,c)=>e.jsxs("div",{className:"flex items-center justify-between bg-slate-50 rounded-lg px-4 py-2.5 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{className:"font-medium",children:s.source_domain||"Direct"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-slate-500",children:[e.jsxs("span",{children:[s.total," sessions"]}),e.jsxs("span",{children:[s.conversions," conversions"]}),e.jsxs("span",{className:"font-medium text-shield-600",children:[s.total>0?(s.conversions/s.total*100).toFixed(1):"0","%"]})]})]},c))})]})]}):e.jsxs(b,{className:"p-12 text-center",children:[e.jsx(M,{className:"w-10 h-10 text-slate-300 mx-auto mb-2"}),e.jsx("p",{className:"text-slate-400",children:"Select a partner to view analytics"})]})})]}),w&&e.jsx(O,{onClose:()=>h(!1),onCreated:s=>{s.api_key&&o(s.api_key),u(),h(!1)}}),j&&e.jsx(S,{isOpen:!0,onClose:()=>o(null),title:"API Key",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Save this API key now — it won't be shown again."}),e.jsxs("div",{className:"flex items-center gap-2 bg-slate-50 rounded-lg p-3",children:[e.jsx("code",{className:"text-sm font-mono flex-1 break-all",children:j}),e.jsx("button",{onClick:()=>navigator.clipboard.writeText(j),className:"text-slate-400 hover:text-slate-600",children:e.jsx(E,{className:"w-4 h-4"})})]}),e.jsx(i,{variant:"shield",onClick:()=>o(null),className:"w-full",children:"Done"})]})}),p&&e.jsx(S,{isOpen:!0,onClose:()=>N(null),title:"Widget Embed Code",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Add this snippet to your partner's website to embed the insurance widget:"}),e.jsx("div",{className:"bg-slate-900 rounded-lg p-4",children:e.jsx("code",{className:"text-sm text-green-400 font-mono break-all",children:p})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(i,{variant:"ghost",onClick:()=>{navigator.clipboard.writeText(p)},children:[e.jsx(E,{className:"w-4 h-4 mr-1"})," Copy"]}),e.jsx(i,{variant:"shield",onClick:()=>N(null),children:"Done"})]})]})})]})}function O({onClose:a,onCreated:g}){const[x,f]=t.useState(""),[w,h]=t.useState(""),[l,C]=t.useState(""),[r,v]=t.useState(""),[p,N]=t.useState("10"),[j,o]=t.useState(!1),u=async()=>{if(x){o(!0);try{const n=await m.create({name:x,contact_email:w||void 0,contact_name:l||void 0,allowed_domains:r?r.split(",").map(_=>_.trim()).filter(Boolean):void 0,commission_share_percent:parseFloat(p)||10});g(n)}catch{}finally{o(!1)}}};return e.jsx(S,{isOpen:!0,onClose:a,title:"New Embed Partner",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(y,{label:"Partner Name",placeholder:"e.g. ABC Car Dealerships",value:x,onChange:n=>f(n.target.value)}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(y,{label:"Contact Name",placeholder:"John Smith",value:l,onChange:n=>C(n.target.value)}),e.jsx(y,{label:"Contact Email",placeholder:"john@partner.com",value:w,onChange:n=>h(n.target.value)})]}),e.jsx(y,{label:"Allowed Domains",placeholder:"dealer.com, mortgage.co (comma-separated)",value:r,onChange:n=>v(n.target.value)}),e.jsx(y,{label:"Commission Share %",type:"number",value:p,onChange:n=>N(n.target.value)}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(i,{variant:"ghost",onClick:a,children:"Cancel"}),e.jsx(i,{variant:"shield",onClick:u,disabled:j||!x,children:j?"Creating...":"Create Partner"})]})]})})}export{L as default};
