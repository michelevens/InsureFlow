import{j as e}from"./vendor-query-D5ml2kdZ.js";import{e as W,u as J,r as c,L as I}from"./vendor-react-C8VcOkCS.js";import{r as _}from"./rateTableAdmin-BQ9ouvGu.js";import{L as A,A as K,aO as Y,aY as Q,aJ as X,d as z,ad as n,ax as O,aZ as P,X as D}from"./vendor-ui-tJ0aMxU9.js";import"./index-8sQqf4Gi.js";const Z=[{id:"entries",label:"Base Rates"},{id:"factors",label:"Factors"},{id:"riders",label:"Riders"},{id:"fees",label:"Fees"},{id:"modal_factors",label:"Modal Factors"}],L={active:"bg-green-100 text-green-700",inactive:"bg-slate-100 text-slate-600",draft:"bg-amber-100 text-amber-700",archived:"bg-red-100 text-red-600"};function G({children:x,className:o=""}){return e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${o}`,children:x})}function h({value:x,onChange:o,type:a="text",placeholder:r,className:m=""}){return e.jsx("input",{type:a,value:x,onChange:d=>o(d.target.value),placeholder:r,className:`border border-slate-300 rounded px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-shield-500 w-full ${m}`})}function E({value:x,onChange:o,options:a,className:r=""}){return e.jsx("select",{value:x,onChange:m=>o(m.target.value),className:`border border-slate-300 rounded px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-shield-500 w-full bg-white ${r}`,children:a.map(m=>e.jsx("option",{value:m.value,children:m.label},m.value))})}function M({onEdit:x,onDelete:o,editing:a,onSave:r,onCancel:m,saving:d}){return a?e.jsxs("div",{className:"flex items-center gap-1 justify-end",children:[e.jsx("button",{onClick:r,disabled:d,className:"p-1.5 rounded text-green-600 hover:bg-green-50 disabled:opacity-50",title:"Save",children:d?e.jsx(A,{className:"w-4 h-4 animate-spin"}):e.jsx(P,{className:"w-4 h-4"})}),e.jsx("button",{onClick:m,className:"p-1.5 rounded text-slate-500 hover:bg-slate-100",title:"Cancel",children:e.jsx(D,{className:"w-4 h-4"})})]}):e.jsxs("div",{className:"flex items-center gap-1 justify-end",children:[e.jsx("button",{onClick:x,className:"p-1.5 rounded text-shield-600 hover:bg-shield-50",title:"Edit",children:e.jsx(Y,{className:"w-4 h-4"})}),e.jsx("button",{onClick:o,className:"p-1.5 rounded text-red-500 hover:bg-red-50",title:"Delete",children:e.jsx(z,{className:"w-4 h-4"})})]})}function H({tableId:x,entries:o,onReload:a}){const[r,m]=c.useState(null),[d,p]=c.useState({rate_key:"",rate_value:""}),[F,g]=c.useState(!1),[j,b]=c.useState({rate_key:"",rate_value:""}),[i,u]=c.useState(!1),[y,f]=c.useState(!1),w=s=>{m(s.id),p({rate_key:s.rate_key,rate_value:String(s.rate_value)})},k=()=>{m(null),p({rate_key:"",rate_value:""})},C=async()=>{if(!d.rate_key.trim()){n.error("Rate key is required");return}g(!0);try{await _.updateEntry(x,r,{rate_key:d.rate_key,rate_value:parseFloat(d.rate_value)||0}),n.success("Entry updated"),m(null),a()}catch{n.error("Failed to update entry")}finally{g(!1)}},S=async s=>{if(confirm("Delete this base rate entry?"))try{await _.deleteEntry(x,s),n.success("Entry deleted"),a()}catch{n.error("Failed to delete entry")}},t=async()=>{if(!j.rate_key.trim()){n.error("Rate key is required");return}u(!0);try{await _.createEntry(x,{rate_key:j.rate_key,rate_value:parseFloat(j.rate_value)||0}),n.success("Entry added"),b({rate_key:"",rate_value:""}),f(!1),a()}catch{n.error("Failed to add entry")}finally{u(!1)}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-100",children:[e.jsxs("span",{className:"text-sm text-slate-500",children:[o.length," entries"]}),e.jsxs("button",{onClick:()=>f(s=>!s),className:"flex items-center gap-1.5 text-sm font-medium text-shield-600 hover:text-shield-700",children:[e.jsx(O,{className:"w-4 h-4"})," Add Entry"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-100 bg-slate-50",children:[e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider p-3",children:"Rate Key"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider p-3",children:"Rate Value"}),e.jsx("th",{className:"text-right text-xs font-medium text-slate-500 uppercase tracking-wider p-3",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-50",children:[o.map(s=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"p-3 font-mono text-slate-700",children:r===s.id?e.jsx(h,{value:d.rate_key,onChange:l=>p(v=>({...v,rate_key:l})),placeholder:"rate_key"}):s.rate_key}),e.jsx("td",{className:"p-3 text-slate-700",children:r===s.id?e.jsx(h,{value:d.rate_value,onChange:l=>p(v=>({...v,rate_value:l})),type:"number",placeholder:"0.00",className:"max-w-[120px]"}):s.rate_value.toFixed(4)}),e.jsx("td",{className:"p-3",children:e.jsx(M,{onEdit:()=>w(s),onDelete:()=>S(s.id),editing:r===s.id,onSave:C,onCancel:k,saving:F})})]},s.id)),o.length===0&&!y&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"p-6 text-center text-slate-400 text-sm",children:"No base rates defined."})}),y&&e.jsxs("tr",{className:"bg-shield-50/40",children:[e.jsx("td",{className:"p-3",children:e.jsx(h,{value:j.rate_key,onChange:s=>b(l=>({...l,rate_key:s})),placeholder:"e.g. age_25_male"})}),e.jsx("td",{className:"p-3",children:e.jsx(h,{value:j.rate_value,onChange:s=>b(l=>({...l,rate_value:s})),type:"number",placeholder:"0.00",className:"max-w-[120px]"})}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-1 justify-end",children:[e.jsx("button",{onClick:t,disabled:i,className:"p-1.5 rounded text-green-600 hover:bg-green-50 disabled:opacity-50",title:"Save",children:i?e.jsx(A,{className:"w-4 h-4 animate-spin"}):e.jsx(P,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{f(!1),b({rate_key:"",rate_value:""})},className:"p-1.5 rounded text-slate-500 hover:bg-slate-100",title:"Cancel",children:e.jsx(D,{className:"w-4 h-4"})})]})})]})]})]})})]})}const $=[{value:"multiply",label:"Multiply"},{value:"add",label:"Add"},{value:"subtract",label:"Subtract"}];function ee({tableId:x,factors:o,onReload:a}){const[r,m]=c.useState(null),[d,p]=c.useState({factor_code:"",factor_label:"",option_value:"",apply_mode:"multiply",factor_value:""}),[F,g]=c.useState(!1),[j,b]=c.useState(!1),[i,u]=c.useState({factor_code:"",factor_label:"",option_value:"",apply_mode:"multiply",factor_value:""}),[y,f]=c.useState(!1),w=Array.from(new Set(o.map(l=>l.factor_code))),k=l=>{m(l.id),p({factor_code:l.factor_code,factor_label:l.factor_label,option_value:l.option_value,apply_mode:l.apply_mode,factor_value:String(l.factor_value)})},C=()=>m(null),S=async()=>{g(!0);try{await _.updateFactor(x,r,{factor_code:d.factor_code,factor_label:d.factor_label,option_value:d.option_value,apply_mode:d.apply_mode,factor_value:parseFloat(d.factor_value)||0}),n.success("Factor updated"),m(null),a()}catch{n.error("Failed to update factor")}finally{g(!1)}},t=async l=>{if(confirm("Delete this factor?"))try{await _.deleteFactor(x,l),n.success("Factor deleted"),a()}catch{n.error("Failed to delete factor")}},s=async()=>{if(!i.factor_code.trim()||!i.option_value.trim()){n.error("Factor code and option value are required");return}f(!0);try{await _.createFactor(x,{factor_code:i.factor_code,factor_label:i.factor_label,option_value:i.option_value,apply_mode:i.apply_mode,factor_value:parseFloat(i.factor_value)||0}),n.success("Factor added"),u({factor_code:"",factor_label:"",option_value:"",apply_mode:"multiply",factor_value:""}),b(!1),a()}catch{n.error("Failed to add factor")}finally{f(!1)}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-100",children:[e.jsxs("span",{className:"text-sm text-slate-500",children:[o.length," factors across ",w.length," group",w.length!==1?"s":""]}),e.jsxs("button",{onClick:()=>b(l=>!l),className:"flex items-center gap-1.5 text-sm font-medium text-shield-600 hover:text-shield-700",children:[e.jsx(O,{className:"w-4 h-4"})," Add Factor"]})]}),w.map(l=>{const v=o.filter(N=>N.factor_code===l),U=v[0]?.factor_label||l;return e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-semibold text-slate-700 bg-slate-50 px-3 py-2 border-y border-slate-100",children:[U," ",e.jsxs("span",{className:"font-normal text-slate-400 ml-1",children:["(",l,")"]})]}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-50",children:[e.jsx("th",{className:"text-left text-xs font-medium text-slate-400 uppercase tracking-wider px-3 py-2",children:"Option Value"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-400 uppercase tracking-wider px-3 py-2",children:"Apply Mode"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-400 uppercase tracking-wider px-3 py-2",children:"Factor Value"}),e.jsx("th",{className:"text-right text-xs font-medium text-slate-400 uppercase tracking-wider px-3 py-2",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-50",children:v.map(N=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"px-3 py-2 font-mono text-slate-700",children:r===N.id?e.jsx(h,{value:d.option_value,onChange:R=>p(T=>({...T,option_value:R})),placeholder:"option_value"}):N.option_value}),e.jsx("td",{className:"px-3 py-2",children:r===N.id?e.jsx(E,{value:d.apply_mode,onChange:R=>p(T=>({...T,apply_mode:R})),options:$}):e.jsx("span",{className:"capitalize text-slate-600",children:N.apply_mode})}),e.jsx("td",{className:"px-3 py-2 text-slate-700",children:r===N.id?e.jsx(h,{value:d.factor_value,onChange:R=>p(T=>({...T,factor_value:R})),type:"number",className:"max-w-[100px]"}):N.factor_value.toFixed(4)}),e.jsx("td",{className:"px-3 py-2",children:e.jsx(M,{onEdit:()=>k(N),onDelete:()=>t(N.id),editing:r===N.id,onSave:S,onCancel:C,saving:F})})]},N.id))})]})]},l)}),o.length===0&&!j&&e.jsx("p",{className:"p-6 text-center text-slate-400 text-sm",children:"No factors defined."}),j&&e.jsxs("div",{className:"border-t border-slate-100 p-4 bg-shield-50/30",children:[e.jsx("p",{className:"text-xs font-semibold text-slate-600 uppercase tracking-wider mb-3",children:"New Factor"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 mb-1 block",children:"Factor Code"}),e.jsx(h,{value:i.factor_code,onChange:l=>u(v=>({...v,factor_code:l})),placeholder:"e.g. smoker"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 mb-1 block",children:"Factor Label"}),e.jsx(h,{value:i.factor_label,onChange:l=>u(v=>({...v,factor_label:l})),placeholder:"e.g. Tobacco Use"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 mb-1 block",children:"Option Value"}),e.jsx(h,{value:i.option_value,onChange:l=>u(v=>({...v,option_value:l})),placeholder:"e.g. yes"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 mb-1 block",children:"Apply Mode"}),e.jsx(E,{value:i.apply_mode,onChange:l=>u(v=>({...v,apply_mode:l})),options:$})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 mb-1 block",children:"Factor Value"}),e.jsx(h,{value:i.factor_value,onChange:l=>u(v=>({...v,factor_value:l})),type:"number",placeholder:"1.25"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[e.jsxs("button",{onClick:()=>{b(!1)},className:"flex items-center gap-1 text-sm text-slate-500 hover:text-slate-700 px-3 py-1.5 rounded hover:bg-slate-100",children:[e.jsx(D,{className:"w-3.5 h-3.5"})," Cancel"]}),e.jsxs("button",{onClick:s,disabled:y,className:"flex items-center gap-1 text-sm text-white bg-shield-600 hover:bg-shield-700 px-3 py-1.5 rounded disabled:opacity-50",children:[y?e.jsx(A,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(P,{className:"w-3.5 h-3.5"})," Add Factor"]})]})]})]})}const V=[{value:"add",label:"Add"},{value:"multiply",label:"Multiply"}];function te({tableId:x,riders:o,onReload:a}){const[r,m]=c.useState(null),[d,p]=c.useState({rider_code:"",rider_label:"",apply_mode:"add",rider_value:""}),[F,g]=c.useState(!1),[j,b]=c.useState(!1),[i,u]=c.useState({rider_code:"",rider_label:"",apply_mode:"add",rider_value:""}),[y,f]=c.useState(!1),w=t=>{m(t.id),p({rider_code:t.rider_code,rider_label:t.rider_label,apply_mode:t.apply_mode,rider_value:String(t.rider_value)})},k=async()=>{g(!0);try{await _.updateRider(x,r,{rider_code:d.rider_code,rider_label:d.rider_label,apply_mode:d.apply_mode,rider_value:parseFloat(d.rider_value)||0}),n.success("Rider updated"),m(null),a()}catch{n.error("Failed to update rider")}finally{g(!1)}},C=async t=>{if(confirm("Delete this rider?"))try{await _.deleteRider(x,t),n.success("Rider deleted"),a()}catch{n.error("Failed to delete rider")}},S=async()=>{if(!i.rider_code.trim()){n.error("Rider code is required");return}f(!0);try{await _.createRider(x,{rider_code:i.rider_code,rider_label:i.rider_label,apply_mode:i.apply_mode,rider_value:parseFloat(i.rider_value)||0}),n.success("Rider added"),u({rider_code:"",rider_label:"",apply_mode:"add",rider_value:""}),b(!1),a()}catch{n.error("Failed to add rider")}finally{f(!1)}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-100",children:[e.jsxs("span",{className:"text-sm text-slate-500",children:[o.length," riders"]}),e.jsxs("button",{onClick:()=>b(t=>!t),className:"flex items-center gap-1.5 text-sm font-medium text-shield-600 hover:text-shield-700",children:[e.jsx(O,{className:"w-4 h-4"})," Add Rider"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-100 bg-slate-50",children:[e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider p-3",children:"Rider Code"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider p-3",children:"Rider Name"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider p-3",children:"Apply Mode"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider p-3",children:"Value"}),e.jsx("th",{className:"text-right text-xs font-medium text-slate-500 uppercase tracking-wider p-3",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-50",children:[o.map(t=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"p-3 font-mono text-slate-700",children:r===t.id?e.jsx(h,{value:d.rider_code,onChange:s=>p(l=>({...l,rider_code:s}))}):t.rider_code}),e.jsx("td",{className:"p-3 text-slate-700",children:r===t.id?e.jsx(h,{value:d.rider_label,onChange:s=>p(l=>({...l,rider_label:s}))}):t.rider_label}),e.jsx("td",{className:"p-3",children:r===t.id?e.jsx(E,{value:d.apply_mode,onChange:s=>p(l=>({...l,apply_mode:s})),options:V}):e.jsx("span",{className:"capitalize text-slate-600",children:t.apply_mode})}),e.jsx("td",{className:"p-3 text-slate-700",children:r===t.id?e.jsx(h,{value:d.rider_value,onChange:s=>p(l=>({...l,rider_value:s})),type:"number",className:"max-w-[100px]"}):t.rider_value.toFixed(4)}),e.jsx("td",{className:"p-3",children:e.jsx(M,{onEdit:()=>w(t),onDelete:()=>C(t.id),editing:r===t.id,onSave:k,onCancel:()=>m(null),saving:F})})]},t.id)),o.length===0&&!j&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"p-6 text-center text-slate-400 text-sm",children:"No riders defined."})})]})]})}),j&&e.jsxs("div",{className:"border-t border-slate-100 p-4 bg-shield-50/30",children:[e.jsx("p",{className:"text-xs font-semibold text-slate-600 uppercase tracking-wider mb-3",children:"New Rider"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 mb-1 block",children:"Code"}),e.jsx(h,{value:i.rider_code,onChange:t=>u(s=>({...s,rider_code:t})),placeholder:"e.g. WOP"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 mb-1 block",children:"Name"}),e.jsx(h,{value:i.rider_label,onChange:t=>u(s=>({...s,rider_label:t})),placeholder:"e.g. Waiver of Premium"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 mb-1 block",children:"Apply Mode"}),e.jsx(E,{value:i.apply_mode,onChange:t=>u(s=>({...s,apply_mode:t})),options:V})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 mb-1 block",children:"Value"}),e.jsx(h,{value:i.rider_value,onChange:t=>u(s=>({...s,rider_value:t})),type:"number",placeholder:"0.00"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[e.jsxs("button",{onClick:()=>b(!1),className:"flex items-center gap-1 text-sm text-slate-500 hover:text-slate-700 px-3 py-1.5 rounded hover:bg-slate-100",children:[e.jsx(D,{className:"w-3.5 h-3.5"})," Cancel"]}),e.jsxs("button",{onClick:S,disabled:y,className:"flex items-center gap-1 text-sm text-white bg-shield-600 hover:bg-shield-700 px-3 py-1.5 rounded disabled:opacity-50",children:[y?e.jsx(A,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(P,{className:"w-3.5 h-3.5"})," Add Rider"]})]})]})]})}const q=[{value:"fee",label:"Fee"},{value:"credit",label:"Credit"}],B=[{value:"add",label:"Add (Flat)"},{value:"percent",label:"Percent"}];function ae({tableId:x,fees:o,onReload:a}){const[r,m]=c.useState(null),[d,p]=c.useState({fee_code:"",fee_label:"",fee_type:"fee",apply_mode:"add",fee_value:""}),[F,g]=c.useState(!1),[j,b]=c.useState(!1),[i,u]=c.useState({fee_code:"",fee_label:"",fee_type:"fee",apply_mode:"add",fee_value:""}),[y,f]=c.useState(!1),w=t=>{m(t.id),p({fee_code:t.fee_code,fee_label:t.fee_label,fee_type:t.fee_type,apply_mode:t.apply_mode,fee_value:String(t.fee_value)})},k=async()=>{g(!0);try{await _.updateFee(x,r,{fee_code:d.fee_code,fee_label:d.fee_label,fee_type:d.fee_type,apply_mode:d.apply_mode,fee_value:parseFloat(d.fee_value)||0}),n.success("Fee updated"),m(null),a()}catch{n.error("Failed to update fee")}finally{g(!1)}},C=async t=>{if(confirm("Delete this fee?"))try{await _.deleteFee(x,t),n.success("Fee deleted"),a()}catch{n.error("Failed to delete fee")}},S=async()=>{if(!i.fee_code.trim()){n.error("Fee code is required");return}f(!0);try{await _.createFee(x,{fee_code:i.fee_code,fee_label:i.fee_label,fee_type:i.fee_type,apply_mode:i.apply_mode,fee_value:parseFloat(i.fee_value)||0}),n.success("Fee added"),u({fee_code:"",fee_label:"",fee_type:"fee",apply_mode:"add",fee_value:""}),b(!1),a()}catch{n.error("Failed to add fee")}finally{f(!1)}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-100",children:[e.jsxs("span",{className:"text-sm text-slate-500",children:[o.length," fees"]}),e.jsxs("button",{onClick:()=>b(t=>!t),className:"flex items-center gap-1.5 text-sm font-medium text-shield-600 hover:text-shield-700",children:[e.jsx(O,{className:"w-4 h-4"})," Add Fee"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-100 bg-slate-50",children:[e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider p-3",children:"Fee Code"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider p-3",children:"Fee Name"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider p-3",children:"Type"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider p-3",children:"Apply Mode"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider p-3",children:"Value"}),e.jsx("th",{className:"text-right text-xs font-medium text-slate-500 uppercase tracking-wider p-3",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-50",children:[o.map(t=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"p-3 font-mono text-slate-700",children:r===t.id?e.jsx(h,{value:d.fee_code,onChange:s=>p(l=>({...l,fee_code:s}))}):t.fee_code}),e.jsx("td",{className:"p-3 text-slate-700",children:r===t.id?e.jsx(h,{value:d.fee_label,onChange:s=>p(l=>({...l,fee_label:s}))}):t.fee_label}),e.jsx("td",{className:"p-3",children:r===t.id?e.jsx(E,{value:d.fee_type,onChange:s=>p(l=>({...l,fee_type:s})),options:q}):e.jsx(G,{className:t.fee_type==="credit"?"bg-green-100 text-green-700":"bg-slate-100 text-slate-600",children:t.fee_type})}),e.jsx("td",{className:"p-3",children:r===t.id?e.jsx(E,{value:d.apply_mode,onChange:s=>p(l=>({...l,apply_mode:s})),options:B}):e.jsx("span",{className:"capitalize text-slate-600",children:t.apply_mode})}),e.jsx("td",{className:"p-3 text-slate-700",children:r===t.id?e.jsx(h,{value:d.fee_value,onChange:s=>p(l=>({...l,fee_value:s})),type:"number",className:"max-w-[100px]"}):t.fee_value.toFixed(4)}),e.jsx("td",{className:"p-3",children:e.jsx(M,{onEdit:()=>w(t),onDelete:()=>C(t.id),editing:r===t.id,onSave:k,onCancel:()=>m(null),saving:F})})]},t.id)),o.length===0&&!j&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"p-6 text-center text-slate-400 text-sm",children:"No fees defined."})})]})]})}),j&&e.jsxs("div",{className:"border-t border-slate-100 p-4 bg-shield-50/30",children:[e.jsx("p",{className:"text-xs font-semibold text-slate-600 uppercase tracking-wider mb-3",children:"New Fee"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:grid-cols-3 lg:grid-cols-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 mb-1 block",children:"Code"}),e.jsx(h,{value:i.fee_code,onChange:t=>u(s=>({...s,fee_code:t})),placeholder:"e.g. POLICY_FEE"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 mb-1 block",children:"Name"}),e.jsx(h,{value:i.fee_label,onChange:t=>u(s=>({...s,fee_label:t})),placeholder:"e.g. Policy Fee"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 mb-1 block",children:"Type"}),e.jsx(E,{value:i.fee_type,onChange:t=>u(s=>({...s,fee_type:t})),options:q})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 mb-1 block",children:"Apply Mode"}),e.jsx(E,{value:i.apply_mode,onChange:t=>u(s=>({...s,apply_mode:t})),options:B})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 mb-1 block",children:"Value"}),e.jsx(h,{value:i.fee_value,onChange:t=>u(s=>({...s,fee_value:t})),type:"number",placeholder:"0.00"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[e.jsxs("button",{onClick:()=>b(!1),className:"flex items-center gap-1 text-sm text-slate-500 hover:text-slate-700 px-3 py-1.5 rounded hover:bg-slate-100",children:[e.jsx(D,{className:"w-3.5 h-3.5"})," Cancel"]}),e.jsxs("button",{onClick:S,disabled:y,className:"flex items-center gap-1 text-sm text-white bg-shield-600 hover:bg-shield-700 px-3 py-1.5 rounded disabled:opacity-50",children:[y?e.jsx(A,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(P,{className:"w-3.5 h-3.5"})," Add Fee"]})]})]})]})}const se={monthly:"Monthly",quarterly:"Quarterly",semiannual:"Semi-Annual",annual:"Annual"};function le({modalFactors:x}){const o=["annual","semiannual","quarterly","monthly"],a=[...x].sort((r,m)=>o.indexOf(r.mode)-o.indexOf(m.mode));return e.jsxs("div",{className:"overflow-x-auto",children:[e.jsx("div",{className:"px-4 py-3 border-b border-slate-100",children:e.jsx("span",{className:"text-xs text-slate-400",children:"Modal factors are read-only. Manage them via the API."})}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-100 bg-slate-50",children:[e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider p-3",children:"Payment Mode"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider p-3",children:"Factor Value"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider p-3",children:"Flat Fee"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-50",children:[a.map(r=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"p-3 font-medium text-slate-700",children:se[r.mode]??r.mode}),e.jsx("td",{className:"p-3 text-slate-700",children:r.factor.toFixed(4)}),e.jsx("td",{className:"p-3 text-slate-700",children:`$${r.flat_fee.toFixed(2)}`})]},r.id)),a.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"p-6 text-center text-slate-400 text-sm",children:"No modal factors defined."})})]})]})]})}function oe(){const{id:x}=W(),o=J(),[a,r]=c.useState(null),[m,d]=c.useState(!0),[p,F]=c.useState("entries"),[g,j]=c.useState(!1),[b,i]=c.useState(!1),[u,y]=c.useState(!1),f=async()=>{if(x){d(!0);try{const t=await _.get(Number(x));r(t)}catch{n.error("Failed to load rate table")}finally{d(!1)}}};c.useEffect(()=>{f()},[x]);const w=async()=>{if(a){j(!0);try{const t=await _.toggleStatus(a.id);n.success(t.message||(t.is_active?"Rate table activated":"Rate table deactivated")),await f()}catch{n.error("Failed to toggle status")}finally{j(!1)}}},k=async()=>{if(a&&confirm(`Clone rate table "${a.name||a.version}"? A new draft copy will be created.`)){i(!0);try{const t=await _.clone(a.id);n.success("Rate table cloned successfully"),o(`/admin/rate-tables/${t.id}`)}catch{n.error("Failed to clone rate table")}finally{i(!1)}}},C=async()=>{if(a&&confirm(`Permanently delete rate table "${a.name||a.version}"? This cannot be undone.`)){y(!0);try{await _.delete(a.id),n.success("Rate table deleted"),o("/admin/rate-tables")}catch{n.error("Failed to delete rate table")}finally{y(!1)}}};if(m)return e.jsx("div",{className:"flex items-center justify-center py-32",children:e.jsx(A,{className:"h-8 w-8 animate-spin text-shield-500"})});if(!a)return e.jsxs("div",{className:"flex flex-col items-center justify-center py-32 text-slate-500 gap-4",children:[e.jsx("p",{className:"font-medium",children:"Rate table not found."}),e.jsx(I,{to:"/admin/rate-tables",className:"text-shield-600 hover:underline text-sm",children:"Back to Rate Tables"})]});const S=L[a.is_active?"active":"inactive"]??L.inactive;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(I,{to:"/admin/rate-tables",className:"inline-flex items-center gap-1.5 text-sm text-slate-500 hover:text-slate-700",children:[e.jsx(K,{className:"w-4 h-4"})," Back to Rate Tables"]}),e.jsx("div",{className:"bg-white border border-slate-200 rounded-xl p-5 shadow-sm",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:a.name||`${a.carrier?.name??"Unknown Carrier"} – v${a.version}`}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"inline-flex items-center rounded-full bg-shield-100 text-shield-700 px-2.5 py-0.5 text-xs font-medium",children:a.carrier?.name??"No Carrier"}),e.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-100 text-slate-600 px-2.5 py-0.5 text-xs font-medium capitalize",children:a.product_type}),e.jsxs("span",{className:"inline-flex items-center rounded-full bg-slate-100 text-slate-500 px-2.5 py-0.5 text-xs font-mono",children:["v",a.version]}),e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium capitalize ${S}`,children:a.is_active?"Active":"Inactive"})]}),a.description&&e.jsx("p",{className:"text-sm text-slate-500 max-w-prose",children:a.description}),(a.effective_date||a.expiration_date)&&e.jsxs("p",{className:"text-xs text-slate-400",children:[a.effective_date&&e.jsxs(e.Fragment,{children:["Effective: ",a.effective_date]}),a.effective_date&&a.expiration_date&&" · ",a.expiration_date&&e.jsxs(e.Fragment,{children:["Expires: ",a.expiration_date]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 shrink-0",children:[e.jsxs(I,{to:`/admin/rate-tables/${a.id}/edit`,className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg border border-slate-300 text-sm font-medium text-slate-700 hover:bg-slate-50 transition-colors",children:[e.jsx(Y,{className:"w-4 h-4"})," Edit"]}),e.jsxs("button",{onClick:k,disabled:b,className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg border border-slate-300 text-sm font-medium text-slate-700 hover:bg-slate-50 transition-colors disabled:opacity-50",children:[b?e.jsx(A,{className:"w-4 h-4 animate-spin"}):e.jsx(Q,{className:"w-4 h-4"})," Clone"]}),e.jsxs("button",{onClick:w,disabled:g,className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg border border-slate-300 text-sm font-medium text-slate-700 hover:bg-slate-50 transition-colors disabled:opacity-50",children:[g?e.jsx(A,{className:"w-4 h-4 animate-spin"}):e.jsx(X,{className:"w-4 h-4"}),a.is_active?"Deactivate":"Activate"]}),e.jsxs("button",{onClick:C,disabled:u,className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg border border-red-200 text-sm font-medium text-red-600 hover:bg-red-50 transition-colors disabled:opacity-50",children:[u?e.jsx(A,{className:"w-4 h-4 animate-spin"}):e.jsx(z,{className:"w-4 h-4"})," Delete"]})]})]})}),e.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl shadow-sm overflow-hidden",children:[e.jsx("div",{className:"border-b border-slate-200 flex overflow-x-auto",children:Z.map(t=>e.jsxs("button",{onClick:()=>F(t.id),className:`px-5 py-3 text-sm font-medium whitespace-nowrap transition-colors ${p===t.id?"border-b-2 border-shield-600 text-shield-700 bg-white":"text-slate-500 hover:text-slate-700 hover:bg-slate-50"}`,children:[t.label,t.id==="entries"&&a.entries.length>0&&e.jsx("span",{className:"ml-1.5 text-xs rounded-full bg-slate-100 text-slate-500 px-1.5 py-0.5",children:a.entries.length}),t.id==="factors"&&a.factors.length>0&&e.jsx("span",{className:"ml-1.5 text-xs rounded-full bg-slate-100 text-slate-500 px-1.5 py-0.5",children:a.factors.length}),t.id==="riders"&&a.riders.length>0&&e.jsx("span",{className:"ml-1.5 text-xs rounded-full bg-slate-100 text-slate-500 px-1.5 py-0.5",children:a.riders.length}),t.id==="fees"&&a.fees.length>0&&e.jsx("span",{className:"ml-1.5 text-xs rounded-full bg-slate-100 text-slate-500 px-1.5 py-0.5",children:a.fees.length})]},t.id))}),p==="entries"&&e.jsx(H,{tableId:a.id,entries:a.entries,onReload:f}),p==="factors"&&e.jsx(ee,{tableId:a.id,factors:a.factors,onReload:f}),p==="riders"&&e.jsx(te,{tableId:a.id,riders:a.riders,onReload:f}),p==="fees"&&e.jsx(ae,{tableId:a.id,fees:a.fees,onReload:f}),p==="modal_factors"&&e.jsx(le,{tableId:a.id,modalFactors:a.modal_factors,onReload:f})]})]})}export{oe as default};
