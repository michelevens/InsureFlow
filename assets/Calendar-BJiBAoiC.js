import{j as e}from"./vendor-query-D5ml2kdZ.js";import{r as i}from"./vendor-react-C8VcOkCS.js";import{b as v,B as u,C as T,I as S,S as ie}from"./index-8sQqf4Gi.js";import{B as W}from"./Badge-CDix051U.js";import{M as G}from"./Modal-UQye4ZSv.js";import{j as X,aQ as ce,ax as Y,aX as re,aD as de,an as oe,a8 as me,V as H,a0 as I,ac as Q,aR as xe,X as K}from"./vendor-ui-tJ0aMxU9.js";const w={async list(t){const a=new URLSearchParams;return t?.date_from&&a.set("date_from",t.date_from),t?.date_to&&a.set("date_to",t.date_to),t?.status&&a.set("status",t.status),v.get(`/appointments?${a}`)},async create(t){return v.post("/appointments",t)},async show(t){return v.get(`/appointments/${t}`)},async update(t,a){return v.put(`/appointments/${t}`,a)},async updateStatus(t,a,h){return v.put(`/appointments/${t}/status`,{status:a,notes:h})},async remove(t){return v.delete(`/appointments/${t}`)},async getAvailability(t){const a=t?`?agent_id=${t}`:"";return v.get(`/availability${a}`)},async setAvailability(t){return v.post("/availability",{schedule:t})},async getBlockedDates(t){const a=t?`?agent_id=${t}`:"";return v.get(`/blocked-dates${a}`)},async blockDate(t){return v.post("/blocked-dates",t)},async unblockDate(t){return v.delete(`/blocked-dates/${t}`)},async availableSlots(t,a,h){const c=new URLSearchParams({agent_id:String(t),date:a});return h&&c.set("duration_minutes",String(h)),v.get(`/available-slots?${c}`)}},he=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ue=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],pe=["January","February","March","April","May","June","July","August","September","October","November","December"],Z={consultation:"Consultation",review:"Policy Review",follow_up:"Follow-Up",claim:"Claim Meeting",renewal:"Renewal",other:"Other"},U={scheduled:{label:"Scheduled",variant:"info"},confirmed:{label:"Confirmed",variant:"success"},completed:{label:"Completed",variant:"default"},cancelled:{label:"Cancelled",variant:"danger"},no_show:{label:"No Show",variant:"warning"}};function we(){const t=new Date,[a,h]=i.useState(t.getMonth()),[c,j]=i.useState(t.getFullYear()),[f,k]=i.useState([]),[N,b]=i.useState(!0),[x,D]=i.useState(null),[n,C]=i.useState(null),[$,_]=i.useState(!1),[l,o]=i.useState("calendar"),[p,y]=i.useState([]),[L,B]=i.useState([]),[O,r]=i.useState(!1),A=async()=>{b(!0);try{const s=`${c}-${String(a+1).padStart(2,"0")}-01`,d=new Date(c,a+1,0).getDate(),g=`${c}-${String(a+1).padStart(2,"0")}-${d}`,M=await w.list({date_from:s,date_to:g});k(M)}catch{k([])}finally{b(!1)}},J=async()=>{r(!0);try{const[s,d]=await Promise.all([w.getAvailability(),w.getBlockedDates()]);y(s),B(d)}catch{}finally{r(!1)}};i.useEffect(()=>{A()},[a,c]),i.useEffect(()=>{l==="availability"&&J()},[l]);const ee=i.useMemo(()=>{const s=new Date(c,a,1).getDay(),d=new Date(c,a+1,0).getDate(),g=[],M=new Date(c,a,0).getDate();for(let m=s-1;m>=0;m--){const R=M-m,P=a===0?12:a,ne=a===0?c-1:c;g.push({date:R,isCurrentMonth:!1,dateStr:`${ne}-${String(P).padStart(2,"0")}-${String(R).padStart(2,"0")}`})}for(let m=1;m<=d;m++)g.push({date:m,isCurrentMonth:!0,dateStr:`${c}-${String(a+1).padStart(2,"0")}-${String(m).padStart(2,"0")}`});const E=42-g.length;for(let m=1;m<=E;m++){const R=a+2>12?1:a+2,P=a+2>12?c+1:c;g.push({date:m,isCurrentMonth:!1,dateStr:`${P}-${String(R).padStart(2,"0")}-${String(m).padStart(2,"0")}`})}return g},[a,c]),V=i.useMemo(()=>{const s={};for(const d of f)s[d.date]||(s[d.date]=[]),s[d.date].push(d);return s},[f]),q=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`,te=()=>{a===0?(h(11),j(s=>s-1)):h(s=>s-1)},se=()=>{a===11?(h(0),j(s=>s+1)):h(s=>s+1)},ae=()=>{h(t.getMonth()),j(t.getFullYear())},z=async(s,d)=>{await w.updateStatus(s,d),A(),C(null)},le=async s=>{await w.remove(s),A(),C(null)},F=x?V[x]||[]:[];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Calendar"}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Manage appointments & availability"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex bg-slate-100 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>o("calendar"),className:`px-3 py-1.5 text-sm rounded-md transition-colors ${l==="calendar"?"bg-white shadow text-slate-900 font-medium":"text-slate-500"}`,children:[e.jsx(X,{className:"w-4 h-4 inline mr-1"})," Calendar"]}),e.jsxs("button",{onClick:()=>o("availability"),className:`px-3 py-1.5 text-sm rounded-md transition-colors ${l==="availability"?"bg-white shadow text-slate-900 font-medium":"text-slate-500"}`,children:[e.jsx(ce,{className:"w-4 h-4 inline mr-1"})," Availability"]})]}),l==="calendar"&&e.jsxs(u,{variant:"shield",onClick:()=>_(!0),children:[e.jsx(Y,{className:"w-4 h-4 mr-1"})," New Appointment"]})]})]}),l==="calendar"?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(T,{className:"lg:col-span-2 p-0 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-slate-100",children:[e.jsxs("h2",{className:"text-lg font-bold text-slate-900",children:[pe[a]," ",c]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{variant:"ghost",size:"sm",onClick:te,children:e.jsx(re,{className:"w-4 h-4"})}),e.jsx(u,{variant:"ghost",size:"sm",onClick:ae,children:"Today"}),e.jsx(u,{variant:"ghost",size:"sm",onClick:se,children:e.jsx(de,{className:"w-4 h-4"})})]})]}),N?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"w-8 h-8 border-4 border-shield-200 border-t-shield-600 rounded-full animate-spin"})}):e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"grid grid-cols-7 mb-1",children:he.map(s=>e.jsx("div",{className:"text-center text-xs font-medium text-slate-400 py-2",children:s},s))}),e.jsx("div",{className:"grid grid-cols-7 gap-px bg-slate-100 rounded-lg overflow-hidden",children:ee.map((s,d)=>{const g=V[s.dateStr]||[],M=s.dateStr===q,E=s.dateStr===x;return e.jsxs("button",{onClick:()=>D(s.dateStr),className:`relative bg-white p-1.5 min-h-[80px] text-left transition-colors hover:bg-shield-50 ${s.isCurrentMonth?"":"opacity-40"} ${E?"ring-2 ring-shield-500 ring-inset":""}`,children:[e.jsx("span",{className:`text-sm font-medium inline-flex items-center justify-center w-7 h-7 rounded-full ${M?"bg-shield-600 text-white":"text-slate-700"}`,children:s.date}),g.length>0&&e.jsxs("div",{className:"mt-0.5 space-y-0.5",children:[g.slice(0,2).map(m=>e.jsxs("div",{className:"text-[10px] px-1 py-0.5 rounded bg-shield-50 text-shield-700 truncate",children:[m.start_time?.slice(0,5)," ",m.title]},m.id)),g.length>2&&e.jsxs("div",{className:"text-[10px] text-slate-400 px-1",children:["+",g.length-2," more"]})]})]},d)})})]})]}),e.jsxs(T,{className:"p-0 overflow-hidden",children:[e.jsxs("div",{className:"px-5 py-4 border-b border-slate-100",children:[e.jsx("h3",{className:"font-bold text-slate-900",children:x?new Date(x+"T00:00:00").toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}):"Select a date"}),x&&e.jsxs("p",{className:"text-sm text-slate-500 mt-0.5",children:[F.length," appointment",F.length!==1?"s":""]})]}),e.jsx("div",{className:"p-4 space-y-3 max-h-[600px] overflow-y-auto",children:x?F.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(X,{className:"w-10 h-10 text-slate-300 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-slate-400",children:"No appointments"}),e.jsxs(u,{variant:"ghost",size:"sm",className:"mt-2",onClick:()=>_(!0),children:[e.jsx(Y,{className:"w-3.5 h-3.5 mr-1"})," Schedule one"]})]}):F.sort((s,d)=>s.start_time.localeCompare(d.start_time)).map(s=>{const d=U[s.status];return e.jsxs("button",{onClick:()=>C(s),className:"w-full text-left bg-slate-50 rounded-xl p-3 hover:bg-slate-100 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900 text-sm",children:s.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-slate-500",children:[e.jsx(oe,{className:"w-3.5 h-3.5"}),s.start_time?.slice(0,5)," – ",s.end_time?.slice(0,5)]})]}),e.jsx(W,{variant:d.variant,children:d.label})]}),s.location&&e.jsxs("div",{className:"flex items-center gap-1.5 mt-2 text-xs text-slate-400",children:[e.jsx(me,{className:"w-3 h-3"})," ",s.location]}),s.video_link&&e.jsxs("div",{className:"flex items-center gap-1.5 mt-1 text-xs text-shield-600",children:[e.jsx(H,{className:"w-3 h-3"})," Video meeting"]})]},s.id)}):e.jsx("p",{className:"text-sm text-slate-400 text-center py-8",children:"Click a date to view appointments"})})]})]}):e.jsx(ge,{availability:p,blockedDates:L,loading:O,onRefresh:J}),n&&e.jsx(G,{isOpen:!0,onClose:()=>C(null),title:"Appointment Details",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:n.title}),e.jsx(W,{variant:U[n.status].variant,className:"mt-1",children:U[n.status].label})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Type"}),e.jsx("p",{className:"font-medium",children:Z[n.type]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Date"}),e.jsx("p",{className:"font-medium",children:new Date(n.date+"T00:00:00").toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Time"}),e.jsxs("p",{className:"font-medium",children:[n.start_time?.slice(0,5)," – ",n.end_time?.slice(0,5)]})]}),n.location&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Location"}),e.jsx("p",{className:"font-medium",children:n.location})]})]}),n.consumer&&e.jsxs("div",{className:"flex items-center gap-2 text-sm bg-slate-50 rounded-lg p-3",children:[e.jsx(I,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{children:n.consumer.name}),e.jsxs("span",{className:"text-slate-400",children:["(",n.consumer.email,")"]})]}),n.lead&&e.jsxs("div",{className:"flex items-center gap-2 text-sm bg-slate-50 rounded-lg p-3",children:[e.jsx(I,{className:"w-4 h-4 text-slate-400"}),e.jsxs("span",{children:[n.lead.first_name," ",n.lead.last_name]}),e.jsx("span",{className:"text-slate-400",children:"(Lead)"})]}),n.video_link&&e.jsxs("a",{href:n.video_link,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-sm text-shield-600 hover:underline",children:[e.jsx(H,{className:"w-4 h-4"})," Join video meeting"]}),n.notes&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Notes"}),e.jsx("p",{className:"text-sm mt-1",children:n.notes})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2 border-t border-slate-100",children:[n.status==="scheduled"&&e.jsxs(u,{variant:"shield",size:"sm",onClick:()=>z(n.id,"confirmed"),children:[e.jsx(Q,{className:"w-3.5 h-3.5 mr-1"})," Confirm"]}),(n.status==="scheduled"||n.status==="confirmed")&&e.jsxs(e.Fragment,{children:[e.jsxs(u,{variant:"primary",size:"sm",onClick:()=>z(n.id,"completed"),children:[e.jsx(Q,{className:"w-3.5 h-3.5 mr-1"})," Complete"]}),e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>z(n.id,"no_show"),children:[e.jsx(xe,{className:"w-3.5 h-3.5 mr-1"})," No Show"]}),e.jsxs(u,{variant:"danger",size:"sm",onClick:()=>z(n.id,"cancelled"),children:[e.jsx(K,{className:"w-3.5 h-3.5 mr-1"})," Cancel"]})]}),e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>le(n.id),children:"Delete"})]})]})}),$&&e.jsx(ve,{defaultDate:x||q,onClose:()=>_(!1),onCreated:()=>{A(),_(!1)}})]})}function ge({availability:t,blockedDates:a,loading:h,onRefresh:c}){const[j,f]=i.useState([]),[k,N]=i.useState(!1),[b,x]=i.useState(""),[D,n]=i.useState("");i.useEffect(()=>{t.length>0?f(t.map(l=>({day_of_week:l.day_of_week,start_time:l.start_time,end_time:l.end_time,is_active:l.is_active}))):f(Array.from({length:7},(l,o)=>({day_of_week:o,start_time:"09:00",end_time:"17:00",is_active:o>=1&&o<=5})))},[t]);const C=async()=>{N(!0);try{await w.setAvailability(j),c()}catch{}finally{N(!1)}},$=async()=>{b&&(await w.blockDate({blocked_date:b,reason:D||void 0}),x(""),n(""),c())},_=async l=>{await w.unblockDate(l),c()};return h?e.jsx(T,{className:"p-8 text-center",children:e.jsx("div",{className:"w-8 h-8 border-4 border-shield-200 border-t-shield-600 rounded-full animate-spin mx-auto"})}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(T,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-4",children:"Weekly Schedule"}),e.jsx("div",{className:"space-y-3",children:j.map((l,o)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 w-28",children:[e.jsx("input",{type:"checkbox",checked:l.is_active,onChange:()=>{const p=[...j];p[o]={...p[o],is_active:!p[o].is_active},f(p)},className:"rounded border-slate-300 text-shield-600 focus:ring-shield-500"}),e.jsx("span",{className:`text-sm font-medium ${l.is_active?"text-slate-900":"text-slate-400"}`,children:ue[l.day_of_week]})]}),l.is_active&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"time",value:l.start_time,onChange:p=>{const y=[...j];y[o]={...y[o],start_time:p.target.value},f(y)},className:"text-sm border border-slate-200 rounded-lg px-2 py-1.5"}),e.jsx("span",{className:"text-slate-400",children:"to"}),e.jsx("input",{type:"time",value:l.end_time,onChange:p=>{const y=[...j];y[o]={...y[o],end_time:p.target.value},f(y)},className:"text-sm border border-slate-200 rounded-lg px-2 py-1.5"})]})]},l.day_of_week))}),e.jsx("div",{className:"mt-4",children:e.jsx(u,{variant:"shield",onClick:C,disabled:k,children:k?"Saving...":"Save Schedule"})})]}),e.jsxs(T,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-4",children:"Blocked Dates"}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"Block specific dates when you're unavailable (vacations, holidays, etc.)"}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx(S,{type:"date",value:b,onChange:l=>x(l.target.value),className:"flex-1"}),e.jsx(S,{placeholder:"Reason (optional)",value:D,onChange:l=>n(l.target.value),className:"flex-1"}),e.jsx(u,{variant:"shield",onClick:$,disabled:!b,children:e.jsx(Y,{className:"w-4 h-4"})})]}),a.length===0?e.jsx("p",{className:"text-sm text-slate-400 text-center py-4",children:"No blocked dates"}):e.jsx("div",{className:"space-y-2 max-h-80 overflow-y-auto",children:a.sort((l,o)=>l.blocked_date.localeCompare(o.blocked_date)).map(l=>e.jsxs("div",{className:"flex items-center justify-between bg-slate-50 rounded-lg px-3 py-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:new Date(l.blocked_date+"T00:00:00").toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})}),l.reason&&e.jsxs("span",{className:"text-slate-400 ml-2",children:["— ",l.reason]})]}),e.jsx("button",{onClick:()=>_(l.id),className:"text-red-400 hover:text-red-600",children:e.jsx(K,{className:"w-4 h-4"})})]},l.id))})]})]})}function ve({defaultDate:t,onClose:a,onCreated:h}){const[c,j]=i.useState(""),[f,k]=i.useState("consultation"),[N,b]=i.useState(t),[x,D]=i.useState("09:00"),[n,C]=i.useState("10:00"),[$,_]=i.useState(""),[l,o]=i.useState(""),[p,y]=i.useState(""),[L,B]=i.useState(!1),O=async()=>{if(!(!c||!N||!x||!n)){B(!0);try{await w.create({agent_id:0,title:c,type:f,date:N,start_time:x,end_time:n,location:$||void 0,video_link:l||void 0,notes:p||void 0}),h()}catch{}finally{B(!1)}}};return e.jsx(G,{isOpen:!0,onClose:a,title:"New Appointment",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(S,{label:"Title",placeholder:"e.g. Policy review with John",value:c,onChange:r=>j(r.target.value)}),e.jsx(ie,{label:"Type",value:f,onChange:r=>k(r.target.value),options:Object.entries(Z).map(([r,A])=>({value:r,label:A}))}),e.jsx(S,{label:"Date",type:"date",value:N,onChange:r=>b(r.target.value)}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(S,{label:"Start Time",type:"time",value:x,onChange:r=>D(r.target.value)}),e.jsx(S,{label:"End Time",type:"time",value:n,onChange:r=>C(r.target.value)})]}),e.jsx(S,{label:"Location",placeholder:"Office, virtual, address...",value:$,onChange:r=>_(r.target.value)}),e.jsx(S,{label:"Video Link",placeholder:"https://zoom.us/...",value:l,onChange:r=>o(r.target.value)}),e.jsx(S,{label:"Notes",placeholder:"Any additional details...",value:p,onChange:r=>y(r.target.value)}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(u,{variant:"ghost",onClick:a,children:"Cancel"}),e.jsx(u,{variant:"shield",onClick:O,disabled:L||!c||!N,children:L?"Creating...":"Create Appointment"})]})]})})}export{we as default};
