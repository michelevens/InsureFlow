import{j as e}from"./vendor-query-D5ml2kdZ.js";import{r as n}from"./vendor-react-C8VcOkCS.js";import{b as o,B as x,C,I as W}from"./index-BZEM9EbM.js";import{B as S}from"./Badge-8fS5vckW.js";import{M as $}from"./Modal-Cn8_xSIn.js";import{ax as _,P as B,n as L,aD as A,b1 as I,d as M,aY as O,an as D,a3 as U,a2 as F,R as H}from"./vendor-ui-tJ0aMxU9.js";const d={async list(){return o.get("/webhooks")},async create(t){return o.post("/webhooks",t)},async update(t,m){return o.put(`/webhooks/${t}`,m)},async remove(t){return o.delete(`/webhooks/${t}`)},async deliveries(t){return o.get(`/webhooks/${t}/deliveries`)},async test(t){return o.post(`/webhooks/${t}/test`)},async retry(t){return o.post(`/webhook-deliveries/${t}/retry`)},async eventTypes(){return o.get("/webhooks/event-types")}},X={success:F,failed:U,pending:D},Y={success:"text-savings-600",failed:"text-red-500",pending:"text-slate-400"};function ee(){const[t,m]=n.useState([]),[N,h]=n.useState(!0),[g,p]=n.useState({}),[y,i]=n.useState(!1),[r,j]=n.useState(null),[v,f]=n.useState([]),[k,b]=n.useState(!1),a=async()=>{h(!0);try{const[s,u]=await Promise.all([d.list(),d.eventTypes()]);m(s),p(u)}catch{}finally{h(!1)}};n.useEffect(()=>{a()},[]);const c=async s=>{await d.update(s.id,{is_active:!s.is_active}),a()},E=async s=>{await d.remove(s),r===s&&j(null),a()},R=async s=>{await d.test(s),r===s&&w(s)},w=async s=>{j(s),b(!0);try{const u=await d.deliveries(s);f(u)}catch{f([])}finally{b(!1)}},z=async s=>{await d.retry(s),r&&w(r)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Webhooks"}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Configure event-driven integrations"})]}),e.jsxs(x,{variant:"shield",onClick:()=>i(!0),children:[e.jsx(_,{className:"w-4 h-4 mr-1"})," New Webhook"]})]}),N?e.jsx(C,{className:"p-8 text-center",children:e.jsx("div",{className:"w-8 h-8 border-4 border-shield-200 border-t-shield-600 rounded-full animate-spin mx-auto"})}):t.length===0?e.jsxs(C,{className:"p-12 text-center",children:[e.jsx(B,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-500 mb-4",children:"No webhooks configured yet"}),e.jsxs(x,{variant:"shield",onClick:()=>i(!0),children:[e.jsx(_,{className:"w-4 h-4 mr-1"})," Create First Webhook"]})]}):e.jsx("div",{className:"space-y-3",children:t.map(s=>{const u=r===s.id;return e.jsxs(C,{className:"overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 cursor-pointer",onClick:()=>u?j(null):w(s.id),children:[u?e.jsx(L,{className:"w-5 h-5 text-slate-400"}):e.jsx(A,{className:"w-5 h-5 text-slate-400"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-slate-900",children:s.name}),s.is_active?e.jsx(S,{variant:"success",children:"Active"}):e.jsx(S,{variant:"danger",children:"Disabled"}),s.failure_count>0&&e.jsxs(S,{variant:"warning",children:[s.failure_count," failures"]})]}),e.jsx("p",{className:"text-sm text-slate-500 mt-0.5 font-mono",children:s.url})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-slate-400",children:[s.events.length," events"]}),e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>R(s.id),title:"Send test ping",children:e.jsx(I,{className:"w-4 h-4"})}),e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>c(s),children:s.is_active?"Disable":"Enable"}),e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>E(s.id),children:e.jsx(M,{className:"w-4 h-4 text-red-400"})})]})]}),e.jsx("div",{className:"px-4 pb-3",children:e.jsx("div",{className:"flex flex-wrap gap-1.5",children:s.events.map(l=>e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-shield-50 text-shield-700",children:l},l))})}),e.jsxs("div",{className:"px-4 pb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-slate-400",children:"Secret:"}),e.jsxs("code",{className:"text-xs bg-slate-100 px-2 py-0.5 rounded font-mono",children:[s.secret.slice(0,12),"..."]}),e.jsx("button",{onClick:()=>navigator.clipboard.writeText(s.secret),className:"text-slate-400 hover:text-slate-600",children:e.jsx(O,{className:"w-3.5 h-3.5"})})]}),u&&e.jsxs("div",{className:"border-t border-slate-100 p-4",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-700 mb-3",children:"Recent Deliveries"}),k?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("div",{className:"w-6 h-6 border-4 border-shield-200 border-t-shield-600 rounded-full animate-spin"})}):v.length===0?e.jsx("p",{className:"text-sm text-slate-400 text-center py-4",children:"No deliveries yet"}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:v.map(l=>{const T=X[l.status]||D,P=Y[l.status]||"text-slate-400";return e.jsxs("div",{className:"flex items-center justify-between bg-slate-50 rounded-lg px-3 py-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{className:`w-4 h-4 ${P}`}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:l.event_type}),l.response_status&&e.jsxs("span",{className:"text-slate-500 ml-2",children:["HTTP ",l.response_status]}),l.response_time_ms&&e.jsxs("span",{className:"text-slate-400 ml-2",children:[l.response_time_ms,"ms"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-slate-400",children:new Date(l.created_at).toLocaleString()}),l.status==="failed"&&e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>z(l.id),title:"Retry",children:e.jsx(H,{className:"w-3.5 h-3.5"})})]})]},l.id)})})]})]},s.id)})}),y&&e.jsx(q,{eventTypes:g,onClose:()=>i(!1),onCreated:a})]})}function q({eventTypes:t,onClose:m,onCreated:N}){const[h,g]=n.useState(""),[p,y]=n.useState(""),[i,r]=n.useState(new Set),[j,v]=n.useState(!1),f=a=>{const c=new Set(i);c.has(a)?c.delete(a):c.add(a),r(c)},k=()=>{r(new Set(Object.keys(t)))},b=async()=>{if(!(!h||!p||i.size===0)){v(!0);try{await d.create({name:h,url:p,events:Array.from(i)}),N(),m()}catch{}finally{v(!1)}}};return e.jsx($,{isOpen:!0,onClose:m,title:"New Webhook",size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(W,{label:"Name",placeholder:"e.g. CRM Sync, Slack Notifications",value:h,onChange:a=>g(a.target.value)}),e.jsx(W,{label:"URL",placeholder:"https://your-server.com/webhook",value:p,onChange:a=>y(a.target.value)}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Events"}),e.jsx("button",{className:"text-xs text-shield-600 hover:underline",onClick:k,children:"Select All"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-48 overflow-y-auto border border-slate-200 rounded-xl p-3",children:Object.entries(t).map(([a,c])=>e.jsxs("label",{className:"flex items-start gap-2 text-sm cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i.has(a),onChange:()=>f(a),className:"mt-0.5 rounded border-slate-300 text-shield-600 focus:ring-shield-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-slate-900",children:a}),e.jsx("p",{className:"text-xs text-slate-400",children:c})]})]},a))})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(x,{variant:"ghost",onClick:m,children:"Cancel"}),e.jsx(x,{variant:"shield",onClick:b,disabled:j||!h||!p||i.size===0,children:j?"Creating...":"Create Webhook"})]})]})})}export{ee as default};
