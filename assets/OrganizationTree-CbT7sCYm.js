import{j as e}from"./vendor-query-D5ml2kdZ.js";import{r as n}from"./vendor-react-C8VcOkCS.js";import{b as m,B as u,C as M,I as z,S as A}from"./index-BZEM9EbM.js";import{B as C}from"./Badge-8fS5vckW.js";import{M as B}from"./Modal-Cn8_xSIn.js";import{ax as $,d as P,E as H,ar as Q,ai as q,a8 as F,u as J,a1 as K,n as V,aD as W,Q as X}from"./vendor-ui-tJ0aMxU9.js";const h={async list(){return m.get("/organizations")},async tree(t){return m.get(`/organizations/${t}/tree`)},async create(t){return m.post("/organizations",t)},async update(t,l){return m.put(`/organizations/${t}`,l)},async remove(t){return m.delete(`/organizations/${t}`)},async members(t){return m.get(`/organizations/${t}/members`)},async addMember(t,l){return m.post(`/organizations/${t}/members`,l)},async updateMember(t,l,g){return m.put(`/organizations/${t}/members/${l}`,g)},async removeMember(t,l){return m.delete(`/organizations/${t}/members/${l}`)}},_={mga:"MGA",agency:"Agency",sub_agency:"Sub-Agency"},L={mga:"shield",agency:"info",sub_agency:"default"},Y={owner:"Owner",admin:"Admin",manager:"Manager",member:"Member"};function ie(){const[t,l]=n.useState([]),[g,i]=n.useState(!0),[a,o]=n.useState(null),[j,c]=n.useState([]),[b,p]=n.useState(!1),[x,y]=n.useState(new Set),[O,v]=n.useState(!1),[N,w]=n.useState(!1),r=async()=>{i(!0);try{const s=await h.list();l(s)}catch{}finally{i(!1)}};n.useEffect(()=>{r()},[]);const T=async s=>{o(s),p(!0);try{const d=await h.members(s.id);c(d)}catch{c([])}finally{p(!1)}},D=s=>{const d=new Set(x);d.has(s)?d.delete(s):d.add(s),y(d)},R=async s=>{await h.remove(s),a?.id===s&&o(null),r()},G=async s=>{if(!a)return;await h.removeMember(a.id,s);const d=await h.members(a.id);c(d)},k=t.filter(s=>!s.parent_id),E=(s,d=0)=>{const S=t.filter(f=>f.parent_id===s.id),I=x.has(s.id),U=a?.id===s.id;return e.jsxs("div",{style:{marginLeft:d*24},children:[e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-xl cursor-pointer transition-colors ${U?"bg-shield-50 border border-shield-200":"hover:bg-slate-50"}`,onClick:()=>T(s),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[S.length>0?e.jsx("button",{onClick:f=>{f.stopPropagation(),D(s.id)},className:"p-0.5",children:I?e.jsx(V,{className:"w-4 h-4 text-slate-400"}):e.jsx(W,{className:"w-4 h-4 text-slate-400"})}):e.jsx("span",{className:"w-5"}),e.jsx(X,{className:"w-4 h-4 text-shield-600"}),e.jsx("span",{className:"font-medium text-slate-900",children:s.name}),e.jsx(C,{variant:L[s.type],children:_[s.type]}),!s.is_active&&e.jsx(C,{variant:"danger",children:"Inactive"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-400",children:[s.city&&s.state&&e.jsxs("span",{children:[s.city,", ",s.state]}),S.length>0&&e.jsxs("span",{children:[S.length," sub-orgs"]})]})]}),I&&S.map(f=>E(f,d+1))]},s.id)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Organizations"}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Manage MGA, agency, and sub-agency hierarchy"})]}),e.jsxs(u,{variant:"shield",onClick:()=>v(!0),children:[e.jsx($,{className:"w-4 h-4 mr-1"})," New Organization"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(M,{className:"p-4",children:[e.jsx("h2",{className:"text-sm font-bold text-slate-700 mb-3",children:"Hierarchy"}),g?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"w-6 h-6 border-4 border-shield-200 border-t-shield-600 rounded-full animate-spin"})}):k.length===0?e.jsx("p",{className:"text-sm text-slate-400 text-center py-8",children:"No organizations yet"}):e.jsx("div",{className:"space-y-1",children:k.map(s=>E(s))})]})}),e.jsx("div",{className:"lg:col-span-2",children:a?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(M,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:a.name}),e.jsx(C,{variant:L[a.type],children:_[a.type]})]}),e.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:["Level ",a.level," Â· ",a.slug]})]}),e.jsxs(u,{variant:"danger",size:"sm",onClick:()=>R(a.id),children:[e.jsx(P,{className:"w-4 h-4 mr-1"})," Delete"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[a.email&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[e.jsx(H,{className:"w-4 h-4"})," ",a.email]}),a.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[e.jsx(Q,{className:"w-4 h-4"})," ",a.phone]}),a.website&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[e.jsx(q,{className:"w-4 h-4"})," ",a.website]}),a.address&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[e.jsx(F,{className:"w-4 h-4"})," ",a.address,", ",a.city," ",a.state," ",a.zip]})]})]}),e.jsxs(M,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-bold text-slate-900 flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-shield-600"})," Members"]}),e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>w(!0),children:[e.jsx($,{className:"w-3 h-3 mr-1"})," Add Member"]})]}),b?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("div",{className:"w-6 h-6 border-4 border-shield-200 border-t-shield-600 rounded-full animate-spin"})}):j.length===0?e.jsx("p",{className:"text-sm text-slate-400 text-center py-4",children:"No members"}):e.jsx("div",{className:"space-y-2",children:j.map(s=>e.jsxs("div",{className:"flex items-center justify-between bg-slate-50 rounded-lg px-4 py-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-shield-100 text-shield-700 flex items-center justify-center text-sm font-bold",children:s.user?.name?.charAt(0)||"?"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900 text-sm",children:s.user?.name}),e.jsx("p",{className:"text-xs text-slate-500",children:s.user?.email})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{variant:s.role==="owner"?"shield":"default",children:Y[s.role]}),s.role!=="owner"&&e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>G(s.id),children:e.jsx(P,{className:"w-3.5 h-3.5 text-red-400"})})]})]},s.id))})]})]}):e.jsxs(M,{className:"p-12 text-center",children:[e.jsx(K,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-500",children:"Select an organization to view details"})]})})]}),O&&e.jsx(Z,{parentOrgs:t,onClose:()=>v(!1),onCreated:r}),N&&a&&e.jsx(ee,{orgId:a.id,onClose:()=>w(!1),onAdded:async()=>{const s=await h.members(a.id);c(s)}})]})}function Z({parentOrgs:t,onClose:l,onCreated:g}){const[i,a]=n.useState(""),[o,j]=n.useState("agency"),[c,b]=n.useState(""),[p,x]=n.useState(""),[y,O]=n.useState(""),[v,N]=n.useState(!1),w=async()=>{if(i){N(!0);try{await h.create({name:i,type:o,parent_id:c?Number(c):null,email:p||void 0,phone:y||void 0}),g(),l()}catch{}finally{N(!1)}}};return e.jsx(B,{isOpen:!0,onClose:l,title:"New Organization",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(z,{label:"Name",placeholder:"Organization name",value:i,onChange:r=>a(r.target.value)}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(A,{label:"Type",options:[{value:"mga",label:"MGA"},{value:"agency",label:"Agency"},{value:"sub_agency",label:"Sub-Agency"}],value:o,onChange:r=>j(r.target.value)}),e.jsx(A,{label:"Parent Organization",options:[{value:"",label:"None (Root)"},...t.map(r=>({value:String(r.id),label:r.name}))],value:c,onChange:r=>b(r.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(z,{label:"Email",type:"email",value:p,onChange:r=>x(r.target.value)}),e.jsx(z,{label:"Phone",value:y,onChange:r=>O(r.target.value)})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(u,{variant:"ghost",onClick:l,children:"Cancel"}),e.jsx(u,{variant:"shield",onClick:w,disabled:v||!i,children:v?"Creating...":"Create"})]})]})})}function ee({orgId:t,onClose:l,onAdded:g}){const[i,a]=n.useState(""),[o,j]=n.useState("member"),[c,b]=n.useState(!1),p=async()=>{if(i){b(!0);try{await h.addMember(t,{user_id:Number(i),role:o}),await g(),l()}catch{}finally{b(!1)}}};return e.jsx(B,{isOpen:!0,onClose:l,title:"Add Member",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(z,{label:"User ID",type:"number",placeholder:"Enter user ID",value:i,onChange:x=>a(x.target.value)}),e.jsx(A,{label:"Role",options:[{value:"member",label:"Member"},{value:"manager",label:"Manager"},{value:"admin",label:"Admin"},{value:"owner",label:"Owner"}],value:o,onChange:x=>j(x.target.value)}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(u,{variant:"ghost",onClick:l,children:"Cancel"}),e.jsx(u,{variant:"shield",onClick:p,disabled:c||!i,children:c?"Adding...":"Add Member"})]})]})})}export{ie as default};
