import{j as e}from"./vendor-query-D5ml2kdZ.js";import{r as c}from"./vendor-react-C8VcOkCS.js";import{C as r}from"./index-BZEM9EbM.js";import{S as m}from"./StatsCard-Cevq-5Ea.js";import{a as d}from"./analytics-Bna6lnj0.js";import{L as w,u,a as S,S as _,D as C,z as L}from"./vendor-ui-tJ0aMxU9.js";function k(){const[o,f]=c.useState({}),[a,j]=c.useState([]),[x,p]=c.useState([]),[t,N]=c.useState(null),[v,h]=c.useState(!0);c.useEffect(()=>{g()},[]);const g=async()=>{try{h(!0);const[s,i,l,n]=await Promise.allSettled([d.getDashboardStats(),d.getRevenueTrends(6),d.getAgentPerformance(3,10),d.getConversionFunnel(6)]);s.status==="fulfilled"&&f(s.value),i.status==="fulfilled"&&j(i.value.trends||[]),l.status==="fulfilled"&&p(l.value.agents||[]),n.status==="fulfilled"&&N(n.value)}catch{}finally{h(!1)}};if(v)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Platform Analytics"}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Comprehensive platform performance metrics"})]}),e.jsxs(r,{className:"p-12 text-center",children:[e.jsx(w,{className:"w-8 h-8 animate-spin text-shield-500 mx-auto"}),e.jsx("p",{className:"text-slate-500 mt-2",children:"Loading analytics..."})]})]});const b=a.length>0?Math.max(...a.map(s=>s.policies_count||0),1):1;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Platform Analytics"}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Comprehensive platform performance metrics"})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(m,{icon:e.jsx(u,{className:"w-5 h-5"}),label:"Total Users",value:String(o.total_users||0)}),e.jsx(m,{icon:e.jsx(S,{className:"w-5 h-5"}),label:"Lead Conversion",value:t?`${t.conversion_rate}%`:"-"}),e.jsx(m,{icon:e.jsx(_,{className:"w-5 h-5"}),label:"Total Policies",value:String(o.total_policies||0)}),e.jsx(m,{icon:e.jsx(C,{className:"w-5 h-5"}),label:"Platform Revenue",value:`$${Number(o.platform_revenue||0).toLocaleString()}`,variant:"savings"})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsx(r,{children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Policy Volume by Month"}),a.length===0?e.jsx("div",{className:"flex items-center justify-center h-48 text-slate-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx(L,{className:"w-10 h-10 mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:"No data yet"})]})}):e.jsx("div",{className:"flex items-end gap-3 h-48",children:a.map(s=>e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-slate-700",children:s.policies_count}),e.jsx("div",{className:"w-full bg-shield-500 rounded-t-lg transition-all",style:{height:`${s.policies_count/b*100}%`,minHeight:s.policies_count>0?"8px":"2px"}}),e.jsx("span",{className:"text-xs text-slate-500",children:s.month.split("-")[1]||s.month})]},s.month))})]})}),e.jsx(r,{children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Top Agents by Commission"}),x.length===0?e.jsx("div",{className:"flex items-center justify-center h-48 text-slate-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx(u,{className:"w-10 h-10 mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:"No agent data yet"})]})}):e.jsx("div",{className:"space-y-4",children:x.map(s=>{const i=Math.max(...x.map(n=>Number(n.total_commission||0)),1),l=Math.round(Number(s.total_commission||0)/i*100);return e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-24 text-sm font-medium text-slate-700 truncate",children:s.name}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"h-6 bg-slate-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-shield-500 rounded-full flex items-center pl-3",style:{width:`${Math.max(l,5)}%`},children:l>20&&e.jsxs("span",{className:"text-xs font-medium text-white",children:[s.policy_count," policies"]})})})}),e.jsxs("div",{className:"text-right w-20",children:[e.jsxs("p",{className:"text-sm font-medium text-slate-900",children:["$",Number(s.total_commission||0).toLocaleString()]}),e.jsxs("p",{className:"text-xs text-slate-500",children:[s.lead_count," leads"]})]})]},s.id)})})]})})]}),t&&t.funnel.length>0&&e.jsx(r,{children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:["Conversion Funnel (Last ",t.period_months," Months)"]}),e.jsx("div",{className:"space-y-3",children:t.funnel.map((s,i)=>{const l=Math.max(...t.funnel.map(y=>y.count),1),n=Math.max(s.count/l*100,3);return e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-32 text-sm font-medium text-slate-700",children:s.stage}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"h-8 bg-slate-100 rounded-lg overflow-hidden",children:e.jsx("div",{className:`h-full rounded-lg flex items-center pl-3 ${i<3?"bg-shield-500":"bg-savings-500"}`,style:{width:`${n}%`},children:e.jsx("span",{className:"text-xs font-medium text-white",children:s.count})})})})]},s.stage)})}),e.jsxs("p",{className:"text-sm text-slate-500 mt-4",children:["Overall conversion rate: ",e.jsxs("span",{className:"font-semibold text-shield-600",children:[t.conversion_rate,"%"]})]})]})}),a.length>0&&e.jsx(r,{children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Monthly Breakdown"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-100",children:[e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider pb-3",children:"Month"}),e.jsx("th",{className:"text-right text-xs font-medium text-slate-500 uppercase tracking-wider pb-3",children:"Policies"}),e.jsx("th",{className:"text-right text-xs font-medium text-slate-500 uppercase tracking-wider pb-3",children:"Premium Volume"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-50",children:a.map(s=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"py-3 font-medium text-slate-900",children:s.month}),e.jsx("td",{className:"py-3 text-right text-sm text-slate-700",children:s.policies_count}),e.jsxs("td",{className:"py-3 text-right text-sm font-medium text-savings-600",children:["$",Number(s.premium_volume||0).toLocaleString()]})]},s.month))})]})})]})})]})}export{k as default};
