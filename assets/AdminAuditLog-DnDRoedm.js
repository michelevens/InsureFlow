import{j as e}from"./vendor-query-D5ml2kdZ.js";import{r as a}from"./vendor-react-C8VcOkCS.js";import{b as y,C as w,S as _,I as S,B as p}from"./index-8sQqf4Gi.js";import{B as P}from"./Badge-CDix051U.js";import{ad as I,W as C,ae as $,L as U,F as L,a1 as z,s as B,a0 as R,aX as J,aD as M}from"./vendor-ui-tJ0aMxU9.js";const V={getAuditLogs(l){const n=new URLSearchParams;l&&Object.entries(l).forEach(([r,s])=>{s!==void 0&&s!==""&&n.append(r,String(s))});const d=n.toString();return y.get(`/admin/audit-logs${d?`?${d}`:""}`)},getEntityAuditTrail(l,n){return y.get(`/audit-logs/${l}/${n}`)}},q={created:"success",updated:"info",deleted:"danger",login:"default",login_failed:"warning",logout:"default",registered:"success",status_changed:"info",approved:"success",rejected:"danger",signed:"success",submitted:"info"},W={User:R,Application:B,Policy:z,Document:L};function Y(){const[l,n]=a.useState([]),[d,r]=a.useState(!0),[s,i]=a.useState(1),[c,A]=a.useState(1),[v,E]=a.useState(0),[o,h]=a.useState(""),[x,j]=a.useState(""),[m,b]=a.useState(""),[u,f]=a.useState(""),[T,F]=a.useState(null);return a.useEffect(()=>{r(!0),V.getAuditLogs({event_type:o||void 0,auditable_type:x||void 0,date_from:m||void 0,date_to:u||void 0,page:s,per_page:30}).then(t=>{n(t.data||[]),A(t.last_page),E(t.total)}).catch(()=>{I.error("Failed to load audit logs")}).finally(()=>r(!1))},[s,o,x,m,u]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-900 flex items-center gap-3",children:[e.jsx(C,{className:"w-6 h-6 text-teal-600"}),"Audit Log"]}),e.jsxs("p",{className:"text-slate-500 mt-1",children:["Immutable record of all platform activity (",v," entries)"]})]}),e.jsx(w,{className:"p-4",children:e.jsxs("div",{className:"flex flex-wrap items-end gap-3",children:[e.jsx("div",{className:"flex-1 min-w-[150px]",children:e.jsx(_,{label:"Event Type",value:o,onChange:t=>{h(t.target.value),i(1)},options:[{value:"",label:"All Events"},{value:"created",label:"Created"},{value:"updated",label:"Updated"},{value:"deleted",label:"Deleted"},{value:"login",label:"Login"},{value:"login_failed",label:"Login Failed"},{value:"logout",label:"Logout"},{value:"registered",label:"Registered"},{value:"status_changed",label:"Status Changed"},{value:"approved",label:"Approved"},{value:"signed",label:"Signed"},{value:"submitted",label:"Submitted"}]})}),e.jsx("div",{className:"flex-1 min-w-[150px]",children:e.jsx(_,{label:"Entity Type",value:x,onChange:t=>{j(t.target.value),i(1)},options:[{value:"",label:"All Entities"},{value:"User",label:"User"},{value:"Application",label:"Application"},{value:"Policy",label:"Policy"},{value:"Document",label:"Document"},{value:"Signature",label:"Signature"},{value:"Commission",label:"Commission"},{value:"Lead",label:"Lead"}]})}),e.jsx("div",{className:"flex-1 min-w-[140px]",children:e.jsx(S,{label:"From",type:"date",value:m,onChange:t=>{b(t.target.value),i(1)}})}),e.jsx("div",{className:"flex-1 min-w-[140px]",children:e.jsx(S,{label:"To",type:"date",value:u,onChange:t=>{f(t.target.value),i(1)}})}),e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>{h(""),j(""),b(""),f(""),i(1)},children:[e.jsx($,{className:"w-4 h-4 mr-1"})," Clear"]})]})}),e.jsx(w,{children:e.jsxs("div",{className:"p-6",children:[d?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(U,{className:"w-6 h-6 text-teal-600 animate-spin"})}):l.length===0?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(C,{className:"w-10 h-10 text-slate-300 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-600 font-medium",children:"No audit events found"}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Try adjusting your filters"})]}):e.jsx("div",{className:"space-y-0",children:l.map((t,k)=>{const D=W[t.auditable_type]||L,O=q[t.event_type]||"default",g=T===t.id,N=k===l.length-1;return e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center flex-shrink-0",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-100 border-2 border-slate-200 flex items-center justify-center text-slate-500",children:e.jsx(D,{className:"w-3.5 h-3.5"})}),!N&&e.jsx("div",{className:"w-0.5 flex-1 min-h-[24px] bg-slate-200"})]}),e.jsxs("div",{className:`flex-1 ${N?"pb-0":"pb-4"}`,children:[e.jsxs("button",{onClick:()=>F(g?null:t.id),className:"w-full text-left",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(P,{variant:O,size:"sm",children:t.event_type.replace(/_/g," ")}),e.jsx("span",{className:"text-sm font-medium text-slate-700",children:t.auditable_type}),e.jsxs("span",{className:"text-xs text-slate-400 font-mono",children:["#",t.auditable_id]}),e.jsx("span",{className:"text-xs text-slate-400 ml-auto",children:new Date(t.created_at).toLocaleString()})]}),e.jsxs("div",{className:"text-xs text-slate-500 mt-0.5",children:[t.actor?`${t.actor.name} (${t.actor_role})`:t.actor_role,t.ip_address&&e.jsx("span",{className:"ml-2 text-slate-400",children:t.ip_address})]})]}),g&&e.jsxs("div",{className:"mt-2 bg-slate-50 rounded-lg p-3 text-xs space-y-2",children:[t.old_values&&Object.keys(t.old_values).length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-slate-600",children:"Old Values:"}),e.jsx("pre",{className:"mt-1 bg-white rounded p-2 overflow-x-auto text-slate-700 border border-slate-200",children:JSON.stringify(t.old_values,null,2)})]}),t.new_values&&Object.keys(t.new_values).length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-slate-600",children:"New Values:"}),e.jsx("pre",{className:"mt-1 bg-white rounded p-2 overflow-x-auto text-slate-700 border border-slate-200",children:JSON.stringify(t.new_values,null,2)})]}),t.metadata&&Object.keys(t.metadata).length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-slate-600",children:"Metadata:"}),e.jsx("pre",{className:"mt-1 bg-white rounded p-2 overflow-x-auto text-slate-700 border border-slate-200",children:JSON.stringify(t.metadata,null,2)})]}),t.user_agent&&e.jsxs("p",{className:"text-slate-400 truncate",children:[e.jsx("span",{className:"font-semibold text-slate-600",children:"User Agent:"})," ",t.user_agent]})]})]})]},t.id)})}),c>1&&e.jsxs("div",{className:"flex items-center justify-between pt-4 mt-4 border-t border-slate-100",children:[e.jsxs("p",{className:"text-sm text-slate-500",children:["Page ",s," of ",c," (",v," total)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{variant:"outline",size:"sm",onClick:()=>i(t=>Math.max(1,t-1)),disabled:s<=1,children:e.jsx(J,{className:"w-4 h-4"})}),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>i(t=>Math.min(c,t+1)),disabled:s>=c,children:e.jsx(M,{className:"w-4 h-4"})})]})]})]})})]})}export{Y as default};
