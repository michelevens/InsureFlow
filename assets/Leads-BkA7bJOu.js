import{j as e}from"./vendor-query-D5ml2kdZ.js";import{r as d}from"./vendor-react-C8VcOkCS.js";import{b as N,A as Se,B as y,C as L,I as p,S as T,T as ne}from"./index-BZEM9EbM.js";import{B as H}from"./Badge-8fS5vckW.js";import{M as B}from"./Modal-Cn8_xSIn.js";import{m as $e}from"./marketplace-CKdKK_oK.js";import{ad as S,aD as ae,v as me,aE as ke,ax as Y,a as Le,n as Ae,a0 as xe,h as ue,Q as Pe,aF as Fe,al as Oe,d as te,a1 as he,s as Ie,q as K,a7 as Te,aG as Re,ae as De,ar as Ee,E as Me,F as qe,D as pe,aH as ce,a3 as X,T as ze,aI as Be,aJ as Ue,R as de,aa as He}from"./vendor-ui-tJ0aMxU9.js";const ge={async getLeads(s){const l=new URLSearchParams;s?.status&&l.set("status",s.status),s?.search&&l.set("search",s.search);const a=await N.get(`/crm/leads?${l}`),x=a.leads?.data??[],c=a.counts??{},b=Object.values(c).reduce((f,g)=>f+g,0);return{items:x,counts:{total:b,new:c.new??0,contacted:c.contacted??0,quoted:c.quoted??0,applied:c.applied??0,won:c.won??0,lost:c.lost??0}}},async getLead(s){return N.get(`/crm/leads/${s}`)},async createLead(s){return N.post("/crm/leads",s)},async updateLead(s,l){return N.put(`/crm/leads/${s}`,l)},async logActivity(s,l){return N.post(`/crm/leads/${s}/activity`,l)}},F={async list(s){return N.get(`/crm/leads/${s}/scenarios`)},async get(s,l){return N.get(`/crm/leads/${s}/scenarios/${l}`)},async create(s,l){return N.post(`/crm/leads/${s}/scenarios`,l)},async update(s,l,a){return N.put(`/crm/leads/${s}/scenarios/${l}`,a)},async remove(s,l){return N.delete(`/crm/leads/${s}/scenarios/${l}`)},async addObject(s,l,a){return N.post(`/crm/leads/${s}/scenarios/${l}/objects`,a)},async updateObject(s,l,a,x){return N.put(`/crm/leads/${s}/scenarios/${l}/objects/${a}`,x)},async removeObject(s,l,a){return N.delete(`/crm/leads/${s}/scenarios/${l}/objects/${a}`)},async addCoverage(s,l,a){return N.post(`/crm/leads/${s}/scenarios/${l}/coverages`,a)},async updateCoverage(s,l,a,x){return N.put(`/crm/leads/${s}/scenarios/${l}/coverages/${a}`,x)},async removeCoverage(s,l,a){return N.delete(`/crm/leads/${s}/scenarios/${l}/coverages/${a}`)},async addQuote(s,l,a){return N.post(`/crm/leads/${s}/scenarios/${l}/quotes`,a)},async updateQuote(s,l,a,x){return N.put(`/crm/leads/${s}/scenarios/${l}/quotes/${a}`,x)},async removeQuote(s,l,a){return N.delete(`/crm/leads/${s}/scenarios/${l}/quotes/${a}`)},async selectQuote(s,l,a){return N.post(`/crm/leads/${s}/scenarios/${l}/quotes/${a}/select`)},async convert(s,l,a){return N.post(`/crm/leads/${s}/scenarios/${l}/convert`,a)},async productTypes(){return N.get("/insurance/product-types")},async suggestedCoverages(s){return N.get(`/insurance/suggested-coverages/${s}`)},async generateProposal(s,l){const a=localStorage.getItem("auth_token"),x=await fetch(`${Se}/crm/leads/${s}/scenarios/${l}/proposal`,{method:"POST",headers:{Accept:"application/pdf",...a?{Authorization:`Bearer ${a}`}:{}}});if(!x.ok){const g=await x.json().catch(()=>({message:"PDF generation failed"}));throw new Error(g.message||`HTTP ${x.status}`)}const c=await x.blob(),b=URL.createObjectURL(c),f=document.createElement("a");f.href=b,f.download=x.headers.get("content-disposition")?.match(/filename="?(.+?)"?$/)?.[1]??`proposal-${l}.pdf`,document.body.appendChild(f),f.click(),f.remove(),URL.revokeObjectURL(b)}},le={async rateScenario(s,l){return(await N.post(`/rate/scenario/${s}`,l)).rating},async getOptions(s,l){const a=l?`?version=${encodeURIComponent(l)}`:"";return N.get(`/rate/options/${encodeURIComponent(s)}${a}`)},async getAudit(s){return N.get(`/rate/audit/${s}`)},async getHistory(s){return N.get(`/rate/history/${s}`)},async getProducts(){return N.get("/rate/products")}},Z={new:{label:"New",variant:"shield"},contacted:{label:"Contacted",variant:"info"},quoted:{label:"Quoted",variant:"warning"},applied:{label:"Applied",variant:"info"},won:{label:"Won",variant:"success"},lost:{label:"Lost",variant:"danger"}},oe={draft:{label:"Draft",variant:"default"},quoting:{label:"Quoting",variant:"shield"},quoted:{label:"Quoted",variant:"warning"},comparing:{label:"Comparing",variant:"info"},selected:{label:"Selected",variant:"info"},applied:{label:"Applied",variant:"info"},bound:{label:"Bound",variant:"success"},declined:{label:"Declined",variant:"danger"},expired:{label:"Expired",variant:"danger"}},Qe={person:xe,vehicle:Oe,property:Fe,business:Pe,other:ue},We=[{value:"",label:"All Statuses"},{value:"new",label:"New"},{value:"contacted",label:"Contacted"},{value:"quoted",label:"Quoted"},{value:"applied",label:"Applied"},{value:"won",label:"Won"},{value:"lost",label:"Lost"}];function U(s){return s==null?"—":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s)}function G(s){return s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"—"}function je(s){return s.replace(/_/g," ").replace(/\b\w/g,l=>l.toUpperCase())}function ds(){const[s,l]=d.useState([]),[a,x]=d.useState({total:0,new:0,contacted:0,quoted:0,applied:0,won:0,lost:0}),[c,b]=d.useState(""),[f,g]=d.useState(""),[r,i]=d.useState(!0),[j,u]=d.useState(null),[_,$]=d.useState([]),[n,k]=d.useState(null),[A,P]=d.useState(!1),[Q,R]=d.useState(!1),[W,I]=d.useState(!1),[D,M]=d.useState(null),[q,w]=d.useState(null),[z,t]=d.useState(null),[m,C]=d.useState(null),[ee,se]=d.useState(!1),[ve,be]=d.useState({}),V=d.useCallback(async()=>{i(!0);try{const v=await ge.getLeads({status:f||void 0,search:c||void 0});l(v.items),x(v.counts)}catch{S.error("Failed to load leads")}finally{i(!1)}},[f,c]);d.useEffect(()=>{V()},[V]),d.useEffect(()=>{F.productTypes().then(be).catch(()=>{S.error("Failed to load product types")})},[]);const re=async v=>{u(v),P(!0);try{const o=await F.list(v.id);$(o)}catch{$([])}finally{P(!1)}},fe=()=>{u(null),$([]),k(null)},E=async()=>{if(!j)return;const v=await F.list(j.id);$(v)},ye=async v=>{j&&(await F.remove(j.id,v),await E())},Ne=async(v,o)=>{j&&(await F.removeObject(j.id,v,o),await E())},_e=async(v,o)=>{j&&(await F.removeCoverage(j.id,v,o),await E())},ie=Object.entries(ve).flatMap(([v,o])=>Object.entries(o).map(([O,J])=>({value:O,label:`${J} (${v})`})));if(j){const v=Z[j.status]||Z.new;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(y,{variant:"ghost",size:"sm",onClick:fe,children:[e.jsx(ae,{className:"w-4 h-4 rotate-180"})," Back"]}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-12 h-12 rounded-full bg-shield-100 text-shield-700 flex items-center justify-center text-lg font-bold",children:[j.first_name[0],j.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-900",children:[j.first_name," ",j.last_name]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-500",children:[e.jsx("span",{children:j.email}),e.jsx("span",{children:j.phone}),e.jsx(H,{variant:v.variant,children:v.label})]})]})]})}),j.source!=="marketplace"&&e.jsxs(y,{variant:"ghost",size:"sm",onClick:()=>se(!0),children:[e.jsx(me,{className:"w-4 h-4 mr-1"})," Sell on Marketplace"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(L,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Insurance Type"}),e.jsx("p",{className:"font-medium text-slate-900 capitalize",children:j.insurance_type})]}),e.jsxs(L,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Source"}),e.jsx("p",{className:"font-medium text-slate-900 capitalize",children:j.source})]}),e.jsxs(L,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Scenarios"}),e.jsx("p",{className:"font-medium text-slate-900",children:_.length})]}),e.jsxs(L,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Created"}),e.jsx("p",{className:"font-medium text-slate-900",children:G(j.created_at)})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-bold text-slate-900 flex items-center gap-2",children:[e.jsx(ke,{className:"w-5 h-5 text-shield-600"})," Scenarios"]}),e.jsxs(y,{variant:"shield",size:"sm",onClick:()=>I(!0),children:[e.jsx(Y,{className:"w-4 h-4 mr-1"})," New Scenario"]})]}),A?e.jsx(L,{className:"p-8 text-center",children:e.jsx("div",{className:"w-8 h-8 border-4 border-shield-200 border-t-shield-600 rounded-full animate-spin mx-auto"})}):_.length===0?e.jsxs(L,{className:"p-8 text-center",children:[e.jsx(Le,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-500 mb-4",children:"No scenarios yet. Create one to start building coverage options."}),e.jsxs(y,{variant:"shield",onClick:()=>I(!0),children:[e.jsx(Y,{className:"w-4 h-4 mr-1"})," Create First Scenario"]})]}):e.jsx("div",{className:"space-y-3",children:_.map(o=>{const O=n===o.id,J=oe[o.status]||oe.draft,we=ie.find(h=>h.value===o.product_type)?.label||o.product_type;return e.jsxs(L,{className:"overflow-hidden",children:[e.jsxs("button",{className:"w-full flex items-center justify-between p-4 hover:bg-slate-50 transition-colors text-left",onClick:()=>k(O?null:o.id),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[O?e.jsx(Ae,{className:"w-5 h-5 text-slate-400"}):e.jsx(ae,{className:"w-5 h-5 text-slate-400"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-slate-900",children:o.scenario_name}),e.jsx(H,{variant:J.variant,children:J.label}),e.jsxs("span",{className:"text-xs text-slate-400",children:["P",o.priority]})]}),e.jsx("p",{className:"text-sm text-slate-500 mt-0.5",children:we})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-500",children:[o.target_premium_monthly!=null&&e.jsxs("span",{children:["Target: ",U(o.target_premium_monthly),"/mo"]}),o.best_quoted_premium!=null&&e.jsxs("span",{className:"text-savings-600 font-medium",children:["Best: ",U(o.best_quoted_premium),"/mo"]}),e.jsxs("span",{children:[o.insured_objects.length," objects"]}),e.jsxs("span",{children:[o.coverages.length," coverages"]})]})]}),O&&e.jsxs("div",{className:"border-t border-slate-100 p-4 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[o.effective_date_desired&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Effective Date:"})," ",e.jsx("span",{className:"font-medium",children:G(o.effective_date_desired)})]}),o.current_carrier&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Current Carrier:"})," ",e.jsx("span",{className:"font-medium",children:o.current_carrier})]}),o.current_premium_monthly!=null&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Current Premium:"})," ",e.jsxs("span",{className:"font-medium",children:[U(o.current_premium_monthly),"/mo"]})]}),o.current_policy_expiration&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Expiration:"})," ",e.jsx("span",{className:"font-medium",children:G(o.current_policy_expiration)})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-700 flex items-center gap-1.5",children:[e.jsx(xe,{className:"w-4 h-4"})," Insured Objects"]}),e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>M(o.id),children:[e.jsx(Y,{className:"w-3 h-3 mr-1"})," Add"]})]}),o.insured_objects.length===0?e.jsx("p",{className:"text-sm text-slate-400 italic",children:"No insured objects added yet"}):e.jsx("div",{className:"space-y-2",children:o.insured_objects.map(h=>{const Ce=Qe[h.object_type]||ue;return e.jsxs("div",{className:"flex items-center justify-between bg-slate-50 rounded-lg px-3 py-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ce,{className:"w-4 h-4 text-shield-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-slate-900 text-sm",children:h.name}),h.relationship&&e.jsxs("span",{className:"text-xs text-slate-500 ml-2",children:["(",h.relationship,")"]}),e.jsxs("div",{className:"text-xs text-slate-400 mt-0.5",children:[h.object_type==="person"&&h.date_of_birth&&`DOB: ${G(h.date_of_birth)}`,h.object_type==="vehicle"&&h.vehicle_year&&`${h.vehicle_year} ${h.vehicle_make} ${h.vehicle_model}`,h.object_type==="property"&&h.address_line1&&`${h.address_line1}, ${h.city} ${h.state}`,h.object_type==="business"&&h.naics_code&&`NAICS: ${h.naics_code}`]})]})]}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>Ne(o.id,h.id),children:e.jsx(te,{className:"w-3.5 h-3.5 text-red-400"})})]},h.id)})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-700 flex items-center gap-1.5",children:[e.jsx(he,{className:"w-4 h-4"})," Coverages"]}),e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>w(o.id),children:[e.jsx(Y,{className:"w-3 h-3 mr-1"})," Add"]})]}),o.coverages.length===0?e.jsx("p",{className:"text-sm text-slate-400 italic",children:"No coverages configured yet"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-xs text-slate-500 border-b border-slate-100",children:[e.jsx("th",{className:"pb-2 pr-4",children:"Coverage"}),e.jsx("th",{className:"pb-2 pr-4",children:"Category"}),e.jsx("th",{className:"pb-2 pr-4 text-right",children:"Limit"}),e.jsx("th",{className:"pb-2 pr-4 text-right",children:"Deductible"}),e.jsx("th",{className:"pb-2 pr-4 text-right",children:"Benefit"}),e.jsx("th",{className:"pb-2 text-center",children:"Included"}),e.jsx("th",{className:"pb-2"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-50",children:o.coverages.map(h=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-2 pr-4 font-medium text-slate-900",children:je(h.coverage_type)}),e.jsx("td",{className:"py-2 pr-4",children:e.jsx(H,{variant:"default",children:h.coverage_category})}),e.jsx("td",{className:"py-2 pr-4 text-right",children:U(h.limit_amount)}),e.jsx("td",{className:"py-2 pr-4 text-right",children:U(h.deductible_amount)}),e.jsx("td",{className:"py-2 pr-4 text-right",children:U(h.benefit_amount)}),e.jsx("td",{className:"py-2 text-center",children:h.is_included?e.jsx("span",{className:"text-savings-600",children:"Yes"}):e.jsx("span",{className:"text-slate-400",children:"No"})}),e.jsx("td",{className:"py-2 text-right",children:e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>_e(o.id,h.id),children:e.jsx(te,{className:"w-3.5 h-3.5 text-red-400"})})})]},h.id))})]})})]}),o.notes&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-slate-700 mb-1",children:"Notes"}),e.jsx("p",{className:"text-sm text-slate-600 whitespace-pre-wrap",children:o.notes})]}),o.applications&&o.applications.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-700 flex items-center gap-1.5 mb-2",children:[e.jsx(Ie,{className:"w-4 h-4"})," Applications (",o.applications.length,")"]}),e.jsx("div",{className:"space-y-2",children:o.applications.map(h=>e.jsxs("div",{className:"flex items-center justify-between bg-slate-50 rounded-lg px-3 py-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:h.reference}),e.jsx("span",{className:"text-slate-500 ml-2",children:h.carrier_name})]}),e.jsx(H,{variant:"info",children:h.status})]},h.id))})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-2 border-t border-slate-100",children:[e.jsxs(y,{variant:"shield",size:"sm",onClick:()=>C(o.id),children:[e.jsx(K,{className:"w-4 h-4 mr-1"})," Rate Scenario"]}),e.jsxs(y,{variant:"shield",size:"sm",onClick:()=>t(o.id),children:[e.jsx(Te,{className:"w-4 h-4 mr-1"})," Convert to Application"]}),e.jsxs(y,{variant:"outline",size:"sm",onClick:async()=>{try{await F.generateProposal(j.id,o.id),S.success("Proposal PDF downloaded")}catch(h){S.error(h instanceof Error?h.message:"Failed to generate proposal")}},children:[e.jsx(Re,{className:"w-4 h-4 mr-1"})," Proposal PDF"]}),e.jsxs(y,{variant:"danger",size:"sm",onClick:()=>ye(o.id),children:[e.jsx(te,{className:"w-4 h-4 mr-1"})," Delete"]})]})]})]},o.id)})}),W&&e.jsx(Je,{leadId:j.id,productOptions:ie,onClose:()=>I(!1),onCreated:E}),D!==null&&e.jsx(Xe,{leadId:j.id,scenarioId:D,onClose:()=>M(null),onCreated:E}),q!==null&&e.jsx(Ze,{leadId:j.id,scenarioId:q,scenario:_.find(o=>o.id===q),onClose:()=>w(null),onCreated:E}),z!==null&&e.jsx(Ke,{leadId:j.id,scenarioId:z,onClose:()=>t(null),onConverted:()=>{E(),V()}}),m!==null&&e.jsx(es,{scenario:_.find(o=>o.id===m),onClose:()=>C(null),onRated:E}),ee&&j&&e.jsx(ss,{lead:j,onClose:()=>se(!1),onListed:()=>{se(!1),S.success("Lead listed on marketplace!")}})]})}return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Lead Pipeline"}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Manage leads, scenarios, and applications"})]}),e.jsx(y,{variant:"shield",leftIcon:e.jsx(Y,{className:"w-4 h-4"}),onClick:()=>R(!0),children:"Add Lead"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(L,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-slate-900",children:a.total}),e.jsx("p",{className:"text-sm text-slate-500",children:"Total Leads"})]}),e.jsxs(L,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-shield-600",children:a.new}),e.jsx("p",{className:"text-sm text-slate-500",children:"New"})]}),e.jsxs(L,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-confidence-600",children:a.contacted+a.quoted+a.applied}),e.jsx("p",{className:"text-sm text-slate-500",children:"In Progress"})]}),e.jsxs(L,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-savings-600",children:a.won}),e.jsx("p",{className:"text-sm text-slate-500",children:"Won"})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(p,{placeholder:"Search leads...",value:c,onChange:v=>b(v.target.value),leftIcon:e.jsx(De,{className:"w-5 h-5"})})}),e.jsx("div",{className:"w-48",children:e.jsx(T,{options:We,value:f,onChange:v=>g(v.target.value)})})]}),e.jsx(L,{children:r?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-4 border-shield-200 border-t-shield-600 rounded-full animate-spin"})}):s.length===0?e.jsx("div",{className:"text-center py-12 text-slate-500",children:"No leads found"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-100",children:[e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider p-4",children:"Lead"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider p-4",children:"Insurance"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider p-4",children:"Status"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider p-4",children:"Source"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider p-4",children:"Date"}),e.jsx("th",{className:"text-right text-xs font-medium text-slate-500 uppercase tracking-wider p-4",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-50",children:s.map(v=>{const o=Z[v.status]||Z.new;return e.jsxs("tr",{className:"hover:bg-slate-50 cursor-pointer",onClick:()=>re(v),children:[e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-9 h-9 rounded-full bg-shield-100 text-shield-700 flex items-center justify-center text-sm font-bold",children:[v.first_name[0],v.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-slate-900",children:[v.first_name," ",v.last_name]}),e.jsx("p",{className:"text-xs text-slate-500",children:v.email})]})]})}),e.jsx("td",{className:"p-4 text-sm text-slate-700 capitalize",children:v.insurance_type}),e.jsx("td",{className:"p-4",children:e.jsx(H,{variant:o.variant,children:o.label})}),e.jsx("td",{className:"p-4 text-sm text-slate-500 capitalize",children:v.source}),e.jsx("td",{className:"p-4 text-sm text-slate-500",children:G(v.created_at)}),e.jsx("td",{className:"p-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(y,{variant:"ghost",size:"sm",onClick:O=>{O.stopPropagation(),window.location.href=`tel:${v.phone}`},children:e.jsx(Ee,{className:"w-4 h-4"})}),e.jsx(y,{variant:"ghost",size:"sm",onClick:O=>{O.stopPropagation(),window.location.href=`mailto:${v.email}`},children:e.jsx(Me,{className:"w-4 h-4"})}),e.jsx(y,{variant:"ghost",size:"sm",onClick:O=>{O.stopPropagation(),re(v)},children:e.jsx(ae,{className:"w-4 h-4"})})]})})]},v.id)})})]})})}),Q&&e.jsx(Ve,{onClose:()=>R(!1),onCreated:V})]})}const Ye=[{value:"",label:"Select type..."},{value:"auto",label:"Auto"},{value:"homeowners",label:"Homeowners"},{value:"life_term",label:"Term Life"},{value:"life_whole",label:"Whole Life"},{value:"health_individual",label:"Health (Individual)"},{value:"health_group",label:"Health (Group)"},{value:"long_term_care",label:"Long Term Care"},{value:"disability_ltd",label:"Disability (LTD)"},{value:"disability_std",label:"Disability (STD)"},{value:"medicare_supplement",label:"Medicare Supplement"},{value:"commercial_gl",label:"Commercial GL"},{value:"workers_comp",label:"Workers Comp"},{value:"umbrella",label:"Umbrella"},{value:"renters",label:"Renters"},{value:"flood",label:"Flood"}],Ge=[{value:"",label:"Select source..."},{value:"website",label:"Website"},{value:"referral",label:"Referral"},{value:"phone",label:"Phone"},{value:"walk-in",label:"Walk-in"},{value:"partner",label:"Partner"},{value:"other",label:"Other"}];function Ve({onClose:s,onCreated:l}){const[a,x]=d.useState({first_name:"",last_name:"",email:"",phone:"",insurance_type:"",source:"",estimated_value:"",notes:""}),[c,b]=d.useState(!1),f=async()=>{if(!(!a.first_name||!a.last_name||!a.email||!a.insurance_type)){b(!0);try{await ge.createLead({first_name:a.first_name,last_name:a.last_name,email:a.email,phone:a.phone||void 0,insurance_type:a.insurance_type,source:a.source||void 0,estimated_value:a.estimated_value?Number(a.estimated_value):void 0,notes:a.notes||void 0}),S.success("Lead created successfully"),await l(),s()}catch{S.error("Failed to create lead")}finally{b(!1)}}};return e.jsx(B,{isOpen:!0,onClose:s,title:"Add New Lead",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(p,{label:"First Name *",placeholder:"John",value:a.first_name,onChange:g=>x({...a,first_name:g.target.value})}),e.jsx(p,{label:"Last Name *",placeholder:"Doe",value:a.last_name,onChange:g=>x({...a,last_name:g.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(p,{label:"Email *",type:"email",placeholder:"john@example.com",value:a.email,onChange:g=>x({...a,email:g.target.value})}),e.jsx(p,{label:"Phone",placeholder:"(555) 123-4567",value:a.phone,onChange:g=>x({...a,phone:g.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(T,{label:"Insurance Type *",options:Ye,value:a.insurance_type,onChange:g=>x({...a,insurance_type:g.target.value})}),e.jsx(T,{label:"Source",options:Ge,value:a.source,onChange:g=>x({...a,source:g.target.value})})]}),e.jsx(p,{label:"Estimated Value ($)",type:"number",placeholder:"0.00",value:a.estimated_value,onChange:g=>x({...a,estimated_value:g.target.value})}),e.jsx(ne,{label:"Notes",placeholder:"Any notes about this lead...",value:a.notes,onChange:g=>x({...a,notes:g.target.value}),rows:3}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(y,{variant:"ghost",onClick:s,children:"Cancel"}),e.jsx(y,{variant:"shield",onClick:f,disabled:c||!a.first_name||!a.last_name||!a.email||!a.insurance_type,children:c?"Creating...":"Create Lead"})]})]})})}function Je({leadId:s,productOptions:l,onClose:a,onCreated:x}){const[c,b]=d.useState({scenario_name:"",product_type:"",priority:1,notes:""}),[f,g]=d.useState(!1),r=async()=>{if(!(!c.scenario_name||!c.product_type)){g(!0);try{await F.create(s,c),await x(),a()}catch{S.error("Failed to create scenario")}finally{g(!1)}}};return e.jsx(B,{isOpen:!0,onClose:a,title:"New Scenario",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(p,{label:"Scenario Name",placeholder:"e.g. Primary Auto Coverage",value:c.scenario_name,onChange:i=>b({...c,scenario_name:i.target.value})}),e.jsx(T,{label:"Product Type",options:[{value:"",label:"Select product type..."},...l],value:c.product_type,onChange:i=>b({...c,product_type:i.target.value})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(T,{label:"Priority",options:[1,2,3,4,5].map(i=>({value:String(i),label:`P${i}`})),value:String(c.priority),onChange:i=>b({...c,priority:Number(i.target.value)})}),e.jsx(p,{label:"Target Premium ($/mo)",type:"number",placeholder:"0.00",value:c.target_premium_monthly?.toString()||"",onChange:i=>b({...c,target_premium_monthly:i.target.value?Number(i.target.value):void 0})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(p,{label:"Effective Date",type:"date",value:c.effective_date_desired||"",onChange:i=>b({...c,effective_date_desired:i.target.value||null})}),e.jsx(p,{label:"Current Carrier",placeholder:"e.g. State Farm",value:c.current_carrier||"",onChange:i=>b({...c,current_carrier:i.target.value||null})})]}),e.jsx(ne,{label:"Notes",placeholder:"Any additional notes...",value:c.notes||"",onChange:i=>b({...c,notes:i.target.value||null}),rows:3}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(y,{variant:"ghost",onClick:a,children:"Cancel"}),e.jsx(y,{variant:"shield",onClick:r,disabled:f||!c.scenario_name||!c.product_type,children:f?"Creating...":"Create Scenario"})]})]})})}function Xe({leadId:s,scenarioId:l,onClose:a,onCreated:x}){const[c,b]=d.useState("person"),[f,g]=d.useState(""),[r,i]=d.useState({}),[j,u]=d.useState(!1),_=async()=>{if(f){u(!0);try{const n={object_type:c,name:f};Object.entries(r).forEach(([k,A])=>{A&&(["vehicle_year","year_built","square_footage","employee_count","height_inches","weight_lbs"].includes(k)||["annual_revenue","annual_income"].includes(k)?n[k]=Number(A):k==="tobacco_use"?n[k]=A==="true":n[k]=A)}),await F.addObject(s,l,n),await x(),a()}catch{S.error("Failed to add insured object")}finally{u(!1)}}},$=[{value:"person",label:"Person"},{value:"vehicle",label:"Vehicle"},{value:"property",label:"Property"},{value:"business",label:"Business"},{value:"other",label:"Other"}];return e.jsx(B,{isOpen:!0,onClose:a,title:"Add Insured Object",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(T,{label:"Object Type",options:$,value:c,onChange:n=>{b(n.target.value),i({})}}),e.jsx(p,{label:"Name",placeholder:c==="person"?"John Doe":c==="vehicle"?"2024 Honda Civic":"Name",value:f,onChange:n=>g(n.target.value)}),c==="person"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(p,{label:"Relationship",placeholder:"e.g. Primary, Spouse",value:r.relationship||"",onChange:n=>i({...r,relationship:n.target.value})}),e.jsx(p,{label:"Date of Birth",type:"date",value:r.date_of_birth||"",onChange:n=>i({...r,date_of_birth:n.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(T,{label:"Gender",options:[{value:"",label:"Select..."},{value:"male",label:"Male"},{value:"female",label:"Female"},{value:"other",label:"Other"}],value:r.gender||"",onChange:n=>i({...r,gender:n.target.value})}),e.jsx(p,{label:"Height (in)",type:"number",value:r.height_inches||"",onChange:n=>i({...r,height_inches:n.target.value})}),e.jsx(p,{label:"Weight (lbs)",type:"number",value:r.weight_lbs||"",onChange:n=>i({...r,weight_lbs:n.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(T,{label:"Tobacco Use",options:[{value:"",label:"Select..."},{value:"false",label:"No"},{value:"true",label:"Yes"}],value:r.tobacco_use||"",onChange:n=>i({...r,tobacco_use:n.target.value})}),e.jsx(p,{label:"Occupation",value:r.occupation||"",onChange:n=>i({...r,occupation:n.target.value})})]}),e.jsx(p,{label:"Annual Income",type:"number",placeholder:"0.00",value:r.annual_income||"",onChange:n=>i({...r,annual_income:n.target.value})})]}),c==="vehicle"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(p,{label:"Year",type:"number",value:r.vehicle_year||"",onChange:n=>i({...r,vehicle_year:n.target.value})}),e.jsx(p,{label:"Make",placeholder:"Honda",value:r.vehicle_make||"",onChange:n=>i({...r,vehicle_make:n.target.value})}),e.jsx(p,{label:"Model",placeholder:"Civic",value:r.vehicle_model||"",onChange:n=>i({...r,vehicle_model:n.target.value})})]}),e.jsx(p,{label:"VIN",placeholder:"17-character VIN",value:r.vin||"",onChange:n=>i({...r,vin:n.target.value})})]}),c==="property"&&e.jsxs(e.Fragment,{children:[e.jsx(p,{label:"Address",placeholder:"123 Main St",value:r.address_line1||"",onChange:n=>i({...r,address_line1:n.target.value})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(p,{label:"City",value:r.city||"",onChange:n=>i({...r,city:n.target.value})}),e.jsx(p,{label:"State",placeholder:"TX",value:r.state||"",onChange:n=>i({...r,state:n.target.value})}),e.jsx(p,{label:"ZIP",value:r.zip||"",onChange:n=>i({...r,zip:n.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(p,{label:"Year Built",type:"number",value:r.year_built||"",onChange:n=>i({...r,year_built:n.target.value})}),e.jsx(p,{label:"Sq Footage",type:"number",value:r.square_footage||"",onChange:n=>i({...r,square_footage:n.target.value})}),e.jsx(p,{label:"Construction",placeholder:"Frame, Brick, etc.",value:r.construction_type||"",onChange:n=>i({...r,construction_type:n.target.value})})]})]}),c==="business"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(p,{label:"FEIN",value:r.fein||"",onChange:n=>i({...r,fein:n.target.value})}),e.jsx(p,{label:"NAICS Code",value:r.naics_code||"",onChange:n=>i({...r,naics_code:n.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(p,{label:"Annual Revenue",type:"number",placeholder:"0.00",value:r.annual_revenue||"",onChange:n=>i({...r,annual_revenue:n.target.value})}),e.jsx(p,{label:"Employee Count",type:"number",value:r.employee_count||"",onChange:n=>i({...r,employee_count:n.target.value})})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(y,{variant:"ghost",onClick:a,children:"Cancel"}),e.jsx(y,{variant:"shield",onClick:_,disabled:j||!f,children:j?"Adding...":"Add Object"})]})]})})}function Ze({leadId:s,scenarioId:l,scenario:a,onClose:x,onCreated:c}){const[b,f]=d.useState(""),[g,r]=d.useState("liability"),[i,j]=d.useState(""),[u,_]=d.useState(""),[$,n]=d.useState(""),[k,A]=d.useState(""),[P,Q]=d.useState(""),[R,W]=d.useState(!0),[I,D]=d.useState(!1),[M,q]=d.useState(null);d.useEffect(()=>{a?.product_type&&F.suggestedCoverages(a.product_type).then(q).catch(()=>{})},[a?.product_type]);const w=[{value:"liability",label:"Liability"},{value:"property",label:"Property"},{value:"medical",label:"Medical"},{value:"life",label:"Life"},{value:"disability",label:"Disability"},{value:"specialty",label:"Specialty"}],z=async()=>{if(!(!b||!g)){D(!0);try{await F.addCoverage(s,l,{coverage_type:b,coverage_category:g,limit_amount:i?Number(i):null,deductible_amount:u?Number(u):null,benefit_amount:$?Number($):null,benefit_period:k||null,elimination_period_days:P?Number(P):null,is_included:R}),await c(),x()}catch{S.error("Failed to add coverage")}finally{D(!1)}}},t=M?.coverage_types?Object.entries(M.coverage_types).flatMap(([m,C])=>C.map(ee=>({type:ee,category:m}))):[];return e.jsx(B,{isOpen:!0,onClose:x,title:"Add Coverage",children:e.jsxs("div",{className:"space-y-4",children:[t.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Quick select:"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:t.slice(0,12).map(({type:m,category:C})=>e.jsx("button",{className:"text-xs px-2 py-1 rounded-full bg-shield-50 text-shield-700 hover:bg-shield-100 transition-colors",onClick:()=>{f(m),r(C)},children:je(m)},m))})]}),e.jsx(p,{label:"Coverage Type",placeholder:"e.g. bodily_injury_per_person",value:b,onChange:m=>f(m.target.value)}),e.jsx(T,{label:"Category",options:w,value:g,onChange:m=>r(m.target.value)}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(p,{label:"Limit ($)",type:"number",placeholder:"0.00",value:i,onChange:m=>j(m.target.value)}),e.jsx(p,{label:"Deductible ($)",type:"number",placeholder:"0.00",value:u,onChange:m=>_(m.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(p,{label:"Benefit Amount ($)",type:"number",placeholder:"0.00",value:$,onChange:m=>n(m.target.value)}),e.jsx(p,{label:"Benefit Period",placeholder:"e.g. 20 years, to age 65",value:k,onChange:m=>A(m.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(p,{label:"Elimination Period (days)",type:"number",value:P,onChange:m=>Q(m.target.value)}),e.jsx(T,{label:"Included",options:[{value:"true",label:"Yes"},{value:"false",label:"No (Optional)"}],value:String(R),onChange:m=>W(m.target.value==="true")})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(y,{variant:"ghost",onClick:x,children:"Cancel"}),e.jsx(y,{variant:"shield",onClick:z,disabled:I||!b,children:I?"Adding...":"Add Coverage"})]})]})})}function Ke({leadId:s,scenarioId:l,onClose:a,onConverted:x}){const[c,b]=d.useState(""),[f,g]=d.useState(!1),r=async()=>{if(c){g(!0);try{await F.convert(s,l,{carrier_name:c}),x(),a()}catch{S.error("Failed to convert to application")}finally{g(!1)}}};return e.jsx(B,{isOpen:!0,onClose:a,title:"Convert to Application",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-slate-600",children:"This will create a new application from this scenario, copying all insured objects and coverages."}),e.jsx(p,{label:"Carrier Name",placeholder:"e.g. State Farm, Progressive, Mutual of Omaha",value:c,onChange:i=>b(i.target.value)}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(y,{variant:"ghost",onClick:a,children:"Cancel"}),e.jsxs(y,{variant:"shield",onClick:r,disabled:f||!c,children:[e.jsx(qe,{className:"w-4 h-4 mr-1"}),f?"Converting...":"Create Application"]})]})]})})}function es({scenario:s,onClose:l,onRated:a}){const[x,c]=d.useState("rate"),[b,f]=d.useState(!1),[g,r]=d.useState(!0),[i,j]=d.useState(null),[u,_]=d.useState(null),[$,n]=d.useState([]),[k,A]=d.useState(!1),[P,Q]=d.useState("monthly"),[R,W]=d.useState({}),[I,D]=d.useState({});d.useEffect(()=>{r(!0),le.getOptions(s.product_type).then(t=>{j(t);const m={};t.riders.forEach(C=>{m[C.code]=C.default}),D(m)}).catch(()=>S.error("Failed to load rating options")).finally(()=>r(!1))},[s.product_type]);const M=async()=>{f(!0);try{const t={payment_mode:P,factor_selections:R,rider_selections:I},m=await le.rateScenario(s.id,t);_(m),c("results"),await a(),m.eligible?S.success(`Premium: ${w(m.premium_modal)}/${P}`):S.warning(`Ineligible: ${m.ineligible_reason}`)}catch(t){S.error(t instanceof Error?t.message:"Rating failed")}finally{f(!1)}},q=async()=>{A(!0);try{const t=await le.getHistory(s.id);n(t)}catch{S.error("Failed to load rating history")}finally{A(!1)}};d.useEffect(()=>{x==="history"&&q()},[x]);const w=t=>t==null?"—":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t),z=i?Object.entries(i.factors):[];return e.jsx(B,{isOpen:!0,onClose:l,title:`Rate: ${s.scenario_name}`,size:"lg",children:e.jsxs("div",{children:[e.jsx("div",{className:"flex border-b border-slate-200 mb-4",children:[{key:"rate",label:"Configure",icon:K},{key:"results",label:"Results",icon:pe},{key:"history",label:"History",icon:ce}].map(t=>e.jsxs("button",{className:`flex items-center gap-1.5 px-4 py-2.5 text-sm font-medium border-b-2 transition-colors ${x===t.key?"border-shield-600 text-shield-700":"border-transparent text-slate-500 hover:text-slate-700"}`,onClick:()=>c(t.key),children:[e.jsx(t.icon,{className:"w-4 h-4"}),t.label]},t.key))}),x==="rate"&&e.jsx("div",{className:"space-y-5 max-h-[60vh] overflow-y-auto pr-1",children:g?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-4 border-shield-200 border-t-shield-600 rounded-full animate-spin"})}):i?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-shield-50 rounded-lg p-3",children:[e.jsxs("p",{className:"text-sm font-medium text-shield-800",children:["Product: ",e.jsx("span",{className:"capitalize",children:s.product_type.replace(/_/g," ")})]}),e.jsxs("p",{className:"text-xs text-shield-600 mt-0.5",children:["Rate Table v",i.rate_table_version," • ",s.insured_objects.length," insured objects • ",s.coverages.length," coverages"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 block mb-1.5",children:"Payment Mode"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:["monthly","quarterly","semiannual","annual"].map(t=>e.jsx("button",{className:`text-sm py-2 rounded-lg font-medium transition-colors ${P===t?"bg-shield-600 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,onClick:()=>Q(t),children:t.charAt(0).toUpperCase()+t.slice(1)},t))})]}),z.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-700 mb-3 flex items-center gap-1.5",children:[e.jsx(ze,{className:"w-4 h-4"})," Rating Factors"]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:z.map(([t,m])=>e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 block mb-1",children:m.label||t.replace(/_/g," ")}),e.jsxs("select",{className:"w-full text-sm border border-slate-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-shield-500 focus:border-shield-500",value:R[t]||"",onChange:C=>W({...R,[t]:C.target.value}),children:[e.jsx("option",{value:"",children:"— Not selected —"}),m.options.map(C=>e.jsxs("option",{value:C.value,children:[C.value.replace(/_/g," ")," (",C.mode==="multiply"?`×${C.factor}`:`+${C.factor}`,")"]},C.value))]})]},t))})]}),i.riders.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-700 mb-3 flex items-center gap-1.5",children:[e.jsx(he,{className:"w-4 h-4"})," Riders & Endorsements"]}),e.jsx("div",{className:"space-y-2",children:i.riders.map(t=>{const m=I[t.code]??t.default;return e.jsxs("button",{className:`w-full flex items-center justify-between px-3 py-2.5 rounded-lg text-sm transition-colors ${m?"bg-shield-50 border border-shield-200":"bg-slate-50 border border-slate-100"}`,onClick:()=>D({...I,[t.code]:!m}),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[m?e.jsx(Be,{className:"w-5 h-5 text-shield-600"}):e.jsx(Ue,{className:"w-5 h-5 text-slate-400"}),e.jsx("span",{className:m?"text-shield-800 font-medium":"text-slate-600",children:t.label})]}),e.jsx("span",{className:"text-xs text-slate-500",children:t.mode==="add"?w(t.value):`×${t.value}`})]},t.code)})})]}),e.jsx("div",{className:"pt-2",children:e.jsx(y,{variant:"shield",className:"w-full",onClick:M,disabled:b,children:b?e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"w-4 h-4 mr-2 animate-spin"})," Calculating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-4 h-4 mr-2"})," Calculate Premium"]})})})]}):e.jsxs("div",{className:"text-center py-8 text-slate-500",children:[e.jsx(X,{className:"w-10 h-10 mx-auto mb-2 text-slate-300"}),e.jsxs("p",{children:["No rate table available for ",e.jsx("strong",{children:s.product_type})]})]})}),x==="results"&&e.jsx("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto pr-1",children:u?u.eligible?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gradient-to-br from-shield-600 to-shield-800 rounded-xl p-6 text-white text-center",children:[e.jsxs("p",{className:"text-sm opacity-80 mb-1",children:[P.charAt(0).toUpperCase()+P.slice(1)," Premium"]}),e.jsx("p",{className:"text-4xl font-bold",children:w(u.premium_modal)}),e.jsxs("p",{className:"text-sm opacity-80 mt-2",children:["Annual: ",w(u.premium_annual)]})]}),u.monthly_benefit_approved!=null&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3",children:[e.jsxs("p",{className:"text-sm font-medium text-amber-800",children:["Monthly Benefit Approved: ",w(u.monthly_benefit_approved)]}),u.income_replacement_ratio!=null&&e.jsxs("p",{className:"text-xs text-amber-600 mt-0.5",children:["Income Replacement: ",(u.income_replacement_ratio*100).toFixed(0),"%",u.occupation_class&&` | Occ Class: ${u.occupation_class}`]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-slate-700 mb-2",children:"Premium Breakdown"}),e.jsxs("div",{className:"bg-slate-50 rounded-lg divide-y divide-slate-100",children:[e.jsxs("div",{className:"flex justify-between px-4 py-2.5 text-sm",children:[e.jsx("span",{className:"text-slate-600",children:"Exposure"}),e.jsx("span",{className:"font-medium",children:u.exposure.toFixed(4)})]}),e.jsxs("div",{className:"flex justify-between px-4 py-2.5 text-sm",children:[e.jsxs("span",{className:"text-slate-600",children:["Base Rate (",u.base_rate_key,")"]}),e.jsx("span",{className:"font-medium",children:u.base_rate_value.toFixed(4)})]}),e.jsxs("div",{className:"flex justify-between px-4 py-2.5 text-sm",children:[e.jsx("span",{className:"text-slate-600",children:"Base Premium"}),e.jsx("span",{className:"font-medium",children:w(u.base_premium)})]}),u.factors_applied.length>0&&e.jsxs(e.Fragment,{children:[u.factors_applied.map((t,m)=>e.jsx("div",{className:"flex justify-between px-4 py-2 text-sm",children:e.jsxs("span",{className:"text-slate-500 pl-4",children:[t.label,": ",t.option," (",t.mode==="multiply"?`×${t.value}`:`+${t.value}`,")"]})},m)),e.jsxs("div",{className:"flex justify-between px-4 py-2.5 text-sm",children:[e.jsx("span",{className:"text-slate-600",children:"After Factors"}),e.jsx("span",{className:"font-medium",children:w(u.premium_factored)})]})]}),u.riders_applied.length>0&&e.jsxs(e.Fragment,{children:[u.riders_applied.map((t,m)=>e.jsxs("div",{className:"flex justify-between px-4 py-2 text-sm",children:[e.jsx("span",{className:"text-slate-500 pl-4",children:t.label}),e.jsxs("span",{className:"text-slate-600",children:[t.charge>=0?"+":"",w(t.charge)]})]},m)),e.jsxs("div",{className:"flex justify-between px-4 py-2.5 text-sm",children:[e.jsx("span",{className:"text-slate-600",children:"After Riders"}),e.jsx("span",{className:"font-medium",children:w(u.premium_with_riders)})]})]}),u.fees_applied.length>0&&e.jsx(e.Fragment,{children:u.fees_applied.map((t,m)=>e.jsxs("div",{className:"flex justify-between px-4 py-2 text-sm",children:[e.jsxs("span",{className:`pl-4 ${t.type==="credit"?"text-savings-600":"text-slate-500"}`,children:[t.label," (",t.type,")"]}),e.jsxs("span",{className:t.type==="credit"?"text-savings-600":"text-slate-600",children:[t.amount>=0?"+":"",w(t.amount)]})]},m))}),e.jsxs("div",{className:"flex justify-between px-4 py-3 text-sm font-bold bg-shield-50",children:[e.jsx("span",{className:"text-shield-800",children:"Annual Premium"}),e.jsx("span",{className:"text-shield-800",children:w(u.premium_annual)})]}),e.jsxs("div",{className:"flex justify-between px-4 py-2.5 text-sm",children:[e.jsxs("span",{className:"text-slate-600",children:["Modal: ",u.modal_mode," (×",u.modal_factor,u.modal_fee>0?` +${w(u.modal_fee)}`:"",")"]}),e.jsx("span",{className:"font-bold text-shield-700",children:w(u.premium_modal)})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-400",children:[e.jsxs("span",{children:["Engine v",u.engine_version]}),e.jsxs("span",{children:["Table v",u.rate_table_version]})]}),e.jsxs(y,{variant:"outline",className:"w-full",onClick:()=>c("rate"),children:[e.jsx(de,{className:"w-4 h-4 mr-2"})," Adjust & Re-Rate"]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(X,{className:"w-12 h-12 mx-auto mb-3 text-red-400"}),e.jsx("p",{className:"text-lg font-semibold text-red-600",children:"Ineligible"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:u.ineligible_reason})]}):e.jsxs("div",{className:"text-center py-8 text-slate-500",children:[e.jsx(K,{className:"w-10 h-10 mx-auto mb-2 text-slate-300"}),e.jsx("p",{children:"Run a rating first to see results"})]})}),x==="history"&&e.jsx("div",{className:"space-y-3 max-h-[60vh] overflow-y-auto pr-1",children:k?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-4 border-shield-200 border-t-shield-600 rounded-full animate-spin"})}):$.length===0?e.jsxs("div",{className:"text-center py-8 text-slate-500",children:[e.jsx(ce,{className:"w-10 h-10 mx-auto mb-2 text-slate-300"}),e.jsx("p",{children:"No rating history yet"})]}):$.map(t=>e.jsxs(L,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t.status==="success"?e.jsx(He,{className:"w-4 h-4 text-savings-600"}):t.status==="ineligible"?e.jsx(X,{className:"w-4 h-4 text-amber-500"}):e.jsx(X,{className:"w-4 h-4 text-red-500"}),e.jsx(H,{variant:t.status==="success"?"success":t.status==="ineligible"?"warning":"danger",children:t.status}),e.jsxs("span",{className:"text-xs text-slate-400",children:[t.duration_ms,"ms"]})]}),e.jsx("span",{className:"text-xs text-slate-400",children:new Date(t.created_at).toLocaleString()})]}),t.output_snapshot?.eligible&&e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"font-bold text-shield-700",children:[w(t.output_snapshot.premium_modal),"/",t.output_snapshot.modal_mode]}),e.jsxs("span",{className:"text-slate-500",children:["Annual: ",w(t.output_snapshot.premium_annual)]})]}),t.error_message&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.error_message}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-slate-400",children:[e.jsxs("span",{children:["v",t.engine_version]}),e.jsxs("span",{children:["Table v",t.rate_table_version]})]})]},t.id))})]})})}function ss({lead:s,onClose:l,onListed:a}){const[x,c]=d.useState(""),[b,f]=d.useState(""),[g,r]=d.useState("30"),[i,j]=d.useState(!1),u=async()=>{const _=parseFloat(x);if(!_||_<1){S.error("Enter a valid asking price ($1 minimum)");return}j(!0);try{await $e.createListing({lead_id:s.id,asking_price:_,seller_notes:b||void 0,expires_in_days:parseInt(g)||30}),a()}catch($){const n=$?.response?.data?.message||"Failed to list lead";S.error(n)}finally{j(!1)}};return e.jsx(B,{isOpen:!0,title:"Sell Lead on Marketplace",onClose:l,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(L,{className:"p-4 bg-slate-50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-10 h-10 rounded-full bg-shield-100 text-shield-700 flex items-center justify-center font-bold",children:[s.first_name[0],s.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-slate-900",children:[s.first_name," ",s.last_name]}),e.jsxs("p",{className:"text-sm text-slate-500 capitalize",children:[s.insurance_type," · ",s.email]})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Asking Price ($)"}),e.jsx(p,{type:"number",min:"1",max:"9999",step:"0.01",placeholder:"e.g. 25.00",value:x,onChange:_=>c(_.target.value),leftIcon:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Platform takes a small fee; you receive the remainder."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Seller Notes (optional)"}),e.jsx(ne,{placeholder:"Any details that help buyers (e.g. 'Hot lead, called 2x, ready to quote')",value:b,onChange:_=>f(_.target.value),rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Listing Duration"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-slate-300 rounded-lg text-sm",value:g,onChange:_=>r(_.target.value),children:[e.jsx("option",{value:"7",children:"7 days"}),e.jsx("option",{value:"14",children:"14 days"}),e.jsx("option",{value:"30",children:"30 days"}),e.jsx("option",{value:"60",children:"60 days"}),e.jsx("option",{value:"90",children:"90 days"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(y,{variant:"ghost",className:"flex-1",onClick:l,children:"Cancel"}),e.jsxs(y,{variant:"shield",className:"flex-1",onClick:u,disabled:i,children:[e.jsx(me,{className:"w-4 h-4 mr-1"}),i?"Listing...":"List on Marketplace"]})]})]})})}export{ds as default};
