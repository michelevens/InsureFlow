import{j as e}from"./vendor-query-D5ml2kdZ.js";import{r as l}from"./vendor-react-C8VcOkCS.js";import{B as r,C as i,I as j,S as G}from"./index-CyWO3JYX.js";import{B as g}from"./Badge-DV1ZXp4T.js";import{a as p}from"./admin-BHVqi3KQ.js";import{A as H,aO as D,K as Q,aR as I,S as R,ax as W,ae as Y,L as Z,u as $,X as ee,ad as c}from"./vendor-ui-tJ0aMxU9.js";const F={consumer:"default",agent:"shield",agency_owner:"info",carrier:"warning",admin:"danger",superadmin:"danger"};function ce(){const[f,L]=l.useState(""),[u,M]=l.useState(""),[w,B]=l.useState([]),[o,T]=l.useState({}),[y,b]=l.useState(!0),[N,C]=l.useState(""),[S,_]=l.useState(null),[O,d]=l.useState(!1),[m,U]=l.useState(null),[a,n]=l.useState({name:"",email:"",role:"agent",password:"",agency_id:""}),[k,v]=l.useState(!1),[A,P]=l.useState("");l.useEffect(()=>{x()},[u]);const x=async()=>{try{b(!0),C("");const s={};u&&(s.role=u),f&&(s.search=f);const t=await p.getUsers(s);B(t.items),T(t.counts)}catch(s){C(s instanceof Error?s.message:"Failed to load users")}finally{b(!1)}},q=()=>{x()},E=async s=>{try{const t=s.is_active!==!1;await p.toggleUserStatus(s.id,!t),c.success(t?"User deactivated":"User activated"),x()}catch{c.error("Failed to update user status")}},K=()=>{U(null),n({name:"",email:"",role:"agent",password:"",agency_id:""}),d(!0)},z=s=>{U(s),n({name:s.name,email:s.email,role:s.role,password:"",agency_id:s.agency_id?.toString()||""}),d(!0)},J=async()=>{if(!a.name.trim()||!a.email.trim()){c.error("Name and email are required");return}v(!0);try{if(m){const s={name:a.name,email:a.email,role:a.role};await p.updateUser(m.id,s),c.success("User updated")}else{if(!a.password){c.error("Password is required for new users"),v(!1);return}await p.createUser({name:a.name,email:a.email,role:a.role,password:a.password,agency_id:a.agency_id?Number(a.agency_id):void 0}),c.success("User created")}d(!1),x()}catch{c.error("Failed to save user")}finally{v(!1)}},V=async s=>{try{const t=await p.resetPassword(s.id);P(t.temporary_password),c.success("Password reset successfully")}catch{c.error("Failed to reset password")}},X=Object.values(o).reduce((s,t)=>s+(t||0),0);if(S){const s=S,t=s.is_active!==!1;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(r,{variant:"ghost",size:"sm",onClick:()=>{_(null),P("")},children:[e.jsx(H,{className:"h-4 w-4 mr-1"})," Back to Users"]}),e.jsxs(i,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-full gradient-shield flex items-center justify-center text-white text-xl font-bold",children:s.name.split(" ").map(h=>h[0]).join("").slice(0,2)}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:s.name}),e.jsx("p",{className:"text-sm text-slate-500",children:s.email})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{variant:F[s.role],className:"capitalize",children:s.role.replace("_"," ")}),e.jsx(g,{variant:t?"success":"danger",children:t?"Active":"Suspended"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mt-6 pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Phone"}),e.jsx("p",{className:"text-sm font-medium text-slate-900",children:s.phone||"—"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Agency ID"}),e.jsx("p",{className:"text-sm font-medium text-slate-900",children:s.agency_id||"—"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Email Verified"}),e.jsx("p",{className:"text-sm font-medium text-slate-900",children:s.email_verified_at?new Date(s.email_verified_at).toLocaleDateString():"Not verified"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Joined"}),e.jsx("p",{className:"text-sm font-medium text-slate-900",children:s.created_at?new Date(s.created_at).toLocaleDateString():"—"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6 pt-4 border-t",children:[e.jsx(r,{variant:"outline",size:"sm",leftIcon:e.jsx(D,{className:"w-4 h-4"}),onClick:()=>z(s),children:"Edit"}),e.jsx(r,{variant:"outline",size:"sm",leftIcon:e.jsx(Q,{className:"w-4 h-4"}),onClick:()=>V(s),children:"Reset Password"}),e.jsxs(r,{variant:t?"outline":"primary",size:"sm",onClick:()=>E(s),children:[t?e.jsx(I,{className:"w-4 h-4 mr-1"}):e.jsx(R,{className:"w-4 h-4 mr-1"}),t?"Deactivate":"Activate"]})]}),A&&e.jsxs("div",{className:"mt-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-amber-800",children:"Temporary Password:"}),e.jsx("p",{className:"text-lg font-mono font-bold text-amber-900 mt-1",children:A}),e.jsx("p",{className:"text-xs text-amber-600 mt-1",children:"Share this with the user. They should change it after logging in."})]})]})]})}return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"User Management"}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Manage platform users and roles"})]}),e.jsx(r,{variant:"shield",leftIcon:e.jsx(W,{className:"w-4 h-4"}),onClick:K,children:"Create User"})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs(i,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-xl font-bold text-slate-900",children:X}),e.jsx("p",{className:"text-sm text-slate-500",children:"Total Users"})]}),e.jsxs(i,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-xl font-bold text-slate-900",children:o.consumer||0}),e.jsx("p",{className:"text-sm text-slate-500",children:"Consumers"})]}),e.jsxs(i,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-xl font-bold text-slate-900",children:o.agent||0}),e.jsx("p",{className:"text-sm text-slate-500",children:"Agents"})]}),e.jsxs(i,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-xl font-bold text-slate-900",children:o.agency_owner||0}),e.jsx("p",{className:"text-sm text-slate-500",children:"Agencies"})]}),e.jsxs(i,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-xl font-bold text-slate-900",children:o.carrier||0}),e.jsx("p",{className:"text-sm text-slate-500",children:"Carriers"})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(j,{placeholder:"Search by name or email...",value:f,onChange:s=>L(s.target.value),onKeyDown:s=>s.key==="Enter"&&q(),leftIcon:e.jsx(Y,{className:"w-5 h-5"})})}),e.jsx("div",{className:"w-48",children:e.jsx(G,{options:[{value:"",label:"All Roles"},{value:"consumer",label:"Consumer"},{value:"agent",label:"Agent"},{value:"agency_owner",label:"Agency Owner"},{value:"carrier",label:"Carrier"}],value:u,onChange:s=>M(s.target.value)})})]}),N&&e.jsxs(i,{className:"p-6 text-center",children:[e.jsx("p",{className:"text-red-500",children:N}),e.jsx(r,{variant:"outline",size:"sm",className:"mt-2",onClick:x,children:"Retry"})]}),y&&e.jsxs(i,{className:"p-12 text-center",children:[e.jsx(Z,{className:"w-8 h-8 animate-spin text-shield-500 mx-auto"}),e.jsx("p",{className:"text-slate-500 mt-2",children:"Loading users..."})]}),!y&&!N&&e.jsx(i,{children:w.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx($,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-500",children:"No users found"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-100",children:[e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider p-4",children:"User"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider p-4",children:"Role"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider p-4",children:"Status"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider p-4",children:"Joined"}),e.jsx("th",{className:"text-right text-xs font-medium text-slate-500 uppercase tracking-wider p-4",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-50",children:w.map(s=>{const t=s.is_active!==!1;return e.jsxs("tr",{className:"hover:bg-slate-50 cursor-pointer",onClick:()=>_(s),children:[e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-full gradient-shield flex items-center justify-center text-white text-sm font-bold",children:s.name.split(" ").map(h=>h[0]).join("").slice(0,2)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900",children:s.name}),e.jsx("p",{className:"text-xs text-slate-500",children:s.email})]})]})}),e.jsx("td",{className:"p-4",children:e.jsx(g,{variant:F[s.role],className:"capitalize",children:s.role.replace("_"," ")})}),e.jsx("td",{className:"p-4",children:e.jsx(g,{variant:t?"success":"danger",children:t?"active":"suspended"})}),e.jsx("td",{className:"p-4 text-sm text-slate-500",children:s.created_at?.split("T")[0]||"-"}),e.jsx("td",{className:"p-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",onClick:h=>h.stopPropagation(),children:[e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>z(s),children:e.jsx(D,{className:"w-4 h-4"})}),e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>E(s),children:t?e.jsx(I,{className:"w-4 h-4 text-red-500"}):e.jsx(R,{className:"w-4 h-4 text-green-500"})})]})})]},s.id)})})]})})}),O&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:()=>d(!1),children:e.jsxs(i,{className:"w-full max-w-md p-6",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:m?"Edit User":"Create User"}),e.jsx("button",{onClick:()=>d(!1),children:e.jsx(ee,{className:"w-5 h-5 text-slate-400"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Name"}),e.jsx(j,{value:a.name,onChange:s=>n({...a,name:s.target.value}),placeholder:"Full name"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Email"}),e.jsx(j,{type:"email",value:a.email,onChange:s=>n({...a,email:s.target.value}),placeholder:"user@example.com"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Role"}),e.jsxs("select",{value:a.role,onChange:s=>n({...a,role:s.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-shield-500",children:[e.jsx("option",{value:"consumer",children:"Consumer"}),e.jsx("option",{value:"agent",children:"Agent"}),e.jsx("option",{value:"agency_owner",children:"Agency Owner"}),e.jsx("option",{value:"carrier",children:"Carrier"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),!m&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Password"}),e.jsx(j,{type:"password",value:a.password,onChange:s=>n({...a,password:s.target.value}),placeholder:"Minimum 8 characters"})]}),a.role==="agent"&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Agency ID (optional)"}),e.jsx(j,{value:a.agency_id,onChange:s=>n({...a,agency_id:s.target.value}),placeholder:"Agency ID number"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(r,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(r,{onClick:J,disabled:k,children:k?"Saving...":m?"Update":"Create"})]})]})})]})}export{ce as default};
