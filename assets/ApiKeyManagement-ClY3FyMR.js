import{j as e}from"./vendor-query-D5ml2kdZ.js";import{r as l}from"./vendor-react-C8VcOkCS.js";import{ax as k,K as C,aY as A,ad as o,z as P,an as R,d as L,am as $}from"./vendor-ui-tJ0aMxU9.js";import{b as d,B as m,C as N,I as S}from"./index-BZEM9EbM.js";import{B as _}from"./Badge-8fS5vckW.js";import{M as q}from"./Modal-Cn8_xSIn.js";function I(t){if(!t)return"";const r=Object.entries(t).filter(([,n])=>n!==void 0);return r.length?"?"+new URLSearchParams(r.map(([n,h])=>[n,String(h)])).toString():""}const v={list:()=>d.get("/api-keys"),create:t=>d.post("/api-keys",t),update:(t,r)=>d.put(`/api-keys/${t}`,r),revoke:t=>d.delete(`/api-keys/${t}`),regenerate:t=>d.post(`/api-keys/${t}/regenerate`),getUsage:(t,r)=>d.get(`/api-keys/${t}/usage${I(r)}`),getUsageLogs:(t,r)=>d.get(`/api-keys/${t}/logs${I(r)}`),getPermissions:()=>d.get("/api-keys/permissions")};function D(){const[t,r]=l.useState([]),[n,h]=l.useState(!0),[y,p]=l.useState(!1),[x,b]=l.useState(null),[c,u]=l.useState(null),[g,j]=l.useState(null),f=async()=>{h(!0);try{const s=await v.list();r(s)}catch{o.error("Failed to load API keys")}finally{h(!1)}};l.useEffect(()=>{f()},[]);const w=async s=>{b(s);try{const i=await v.getUsage(s.id);u(i)}catch{u(null)}},a=async s=>{try{await v.revoke(s),o.success("API key revoked successfully"),f(),x?.id===s&&(b(null),u(null))}catch{o.error("Failed to revoke API key")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"API Keys"}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Manage API access for integrations"})]}),e.jsxs(m,{variant:"shield",onClick:()=>p(!0),children:[e.jsx(k,{className:"w-4 h-4 mr-1"})," Create API Key"]})]}),g&&e.jsx(N,{className:"p-4 bg-green-50 border-green-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(C,{className:"w-5 h-5 text-green-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-green-900 text-sm",children:"API Key Created"}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:"Copy this key now. It won't be shown again."}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("code",{className:"bg-white px-3 py-1.5 rounded-lg text-sm font-mono text-green-800 border border-green-200 flex-1 truncate",children:g}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>{navigator.clipboard.writeText(g),o.success("API key copied to clipboard")},children:e.jsx(A,{className:"w-4 h-4"})})]})]}),e.jsx("button",{onClick:()=>j(null),className:"text-green-600 hover:text-green-800 text-lg",children:"Ã—"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-3",children:n?e.jsx(N,{className:"p-8 text-center",children:e.jsx("div",{className:"w-8 h-8 border-4 border-shield-200 border-t-shield-600 rounded-full animate-spin mx-auto"})}):t.length===0?e.jsxs(N,{className:"p-12 text-center",children:[e.jsx(C,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-500 mb-4",children:"No API keys yet"}),e.jsxs(m,{variant:"shield",onClick:()=>p(!0),children:[e.jsx(k,{className:"w-4 h-4 mr-1"})," Create First Key"]})]}):t.map(s=>e.jsxs(N,{className:`p-4 cursor-pointer transition-all ${x?.id===s.id?"ring-2 ring-shield-500":"hover:shadow-md"}`,onClick:()=>w(s),children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-slate-100 flex items-center justify-center",children:e.jsx(C,{className:"w-5 h-5 text-slate-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-900 text-sm",children:s.name}),e.jsxs("p",{className:"text-xs text-slate-400 font-mono mt-0.5",children:[s.key_prefix,"...****"]})]})]}),e.jsx(_,{variant:s.is_active?"success":"danger",children:s.is_active?"Active":"Revoked"})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-3 text-xs text-slate-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(P,{className:"w-3 h-3"})," ",s.request_count.toLocaleString()," requests"]}),e.jsxs("span",{children:["Rate: ",s.rate_limit,"/min"]}),s.last_used_at&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(R,{className:"w-3 h-3"})," Last used ",new Date(s.last_used_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[s.permissions.slice(0,5).map(i=>e.jsx("span",{className:"text-xs bg-slate-100 text-slate-600 px-2 py-0.5 rounded-full",children:i},i)),s.permissions.length>5&&e.jsxs("span",{className:"text-xs text-slate-400",children:["+",s.permissions.length-5," more"]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3 pt-2 border-t border-slate-100",children:[e.jsxs(m,{variant:"ghost",size:"sm",onClick:i=>{i.stopPropagation(),a(s.id)},children:[e.jsx(L,{className:"w-3.5 h-3.5 text-red-400 mr-1"})," Revoke"]}),e.jsxs(m,{variant:"ghost",size:"sm",onClick:i=>{i.stopPropagation(),v.regenerate(s.id).then(K=>{j(K.plain_text_key),f(),o.success("API key regenerated successfully")}).catch(()=>{o.error("Failed to regenerate API key")})},children:[e.jsx($,{className:"w-3.5 h-3.5 mr-1"})," Regenerate"]})]})]},s.id))}),e.jsx("div",{children:x&&c?e.jsxs(N,{className:"p-5 sticky top-4",children:[e.jsxs("h3",{className:"font-bold text-slate-900 mb-4",children:["Usage: ",x.name]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-3",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Total Requests"}),e.jsx("p",{className:"text-lg font-bold text-slate-900",children:c.total_requests.toLocaleString()})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-3",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Avg Response"}),e.jsxs("p",{className:"text-lg font-bold text-slate-900",children:[c.avg_response_time_ms,"ms"]})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-3 col-span-2",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Error Rate"}),e.jsxs("p",{className:"text-lg font-bold text-slate-900",children:[(c.error_rate*100).toFixed(2),"%"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase mb-2",children:"Top Endpoints"}),e.jsx("div",{className:"space-y-1.5",children:c.top_endpoints.slice(0,5).map((s,i)=>e.jsxs("div",{className:"flex items-center justify-between text-sm py-1",children:[e.jsx("span",{className:"text-slate-700 font-mono text-xs truncate flex-1 mr-2",children:s.endpoint}),e.jsx("span",{className:"text-slate-500 text-xs",children:s.count})]},i))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase mb-2",children:"Status Codes"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:c.status_breakdown.map(s=>e.jsxs(_,{variant:s.status<400?"success":s.status<500?"warning":"danger",children:[s.status,": ",s.count]},s.status))})]})]})]}):e.jsxs(N,{className:"p-8 text-center text-slate-400",children:[e.jsx(P,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Select a key to view usage"})]})})]}),y&&e.jsx(U,{onClose:()=>p(!1),onCreated:s=>{j(s),f(),p(!1)}})]})}function U({onClose:t,onCreated:r}){const[n,h]=l.useState(""),[y,p]=l.useState("60"),[x,b]=l.useState([]),[c,u]=l.useState([]),[g,j]=l.useState(!1);l.useEffect(()=>{v.getPermissions().then(u).catch(()=>{u(["quotes:read","quotes:write","policies:read","applications:read","analytics:read"])})},[]);const f=a=>{b(s=>s.includes(a)?s.filter(i=>i!==a):[...s,a])},w=async()=>{if(n){j(!0);try{const a=await v.create({name:n,permissions:x,rate_limit:parseInt(y)||60});o.success("API key created successfully"),r(a.plain_text_key)}catch{o.error("Failed to create API key")}finally{j(!1)}}};return e.jsx(q,{isOpen:!0,onClose:t,title:"Create API Key",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(S,{label:"Key Name",placeholder:"My Integration",value:n,onChange:a=>h(a.target.value)}),e.jsx(S,{label:"Rate Limit (requests/min)",type:"number",value:y,onChange:a=>p(a.target.value)}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 block mb-2",children:"Permissions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:c.map(a=>e.jsx("button",{onClick:()=>f(a),className:`text-xs px-3 py-1.5 rounded-full border transition-colors ${x.includes(a)?"bg-shield-50 border-shield-300 text-shield-700":"bg-white border-slate-200 text-slate-600 hover:border-slate-300"}`,children:a},a))})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(m,{variant:"ghost",onClick:t,children:"Cancel"}),e.jsx(m,{variant:"shield",onClick:w,disabled:g||!n,children:g?"Creating...":"Create Key"})]})]})})}export{D as default};
